pc.script.createLoadingScreen((function(e){var t,a;t=["body {","    background-color: #283538;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #283538;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #1d292c;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #f60;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var a=document.createElement("img");a.src="https://sovanadao.com/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Flogo.f13f2619.svg&w=384&q=75",t.appendChild(a),a.onload=function(){t.style.display="block"};var o=document.createElement("div");o.id="progress-bar-container",t.appendChild(o);var n=document.createElement("div");n.id="progress-bar",o.appendChild(n)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));"use strict";var Exitgames,Photon,__extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)};return function(e,t){function __(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();!function(e){!function(e){var t=function(){function Logger(e,t){void 0===e&&(e=""),void 0===t&&(t=Logger.Level.INFO),this.prefix=e,this.level=t}return Logger.prototype.setPrefix=function(e){this.prefix=e},Logger.prototype.getPrefix=function(){return this.prefix},Logger.prototype.setLevel=function(e){e=Math.max(e,Logger.Level.DEBUG),e=Math.min(e,Logger.Level.OFF),this.level=e},Logger.setExceptionHandler=function(e){this.exceptionHandler=e},Logger.prototype.isLevelEnabled=function(e){return e>=this.level},Logger.prototype.getLevel=function(){return this.level},Logger.prototype.debug=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.log(Logger.Level.DEBUG,e,t)},Logger.prototype.info=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.log(Logger.Level.INFO,e,t)},Logger.prototype.warn=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.log(Logger.Level.WARN,e,t)},Logger.prototype.error=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.log(Logger.Level.ERROR,e,t)},Logger.prototype.exception=function(e,t){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];if(!Logger.exceptionHandler||!Logger.exceptionHandler(e,this.format0(t,o)))throw new Error(this.format0("["+e+"] "+t,o))},Logger.prototype.format=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];return this.format0(e,t)},Logger.prototype.formatArr=function(e,t){return this.format0(e,t)},Logger.prototype.log=function(e,t,o){if(e>=this.level&&"undefined"!=typeof console&&void 0!==t)try{var n;(n=console.hasOwnProperty(Logger.log_types[e])?console[Logger.log_types[e]]:console.log)&&n.apply(console,[this.prefix,t].concat(o))}catch(e){}},Logger.prototype.format0=function(e,t){return(""==this.prefix?"":this.prefix+" ")+e+" "+t.map((function(e){if(void 0!==e)switch(typeof e){case"object":try{return JSON.stringify(e)}catch(t){return e.toString()+"("+t+")"}default:return e.toString()}})).join(" ")},Logger.Level={DEBUG:1,INFO:2,WARN:3,ERROR:4,OFF:6},Logger.log_types=["debug","debug","info","warn","error"],Logger}();e.Logger=t;var o=function(){function Util(){}return Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},Util.getPropertyOrElse=function(e,t,o){return e.hasOwnProperty(t)?e[t]:o},Util}();e.Util=o}(e.Common||(e.Common={}))}(Exitgames||(Exitgames={})),function(e){var t;!function(e){e[e.Ws=0]="Ws",e[e.Wss=1]="Wss"}(t=e.ConnectionProtocol||(e.ConnectionProtocol={})),function(e){e[e.None=0]="None",e[e.Byte=1]="Byte",e[e.Short=2]="Short",e[e.Int=3]="Int",e[e.Long=4]="Long",e[e.Float=5]="Float",e[e.Double=6]="Double",e[e.String=7]="String",e[e.Bool=8]="Bool",e[e.Table=9]="Table",e[e.Dict=10]="Dict",e[e.Object=11]="Object"}(e.TypeExtType||(e.TypeExtType={}));var o=function(){function TypeExt(){}return TypeExt.Is=function(e){return!1},TypeExt.Byte=function(e){return e},TypeExt.Short=function(e){return e},TypeExt.Int=function(e){return e},TypeExt.Long=function(e){return e},TypeExt.Float=function(e){return e},TypeExt.Double=function(e){return e},TypeExt.String=function(e){return e},TypeExt.Bool=function(e){return e},TypeExt.Dict=function(e,t,o){return o},TypeExt.TableTypedKeys=function(){return{}},TypeExt.DictTypedKeys=function(e,t){return{}},TypeExt.PutTypedKey=function(e,t,o){e[t]=o},TypeExt}();e.TypeExt=o;var n=function(){function PhotonPeer(e,t,o,n){void 0===o&&(o=""),void 0===n&&(n=""),this.protocol=e,this.address=t,this.subprotocol=o,this.keepAliveTimeoutMs=3e3,this._frame="~m~",this._isConnecting=!1,this._isConnected=!1,this._isClosing=!1,this._peerStatusListeners={},this._eventListeners={},this._responseListeners={},this.lastRtt=0,this.initTimestamp=Date.now(),this.keepAliveTimer=0,this.url=this.addProtocolPrefix(this.address,this.protocol),this._logger=new Exitgames.Common.Logger(n&&""!=n?n+":":"")}return PhotonPeer.prototype.addProtocolPrefix=function(e,o){var n={ws:"ws://",wss:"wss://"};for(var r in n)if(0==e.indexOf(n[r]))return e;switch(o){case t.Ws:return n.ws+e;case t.Wss:return n.wss+e;default:return n.ws+e}},PhotonPeer.prototype.Destroy=function(){},PhotonPeer.prototype.isConnecting=function(){return this._isConnecting},PhotonPeer.prototype.getLastRtt=function(){return this.lastRtt},PhotonPeer.prototype.isConnected=function(){return this._isConnected},PhotonPeer.prototype.isClosing=function(){return this._isClosing},PhotonPeer.prototype.connect=function(e){var t=this;this._sessionid=void 0;var o=this.url+"/"+e+"?libversion=4.1.0.0";""==this.subprotocol?this._socket=new WebSocket(o,"Json"):this._socket=new WebSocket(o,this.subprotocol),this._onConnecting(),this._socket.onopen=function(e){},this._socket.onmessage=function(e){var o=t._decode(e.data);t._onMessage(o.toString())},this._socket.onclose=function(e){t._logger.debug("onclose: wasClean =",e.wasClean,", code=",e.code,", reason =",e.reason),t._isConnecting?t._onConnectFailed(e):(1006==e.code&&t._onTimeout(),t._onDisconnect())},this._socket.onerror=function(e){t._onError(e)}},PhotonPeer.prototype.disconnect=function(){this._isClosing=!0,this._socket&&this._socket.close()},PhotonPeer.prototype.sendOperation=function(e,t,o,n){void 0===o&&(o=!1),void 0===n&&(n=0);var r={req:e,vals:[]};Exitgames.Common.Util.isArray(t)?r.vals=t:void 0===t?r.vals=[]:this._logger.exception(201,"PhotonPeer[sendOperation] - Trying to send non array data:",t),this._send(r),this._logger.debug("PhotonPeer[sendOperation] - Sending request:",r)},PhotonPeer.prototype.addPeerStatusListener=function(e,t){this._addListener(this._peerStatusListeners,e,t)},PhotonPeer.prototype.addEventListener=function(e,t){this._addListener(this._eventListeners,e.toString(),t)},PhotonPeer.prototype.addResponseListener=function(e,t){this._addListener(this._responseListeners,e.toString(),t)},PhotonPeer.prototype.removePeerStatusListener=function(e,t){this._removeListener(this._peerStatusListeners,e,t)},PhotonPeer.prototype.removeEventListener=function(e,t){this._removeListener(this._eventListeners,e.toString(),t)},PhotonPeer.prototype.removeResponseListener=function(e,t){this._removeListener(this._responseListeners,e.toString(),t)},PhotonPeer.prototype.removePeerStatusListenersForCode=function(e){this._removeListenersForCode(this._peerStatusListeners,e)},PhotonPeer.prototype.removeEventListenersForCode=function(e){this._removeListenersForCode(this._eventListeners,e.toString())},PhotonPeer.prototype.removeResponseListenersForCode=function(e){this._removeListenersForCode(this._responseListeners,e.toString())},PhotonPeer.prototype.setLogLevel=function(e){this._logger.setLevel(e)},PhotonPeer.prototype.onUnhandledEvent=function(e,t){this._logger.warn("PhotonPeer: No handler for event",e,"registered.")},PhotonPeer.prototype.onUnhandledResponse=function(e,t){this._logger.warn("PhotonPeer: No handler for response",e,"registered.")},PhotonPeer.prototype._dispatchEvent=function(e,t){this._dispatch(this._eventListeners,e.toString(),t,"event")||this.onUnhandledEvent(e,t)},PhotonPeer.prototype._dispatchResponse=function(e,t){this._dispatch(this._responseListeners,e.toString(),t,"response")||this.onUnhandledResponse(e,t)},PhotonPeer.prototype._stringify=function(e){return"[object Object]"==Object.prototype.toString.call(e)?(JSON||this._logger.exception(202,"PhotonPeer[_stringify] - Trying to encode as JSON, but JSON.stringify is missing."),"~j~"+JSON.stringify(e)):String(e)},PhotonPeer.prototype._encode=function(e){for(var t,o="",n=0,r=(e=Exitgames.Common.Util.isArray(e)?e:[e]).length;n<r;n++)t=null===e[n]||void 0===e[n]?"":this._stringify(e[n]),o+=this._frame+t.length+this._frame+t;return o},PhotonPeer.prototype._decode=function(e){var t,o,n=[],r=e;-1!==e.indexOf("\0")&&(r=e.replace(/[\0]/g,"")),e=r;do{if(e.substr(0,3)!==this._frame)return n;t="",o="";for(var s=0,a=(e=e.substr(3)).length;s<a;s++){if(o=Number(e.substr(s,1)),e.substr(s,1)!=o){e=e.substr(t.length+this._frame.length),t=Number(t);break}t+=o}n.push(e.substr(0,t)),e=e.substr(t)}while(""!==e);return n},PhotonPeer.prototype._onMessage=function(e){"~j~"==e.substr(0,3)?this._onMessageReceived(JSON.parse(e.substr(3))):this._sessionid?this._onMessageReceived(e):(this._sessionid=e,this._onConnect())},PhotonPeer.prototype.resetKeepAlive=function(){var e=this;clearTimeout(this.keepAliveTimer),this.keepAliveTimeoutMs>=1e3&&(this.keepAliveTimer=setTimeout((function(){var t;e._send(((t={}).irq=1,t.vals=[1,Date.now()-e.initTimestamp],t),!0)}),this.keepAliveTimeoutMs))},PhotonPeer.prototype._send=function(e,t){void 0===t&&(t=!1);var o=this._encode(e);this._socket&&this._isConnected&&!this._isClosing?(this.resetKeepAlive(),this._socket.send(o)):t||this._logger.exception(203,"PhotonPeer[_send] - Operation",e.req,'- failed, "isConnected" is',this._isConnected,', "isClosing" is',this._isClosing,"!")},PhotonPeer.prototype._onMessageReceived=function(e){if("object"==typeof e){this._logger.debug("PhotonPeer[_onMessageReceived] - Socket received message:",e);var t={err:e.err,msg:e.msg,vals:e.vals,res:e.res,evt:e.evt,irs:e.irs};t.err&&t.err;if(t.vals=void 0!==t.vals?t.vals:[],t.vals.length>0&&(t.vals=this._parseMessageValuesArrayToJSON(t.vals)),void 0!==t.res){var o=parseInt(t.res);this._parseResponse(o,t)}else if(void 0!==t.evt){o=parseInt(t.evt);this._parseEvent(o,t)}else if(void 0!==t.irs){o=parseInt(t.irs);this._parseInternalResponse(o,t)}else this._logger.exception(204,"PhotonPeer[_onMessageReceived] - Received undefined message type:",t)}},PhotonPeer.prototype._parseMessageValuesArrayToJSON=function(e){var t={};if(Exitgames.Common.Util.isArray(e))if(e.length%2==0)for(var o,n,r=e;r.length>0;)o=r.shift()+"",n=r.shift(),t[o]=n;else this._logger.exception(205,"PhotonPeer[_parseMessageValuesToJSON] - Received invalid values array:",e);return t},PhotonPeer.prototype._parseEvent=function(e,t){this._dispatchEvent(e,{vals:t.vals})},PhotonPeer.prototype._parseResponse=function(e,t){this._dispatchResponse(e,{errCode:t.err,errMsg:t.msg,vals:t.vals})},PhotonPeer.prototype._parseInternalResponse=function(e,t){this.lastRtt=Date.now()-this.initTimestamp-t.vals[1],this._logger.debug("internal response:",t)},PhotonPeer.prototype._onConnecting=function(){this._logger.debug("PhotonPeer[_onConnecting] - Starts connecting",this.url,'..., raising "connecting" event ...'),this._isConnecting=!0,this._dispatchPeerStatus(PhotonPeer.StatusCodes.connecting),this.resetKeepAlive()},PhotonPeer.prototype._onConnect=function(){this._logger.debug('PhotonPeer[_onConnect] - Connected successfully! Raising "connect" event ...'),this._isConnecting=!1,this._isConnected=!0,this._dispatchPeerStatus(PhotonPeer.StatusCodes.connect),this.resetKeepAlive()},PhotonPeer.prototype._onConnectFailed=function(e){this._logger.error("PhotonPeer[_onConnectFailed] - Socket connection could not be created:",this.url,this.subprotocol,'Wrong host or port?\n Raising "connectFailed event ...'),this._isConnecting=this._isConnected=!1,this._dispatchPeerStatus(PhotonPeer.StatusCodes.connectFailed)},PhotonPeer.prototype._onDisconnect=function(){var e=this._isConnected,t=this._isClosing;this._logger.debug('PhotonPeer[_onDisconnect] - Socket closed, raising "disconnect" event ...'),this._isClosing=this._isConnected=this._isConnecting=!1,e&&(t?this._dispatchPeerStatus(PhotonPeer.StatusCodes.disconnect):this._dispatchPeerStatus(PhotonPeer.StatusCodes.connectClosed))},PhotonPeer.prototype._onTimeout=function(){this._logger.debug('PhotonPeer[_onTimeout] - Client timed out! Raising "timeout" event ...'),this._dispatchPeerStatus(PhotonPeer.StatusCodes.timeout)},PhotonPeer.prototype._onError=function(e){this._logger.error("PhotonPeer[_onError] - Connection error:",arguments[0]),this._isConnecting=this._isConnected=this._isClosing=!1,this._dispatchPeerStatus(PhotonPeer.StatusCodes.error)},PhotonPeer.prototype._addListener=function(e,t,o){return t in e||(e[t]=[]),o&&"function"==typeof o?(this._logger.debug("PhotonPeer[_addListener] - Adding listener for event",t),e[t].push(o)):this._logger.error("PhotonPeer[_addListener] - Listener",t,"is not a function but of type",typeof o,". No listener added!"),this},PhotonPeer.prototype._dispatch=function(e,t,o,n){if(t in e){for(var r=e[t],s=0,a=r.length;s<a;s++)Exitgames.Common.Util.isArray(o)||(o=[o]),r[s].apply(this,void 0===o?[]:o);return!0}return!1},PhotonPeer.prototype._dispatchPeerStatus=function(e){this._dispatch(this._peerStatusListeners,e,void 0,"peerStatus")||this._logger.warn("PhotonPeer[_dispatchPeerStatus] - No handler for ",e,"registered.")},PhotonPeer.prototype._removeListener=function(e,t,o){if(t in e){var n=e[t].length;e[t]=e[t].filter((function(e){return e!=o})),this._logger.debug("PhotonPeer[_removeListener] - Removing listener for event",t,"removed:",n-e[t].length)}return this},PhotonPeer.prototype._removeListenersForCode=function(e,t){return this._logger.debug("PhotonPeer[_removeListenersForCode] - Removing all listeners for event",t),t in e&&(e[t]=[]),this},PhotonPeer.StatusCodes={connecting:"connecting",connect:"connect",connectFailed:"connectFailed",disconnect:"disconnect",connectClosed:"connectClosed",error:"error",timeout:"timeout"},PhotonPeer}();e.PhotonPeer=n}(Photon||(Photon={})),function(e){!function(t){var o,n=1,r=2,s=function(){function Actor(e,t,o){this.name=e,this.actorNr=t,this.isLocal=o,this.userId="",this.customProperties={},this.suspended=!1}return Actor.prototype.getRoom=function(){return this.loadBalancingClient?this.loadBalancingClient.myRoom():null},Actor.prototype.raiseEvent=function(e,t,o){this.loadBalancingClient&&this.loadBalancingClient.raiseEvent(e,t,o)},Actor.prototype.setProp=function(e,t,o){if(void 0===o&&(o=void 0),this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()){var n={};n[e]=t;var r={};return r[e]=o,this.loadBalancingClient._setPropertiesOfActor(this.actorNr,n,!1,r),null==o}return!0},Actor.prototype.setName=function(e){this.name!=e&&this.setProp(t.Constants.ActorProperties.PlayerName,e,this.name)&&(this.name=e)},Actor.prototype.onPropertiesChange=function(e,t){},Actor.prototype.getCustomProperty=function(e){return this.customProperties[e]},Actor.prototype.getCustomPropertyOrElse=function(e,t){return Exitgames.Common.Util.getPropertyOrElse(this.customProperties,e,t)},Actor.prototype.setCustomProperty=function(e,t,o,n){var r;void 0===o&&(o=!1),this.customProperties[e]=t;var s,a={};a[e]=t,null!=n&&((r={})[e]=n,s=r),this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()&&this.loadBalancingClient._setPropertiesOfActor(this.actorNr,a,o,s),this.onPropertiesChange(a,!0)},Actor.prototype.setCustomProperties=function(e,t,o){void 0===t&&(t=!1);var n={};for(var r in e)this.customProperties[r]=e[r],n[r]=e[r];this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()&&this.loadBalancingClient._setPropertiesOfActor(this.actorNr,n,t,o),this.onPropertiesChange(n,!0)},Actor.prototype.isSuspended=function(){return this.suspended},Actor.prototype._getAllProperties=function(){var e={};for(var o in e[t.Constants.ActorProperties.PlayerName]=this.name,this.customProperties)e[o]=this.customProperties[o];return e},Actor.prototype._setLBC=function(e){this.loadBalancingClient=e},Actor.prototype.getCustomProperties=function(){var e={};for(var t in this.customProperties)e[t]=this.customProperties[t];return e},Actor.prototype._updateFromResponse=function(e){this.actorNr=e[t.Constants.ParameterCode.ActorNr];var o=e[t.Constants.ParameterCode.PlayerProperties];if(void 0!==o){var n=o[t.Constants.ActorProperties.PlayerName];void 0!==n&&(this.name=n);var r=o[t.Constants.ActorProperties.UserId];void 0!==r&&(this.userId=r),this._updateFromProps(o)}},Actor.prototype._updateMyActorFromResponse=function(e){this.actorNr=e[t.Constants.ParameterCode.ActorNr]},Actor.prototype.updateIfExists=function(e,t,o){return o.hasOwnProperty(t)?o[t]:e},Actor.prototype._updateFromProps=function(e){if(e){this.name=this.updateIfExists(this.name,t.Constants.ActorProperties.PlayerName,e);var o={};for(var n in e)parseInt(n).toString()!=n&&this.customProperties[n]!==e[n]&&(this.customProperties[n]=e[n],o[n]=e[n]);this.onPropertiesChange(o,!1)}},Actor.prototype._setSuspended=function(e){this.suspended=e},Actor._getActorNrFromResponse=function(e){return e[t.Constants.ParameterCode.ActorNr]},Actor}();t.Actor=s;var a=function(){function RoomInfo(e){this.name="",this.address="",this.maxPlayers=0,this.isVisible=!0,this.isOpen=!0,this.playerCount=0,this.emptyRoomLiveTime=0,this.suspendedPlayerLiveTime=0,this.removed=!1,this.cleanupCacheOnLeave=!1,this.masterClientId=0,this._customProperties={},this._propsListedInLobby=[],this.name=e}return RoomInfo.prototype.getCustomProperties=function(){var e={};for(var t in this._customProperties)e[t]=this._customProperties[t];return e},RoomInfo.prototype.getPropsListedInLobby=function(){var e=[];for(var t in this._propsListedInLobby)e[t]=this._propsListedInLobby[t];return e},RoomInfo.prototype.onPropertiesChange=function(e,t){},RoomInfo.prototype.getCustomProperty=function(e){return this._customProperties[e]},RoomInfo.prototype.getCustomPropertyOrElse=function(e,t){return Exitgames.Common.Util.getPropertyOrElse(this._customProperties,e,t)},RoomInfo.prototype._updateFromMasterResponse=function(e){this.address=e[t.Constants.ParameterCode.Address];var o=e[t.Constants.ParameterCode.RoomName];o&&(this.name=o)},RoomInfo.prototype._updateFromProps=function(e){if(e){this.maxPlayers=this.updateIfExists(this.maxPlayers,t.Constants.GameProperties.MaxPlayers,e),this.isVisible=this.updateIfExists(this.isVisible,t.Constants.GameProperties.IsVisible,e),this.isOpen=this.updateIfExists(this.isOpen,t.Constants.GameProperties.IsOpen,e),this.playerCount=this.updateIfExists(this.playerCount,t.Constants.GameProperties.PlayerCount,e),this.removed=this.updateIfExists(this.removed,t.Constants.GameProperties.Removed,e),this._propsListedInLobby=this.updateIfExists(this._propsListedInLobby,t.Constants.GameProperties.PropsListedInLobby,e),this.cleanupCacheOnLeave=this.updateIfExists(this.cleanupCacheOnLeave,t.Constants.GameProperties.CleanupCacheOnLeave,e),this.masterClientId=this.updateIfExists(this.masterClientId,t.Constants.GameProperties.MasterClientId,e),this.emptyRoomLiveTime=this.updateIfExists(this.emptyRoomLiveTime,t.Constants.GameProperties.EmptyRoomTtl,e),this.suspendedPlayerLiveTime=this.updateIfExists(this.suspendedPlayerLiveTime,t.Constants.GameProperties.PlayerTtl,e),this.expectedUsers=this.updateIfExists(this.suspendedPlayerLiveTime,t.Constants.GameProperties.ExpectedUsers,e);var o={};for(var n in e)parseInt(n).toString()!=n&&this._customProperties[n]!==e[n]&&(this._customProperties[n]=e[n],o[n]=e[n]);this.onPropertiesChange(o,!1)}},RoomInfo.prototype._updateFromEvent=function(e){e&&(this.masterClientId=this.updateIfExists(this.masterClientId,t.Constants.ParameterCode.MasterClientId,e))},RoomInfo.prototype.updateIfExists=function(e,t,o){return o.hasOwnProperty(t)?o[t]:e},RoomInfo}();t.RoomInfo=a;var i=function(e){function Room(t){return e.call(this,t)||this}return __extends(Room,e),Room.prototype.setCustomProperty=function(e,t,o,n){var r;void 0===o&&(o=!1),this._customProperties[e]=t;var s,a={};a[e]=t,null!=n&&((r={})[e]=n,s=r),this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()&&this.loadBalancingClient._setPropertiesOfRoom(a,o,s),this.onPropertiesChange(a,!0)},Room.prototype.setCustomProperties=function(e,t,o){void 0===t&&(t=!1);var n={};for(var r in e)this._customProperties[r]=e[r],n[r]=e[r];this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()&&this.loadBalancingClient._setPropertiesOfRoom(n,t,o),this.onPropertiesChange(n,!0)},Room.prototype.setProp=function(e,t,o){if(void 0===o&&(o=void 0),this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()){var n={};n[e]=t;var r={};return r[e]=o,this.loadBalancingClient._setPropertiesOfRoom(n,!1,r),null==o}return!0},Room.prototype.setIsVisible=function(e){this.isVisible!=e&&this.setProp(t.Constants.GameProperties.IsVisible,e,this.isVisible)&&(this.isVisible=e)},Room.prototype.setIsOpen=function(e){this.isOpen!=e&&this.setProp(t.Constants.GameProperties.IsOpen,e,this.isOpen)&&(this.isOpen=e)},Room.prototype.setMaxPlayers=function(e){this.maxPlayers!=e&&this.setProp(t.Constants.GameProperties.MaxPlayers,e,this.maxPlayers)&&(this.maxPlayers=e)},Room.prototype.setEmptyRoomLiveTime=function(e){this.emptyRoomLiveTime!=e&&this.setProp(t.Constants.GameProperties.EmptyRoomTtl,e,this.emptyRoomLiveTime)&&(this.emptyRoomLiveTime=e)},Room.prototype.setSuspendedPlayerLiveTime=function(e){this.suspendedPlayerLiveTime!=e&&this.setProp(t.Constants.GameProperties.PlayerTtl,e,this.suspendedPlayerLiveTime)&&(this.suspendedPlayerLiveTime=e)},Room.prototype.setPlugins=function(e){this.plugins=e},Room.prototype.setPropsListedInLobby=function(e){this._propsListedInLobby=e},Room.prototype.setExpectedUsers=function(e){this.setProp(t.Constants.GameProperties.ExpectedUsers,e,this.expectedUsers)&&(this.expectedUsers=e)},Room.prototype.clearExpectedUsers=function(){var e=[];this.setProp(t.Constants.GameProperties.ExpectedUsers,e,this.expectedUsers)&&(this.expectedUsers=e)},Room.prototype.setMasterClient=function(e){this.setProp(t.Constants.GameProperties.MasterClientId,e,this.masterClientId)&&(this.masterClientId=e)},Room.prototype._setLBC=function(e){this.loadBalancingClient=e},Room}(a);t.Room=i;var c=function(){function LoadBalancingClient(o,n,r){this.appId=n,this.appVersion=r,this.connectionProtocol=0,this.masterServerAddress="",this.nameServerAddress="",this.gamePeerWaitingForDisconnect=!1,this.autoJoinLobby=!0,this.connectOptions={},this.createRoomOptions={},this.joinRoomOptions={},this.roomInfos=new Array,this.roomInfosDict={},this.actors={},this.actorsArray=[],this.lowestActorId=0,this.userId="",this.userAuthType=t.Constants.CustomAuthenticationType.None,this.userAuthParameters="",this.userAuthData="",this.findFriendsRequestList=[],this.lobbyStatsRequestList=new Array,this.state=LoadBalancingClient.State.Uninitialized,this.logger=new Exitgames.Common.Logger("Client:"),this.validNextState={};if("number"==typeof o)switch(this.connectionProtocol=o,o){case e.ConnectionProtocol.Ws:this.masterServerAddress="ws://app-eu.exitgamescloud.com:9090",this.nameServerAddress="ws://ns.exitgames.com:9093";break;case e.ConnectionProtocol.Wss:this.masterServerAddress="wss://app-eu.exitgamescloud.com:19090",this.nameServerAddress="wss://ns.exitgames.com:19093";break;default:var s="wrong_protocol_error";this.masterServerAddress=s,this.nameServerAddress=s,this.logger.error("Wrong protocol: ",o)}else if("string"==typeof o){this.connectionProtocol=e.ConnectionProtocol.Ws;var a=o;this.masterServerAddress=a,this.nameServerAddress=a}else{this.connectionProtocol=e.ConnectionProtocol.Ws;var i="wrong_protocol_type_error";this.masterServerAddress=i,this.nameServerAddress=i,this.logger.error("Wrong protocol type: ",typeof o)}this.initValidNextState(),this.currentRoom=this.roomFactoryInternal(""),this._myActor=this.actorFactoryInternal("",-1,!0),this.addActor(this._myActor)}return LoadBalancingClient.prototype.onStateChange=function(e){},LoadBalancingClient.prototype.onError=function(e,t){},LoadBalancingClient.prototype.onOperationResponse=function(e,t,o,n){},LoadBalancingClient.prototype.onEvent=function(e,t,o){},LoadBalancingClient.prototype.onRoomList=function(e){},LoadBalancingClient.prototype.onRoomListUpdate=function(e,t,o,n){},LoadBalancingClient.prototype.onMyRoomPropertiesChange=function(){},LoadBalancingClient.prototype.onActorPropertiesChange=function(e){},LoadBalancingClient.prototype.onJoinRoom=function(e){},LoadBalancingClient.prototype.onActorJoin=function(e){},LoadBalancingClient.prototype.onActorLeave=function(e,t){},LoadBalancingClient.prototype.onActorSuspend=function(e){},LoadBalancingClient.prototype.onFindFriendsResult=function(e,t,o){},LoadBalancingClient.prototype.onLobbyStats=function(e,t,o){},LoadBalancingClient.prototype.onAppStats=function(e,t,o){},LoadBalancingClient.prototype.onGetRegionsResult=function(e,t,o){},LoadBalancingClient.prototype.onWebRpcResult=function(e,t,o,n,r){},LoadBalancingClient.prototype.roomFactory=function(e){return new i(e)},LoadBalancingClient.prototype.actorFactory=function(e,t,o){return new s(e,t,o)},LoadBalancingClient.prototype.myActor=function(){return this._myActor},LoadBalancingClient.prototype.myRoom=function(){return this.currentRoom},LoadBalancingClient.prototype.myRoomActors=function(){return this.actors},LoadBalancingClient.prototype.myRoomActorCount=function(){return this.actorsArray.length},LoadBalancingClient.prototype.myRoomActorsArray=function(){return this.actorsArray},LoadBalancingClient.prototype.myRoomMasterActorNr=function(){return this.myRoom().masterClientId?this.myRoom().masterClientId:this.lowestActorId},LoadBalancingClient.prototype.lastRtt=function(){return this.gamePeer?this.gamePeer.getLastRtt():0},LoadBalancingClient.prototype.roomFactoryInternal=function(e){void 0===e&&(e="");var t=this.roomFactory(e);return t._setLBC(this),t},LoadBalancingClient.prototype.actorFactoryInternal=function(e,t,o){void 0===e&&(e=""),void 0===t&&(t=-1),void 0===o&&(o=!1);var n=this.actorFactory(e,t,o);return n._setLBC(this),n},LoadBalancingClient.prototype.setNameServerAddress=function(e){this.nameServerAddress=e},LoadBalancingClient.prototype.getNameServerAddress=function(){return this.nameServerAddress},LoadBalancingClient.prototype.setMasterServerAddress=function(e){this.masterServerAddress=e},LoadBalancingClient.prototype.getMasterServerAddress=function(){return this.nameServerAddress},LoadBalancingClient.prototype.setUserId=function(e){this.userId=e},LoadBalancingClient.prototype.getUserId=function(){return this.userId},LoadBalancingClient.prototype.setCustomAuthentication=function(t,o,n){void 0===o&&(o=e.LoadBalancing.Constants.CustomAuthenticationType.Custom),this.userAuthType=o,this.userAuthParameters=t,this.userAuthData=n},LoadBalancingClient.prototype.connect=function(e){if("boolean"==typeof e&&(e=e?{keepMasterConnection:!0}:{keepMasterConnection:!1}),e||(e={}),this.checkNextState(LoadBalancingClient.State.ConnectingToMasterserver,!0)){for(var t in this.changeState(LoadBalancingClient.State.ConnectingToMasterserver),this.logger.info("Connecting to Master",this.masterServerAddress),this.connectOptions={},e)this.connectOptions[t]=e[t];return this.masterPeer&&this.masterPeer.Destroy(),this.masterPeer=new l(this,this.connectionProtocol,this.masterServerAddress,""),this.initMasterPeer(this.masterPeer),this.masterPeer.connect(this.appId),!0}return!1},LoadBalancingClient.prototype.connectToNameServer=function(e){if(e||(e={}),this.checkNextState(LoadBalancingClient.State.ConnectingToNameServer,!0)){for(var t in this.changeState(LoadBalancingClient.State.ConnectingToNameServer),this.logger.info("Connecting to NameServer",this.nameServerAddress),this.connectOptions={},e)this.connectOptions[t]=e[t];return this.nameServerPeer&&this.nameServerPeer.Destroy(),this.nameServerPeer=new p(this,this.connectionProtocol,this.nameServerAddress,""),this.initNameServerPeer(this.nameServerPeer),this.nameServerPeer.connect(this.appId),!0}return!1},LoadBalancingClient.prototype.fillCreateRoomOptions=function(o,n){var r={};if(void 0!==(n=n||{}).isVisible&&(r[t.Constants.GameProperties.IsVisible]=n.isVisible),void 0!==n.isOpen&&(r[t.Constants.GameProperties.IsOpen]=n.isOpen),void 0!==n.maxPlayers&&(r[t.Constants.GameProperties.MaxPlayers]=n.maxPlayers),void 0!==n.propsListedInLobby&&(r[t.Constants.GameProperties.PropsListedInLobby]=e.TypeExt.String(n.propsListedInLobby)),void 0!==n.customGameProperties)for(var s in n.customGameProperties)r[s]=n.customGameProperties[s];o.push(t.Constants.ParameterCode.GameProperties,r),o.push(t.Constants.ParameterCode.CleanupCacheOnLeave,!0),o.push(t.Constants.ParameterCode.Broadcast,!0),void 0!==n.emptyRoomLiveTime&&o.push(t.Constants.ParameterCode.EmptyRoomTTL,e.TypeExt.Int(n.emptyRoomLiveTime)),void 0!==n.suspendedPlayerLiveTime&&o.push(t.Constants.ParameterCode.PlayerTTL,e.TypeExt.Int(n.suspendedPlayerLiveTime)),void 0!==n.plugins&&o.push(t.Constants.ParameterCode.Plugins,e.TypeExt.String(n.plugins)),o.push(t.Constants.ParameterCode.CheckUserOnJoin,!0),o.push(t.Constants.ParameterCode.PublishUserId,!0),n.lobbyName&&(o.push(t.Constants.ParameterCode.LobbyName),o.push(n.lobbyName),null!=n.lobbyType&&(o.push(t.Constants.ParameterCode.LobbyType),o.push(n.lobbyType))),n.expectedUsers&&o.push(t.Constants.ParameterCode.Add,n.expectedUsers)},LoadBalancingClient.prototype.createRoomFromMy=function(e,t){this.currentRoom.name=e||"",t=this.copyCreateOptionsFromMyRoom(t),this.masterPeer&&this.createRoomInternal(this.masterPeer,t)},LoadBalancingClient.prototype.copyCreateOptionsFromMyRoom=function(e){return(e=e||{}).isVisible=this.currentRoom.isVisible,e.isOpen=this.currentRoom.isOpen,e.maxPlayers=this.currentRoom.maxPlayers,e.customGameProperties=this.currentRoom.getCustomProperties(),e.propsListedInLobby=this.currentRoom.getPropsListedInLobby(),e.emptyRoomLiveTime=this.currentRoom.emptyRoomLiveTime,e.suspendedPlayerLiveTime=this.currentRoom.suspendedPlayerLiveTime,e.plugins=this.currentRoom.plugins,e.expectedUsers=this.currentRoom.expectedUsers,e},LoadBalancingClient.prototype.createRoom=function(e,t){if(this.currentRoom=this.roomFactoryInternal(e||""),this.masterPeer)return this.createRoomInternal(this.masterPeer,t)},LoadBalancingClient.prototype.joinRoom=function(e,o,n){if(!this.masterPeer)return!1;var r=[];return o&&(o.createIfNotExists&&(r.push(t.Constants.ParameterCode.JoinMode,LoadBalancingClient.JoinMode.CreateIfNotExists),this.fillCreateRoomOptions(r,n)),o.rejoin&&r.push(t.Constants.ParameterCode.JoinMode,LoadBalancingClient.JoinMode.RejoinOnly),o.expectedUsers&&r.push(t.Constants.ParameterCode.Add,o.expectedUsers)),this.currentRoom=this.roomFactoryInternal(e),r.push(t.Constants.ParameterCode.RoomName,e),this.joinRoomOptions=o||{},this.createRoomOptions=n||{},this.logger.info("Join Room",e,o,n,"..."),this.masterPeer.sendOperation(t.Constants.OperationCode.JoinGame,r),!0},LoadBalancingClient.prototype.joinRandomRoom=function(e){if(!this.masterPeer)return!1;var o=[];if(e){null!=e.matchingType&&e.matchingType!=t.Constants.MatchmakingMode.FillRoom&&(o.push(t.Constants.ParameterCode.MatchMakingType),o.push(e.matchingType));var n={},r=!1;if(null!=e.expectedCustomRoomProperties)for(var s in e.expectedCustomRoomProperties)n[s]=e.expectedCustomRoomProperties[s],r=!0;null!=e.expectedMaxPlayers&&e.expectedMaxPlayers>0&&(n[t.Constants.GameProperties.MaxPlayers]=e.expectedMaxPlayers,r=!0),r&&(o.push(t.Constants.ParameterCode.GameProperties),o.push(n)),e.lobbyName&&(o.push(t.Constants.ParameterCode.LobbyName),o.push(e.lobbyName),null!=e.lobbyType&&(o.push(t.Constants.ParameterCode.LobbyType),o.push(e.lobbyType))),e.sqlLobbyFilter&&(o.push(t.Constants.ParameterCode.Data),o.push(e.sqlLobbyFilter)),e.expectedUsers&&o.push(t.Constants.ParameterCode.Add,e.expectedUsers)}return this.logger.info("Join Random Room",e&&e.lobbyName,e&&e.lobbyType,"..."),this.masterPeer.sendOperation(t.Constants.OperationCode.JoinRandomGame,o),!0},LoadBalancingClient.prototype._setPropertiesOfRoom=function(o,r,s){if(this.gamePeer){var a=[];a.push(t.Constants.ParameterCode.Properties),a.push(o),a.push(t.Constants.ParameterCode.Broadcast),a.push(!0),r&&(a.push(t.Constants.ParameterCode.WebFlags),a.push(e.TypeExt.Byte(n))),s&&(a.push(t.Constants.ParameterCode.ExpectedValues),a.push(s)),this.gamePeer.sendOperation(t.Constants.OperationCode.SetProperties,a)}},LoadBalancingClient.prototype._setPropertiesOfActor=function(o,r,s,a){if(this.gamePeer){var i=[];i.push(t.Constants.ParameterCode.ActorNr),i.push(e.TypeExt.Int(o)),i.push(t.Constants.ParameterCode.Properties),i.push(r),i.push(t.Constants.ParameterCode.Broadcast),i.push(!0),s&&(i.push(t.Constants.ParameterCode.WebFlags),i.push(e.TypeExt.Byte(n))),a&&(i.push(t.Constants.ParameterCode.ExpectedValues),i.push(a)),this.gamePeer.sendOperation(t.Constants.OperationCode.SetProperties,i)}},LoadBalancingClient.prototype.disconnect=function(){this.nameServerPeer&&this.nameServerPeer.disconnect(),this._cleanupNameServerPeerData(),this.masterPeer&&this.masterPeer.disconnect(),this._cleanupMasterPeerData(),this.gamePeer&&this.gamePeer.disconnect(),this._cleanupGamePeerData(),this.changeState(LoadBalancingClient.State.Disconnected)},LoadBalancingClient.prototype.suspendRoom=function(o){if(this.isJoinedToRoom()){if(this.gamePeer){var n=[];o&&o.sendAuthCookie&&n.push(t.Constants.ParameterCode.WebFlags,e.TypeExt.Byte(r)),n.push(t.Constants.ParameterCode.IsInactive,!0),this.gamePeer.sendOperation(t.Constants.OperationCode.Leave,n),this.gamePeerWaitingForDisconnect=!0}this._cleanupGamePeerData(),this.isConnectedToMaster()?this.changeState(LoadBalancingClient.State.JoinedLobby):(this.changeState(LoadBalancingClient.State.Disconnected),this.connect(this.connectOptions))}},LoadBalancingClient.prototype.leaveRoom=function(o){if(this.isJoinedToRoom()){if(this.gamePeer){var n=[];o&&o.sendAuthCookie&&n.push(t.Constants.ParameterCode.WebFlags,e.TypeExt.Byte(r)),this.gamePeer.sendOperation(t.Constants.OperationCode.Leave,n),this.gamePeerWaitingForDisconnect=!0}this._cleanupGamePeerData(),this.isConnectedToMaster()?this.changeState(LoadBalancingClient.State.JoinedLobby):(this.changeState(LoadBalancingClient.State.Disconnected),this.connect(this.connectOptions))}},LoadBalancingClient.prototype.raiseEvent=function(e,t,o){this.gamePeer&&this.isJoinedToRoom()&&this.gamePeer.raiseEvent(e,t,o)},LoadBalancingClient.prototype.changeGroups=function(e,t){this.gamePeer&&this.isJoinedToRoom()&&(this.logger.debug("Group change:",e,t),this.gamePeer.changeGroups(e,t))},LoadBalancingClient.prototype.findFriends=function(e){if(this.masterPeer&&this.isConnectedToMaster())if(e&&"object"==typeof e){this.findFriendsRequestList=new Array;for(var t=0;t<e.length;++t){if("string"!=typeof e[t])return this.logger.error("FindFriends request error:","Friend name is not a string",t),void this.onFindFriendsResult(-1,"Friend name is not a string "+t,{});this.findFriendsRequestList[t]=e[t]}this.logger.debug("Find friends:",e),this.masterPeer.findFriends(this.findFriendsRequestList)}else this.logger.error("FindFriends request error:","Parameter is not an array"),this.onFindFriendsResult(-1,"Parameter is not an array",{});else this.logger.error("FindFriends request error:","Not connected to Master"),this.onFindFriendsResult(LoadBalancingClient.PeerErrorCode.MasterError,"Not connected to Master",{})},LoadBalancingClient.prototype.requestLobbyStats=function(e){if(this.masterPeer&&this.isConnectedToMaster()){if(this.lobbyStatsRequestList=new Array,e){if("object"!=typeof e)return void this.requestLobbyStatsErr("Parameter is not an array");for(var o=0;o<e.length;++o){var n=e[o];if("object"!=typeof n)return void this.requestLobbyStatsErr("Lobby id is not an array",o);var r,s=n[0];if(!s)return void this.requestLobbyStatsErr("Lobby name is empty",o);if(void 0===n[1])r=t.Constants.LobbyType.Default;else{if("number"!=typeof n[1])return void this.requestLobbyStatsErr("Lobby type is invalid",o);r=n[1]}this.lobbyStatsRequestList[o]=[s.toString(),r]}}this.masterPeer.requestLobbyStats(this.lobbyStatsRequestList)}else this.logger.error("LobbyState request error:","Not connected to Master"),this.onLobbyStats(LoadBalancingClient.PeerErrorCode.MasterError,"Not connected to Master",[])},LoadBalancingClient.prototype.requestLobbyStatsErr=function(e,t){void 0===t&&(t=""),this.logger.error("LobbyState request error:",e,t),this.onLobbyStats(-1,e+" "+t,[])},LoadBalancingClient.prototype.getRegions=function(){this.nameServerPeer&&this.isConnectedToNameServer()?(this.logger.debug("GetRegions..."),this.nameServerPeer.getRegions(this.appId)):(this.logger.error("GetRegions request error:","Not connected to NameServer"),this.onGetRegionsResult(LoadBalancingClient.PeerErrorCode.NameServerError,"Not connected to NameServer",{}))},LoadBalancingClient.prototype.webRpc=function(e,t,o){this.masterPeer&&this.isConnectedToMaster()?(this.logger.debug("WebRpc..."),this.masterPeer.webRpc(e,t,o)):this.gamePeer&&this.isJoinedToRoom()?(this.logger.debug("WebRpc..."),this.gamePeer.webRpc(e,t,o)):(this.logger.error("WebRpc request error:","Connected to neither Master nor Game server"),this.onWebRpcResult(LoadBalancingClient.PeerErrorCode.MasterError,"Connected to neither Master nor Game server",e,0,{}))},LoadBalancingClient.prototype.connectToRegionMaster=function(e){return this.nameServerPeer&&this.isConnectedToNameServer()?(this.logger.debug("Connecting to Region Master",e,"..."),this.nameServerPeer.opAuth(this.appId,this.appVersion,this.userAuthType,this.userAuthParameters,this.userAuthData,this.userId,e),!0):!!this.connectToNameServer({region:e})||(this.logger.error("Connecting to Region Master error:","Not connected to NameServer"),!1)},LoadBalancingClient.prototype.isConnectedToMaster=function(){return this.masterPeer&&this.masterPeer.isConnected()},LoadBalancingClient.prototype.isConnectedToNameServer=function(){return this.nameServerPeer&&this.nameServerPeer.isConnected()},LoadBalancingClient.prototype.isInLobby=function(){return this.state==LoadBalancingClient.State.JoinedLobby},LoadBalancingClient.prototype.isJoinedToRoom=function(){return this.state==LoadBalancingClient.State.Joined},LoadBalancingClient.prototype.isConnectedToGame=function(){return this.isJoinedToRoom()},LoadBalancingClient.prototype.availableRooms=function(){return this.roomInfos},LoadBalancingClient.prototype.setLogLevel=function(e){this.logger.setLevel(e),this.nameServerPeer&&this.nameServerPeer.setLogLevel(e),this.masterPeer&&this.masterPeer.setLogLevel(e),this.gamePeer&&this.gamePeer.setLogLevel(e)},LoadBalancingClient.prototype.addRoom=function(e){this.roomInfos.push(e),this.roomInfosDict[e.name]=e},LoadBalancingClient.prototype.clearRooms=function(){this.roomInfos=new Array,this.roomInfosDict={}},LoadBalancingClient.prototype.purgeRemovedRooms=function(){for(var e in this.roomInfos=this.roomInfos.filter((function(e){return!e.removed})),this.roomInfosDict)this.roomInfosDict[e].removed&&delete this.roomInfosDict[e]},LoadBalancingClient.prototype.addActor=function(e){this.actors[e.actorNr]=e,this.actorsArray.push(e),this.currentRoom.playerCount=this.actorsArray.length,(0==this.lowestActorId||this.lowestActorId>e.actorNr)&&(this.lowestActorId=e.actorNr)},LoadBalancingClient.prototype.removeActor=function(e){delete this.actors[e],this.actorsArray=this.actorsArray.filter((function(t){return t.actorNr!=e})),this.currentRoom.playerCount=this.actorsArray.length,this.lowestActorId==e&&(this.actorsArray.length>0?this.lowestActorId=this.actorsArray.reduce((function(e,t){return e.actorNr<t.actorNr?e:t})).actorNr:this.lowestActorId=0)},LoadBalancingClient.prototype.clearActors=function(){this.actors={},this.actorsArray=[],this.currentRoom.playerCount=0,this.lowestActorId=0},LoadBalancingClient.prototype.changeState=function(e){this.logger.info("State:",LoadBalancingClient.StateToName(this.state),"->",LoadBalancingClient.StateToName(e)),this.state=e,this.onStateChange(e)},LoadBalancingClient.prototype.createRoomInternal=function(e,o){var n=[];this.currentRoom.name&&n.push(t.Constants.ParameterCode.RoomName,this.currentRoom.name),this.fillCreateRoomOptions(n,o),e===this.masterPeer&&(this.createRoomOptions=o),e===this.gamePeer&&(n.push(t.Constants.ParameterCode.PlayerProperties),n.push(this._myActor._getAllProperties()));var r=e==this.gamePeer?this.gamePeer._logger:this.masterPeer?this.masterPeer._logger:null;r&&r.info("Create Room",o&&o.lobbyName,o&&o.lobbyType,"..."),e.sendOperation(t.Constants.OperationCode.CreateGame,n)},LoadBalancingClient.prototype.updateUserIdAndNickname=function(e,o){var n=e[t.Constants.ParameterCode.UserId];null!=n&&(this.setUserId(n),o.info("Setting userId sent by server:",n));var r=e[t.Constants.ParameterCode.Nickname];null!=r&&(this.myActor().setName(r),o.info("Setting nickname sent by server:",r))},LoadBalancingClient.prototype.initNameServerPeer=function(o){var n=this;o.setLogLevel(this.logger.getLevel()),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.error,(function(){n.changeState(LoadBalancingClient.State.Error),n._onErrorInternal(LoadBalancingClient.PeerErrorCode.NameServerError,"NameServer peer error")})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectFailed,(function(){n.changeState(LoadBalancingClient.State.Error),n._onErrorInternal(LoadBalancingClient.PeerErrorCode.NameServerConnectFailed,"NameServer peer connect failed. "+n.nameServerAddress)})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.timeout,(function(){n.changeState(LoadBalancingClient.State.Error),n._onErrorInternal(LoadBalancingClient.PeerErrorCode.NameServerTimeout,"NameServer peer timeout")})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connecting,(function(){})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connect,(function(){o._logger.info("Connected"),n.changeState(LoadBalancingClient.State.ConnectedToNameServer),null!=n.connectOptions.region&&o.opAuth(n.appId,n.appVersion,n.userAuthType,n.userAuthParameters,n.userAuthData,n.userId,n.connectOptions.region)})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.disconnect,(function(){o==n.nameServerPeer&&(n._cleanupNameServerPeerData(),o._logger.info("Disconnected"))})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectClosed,(function(){o._logger.info("Server closed connection"),n.changeState(LoadBalancingClient.State.Error),n._onErrorInternal(LoadBalancingClient.PeerErrorCode.NameServerConnectClosed,"NameServer server closed connection")})),o.addResponseListener(t.Constants.OperationCode.GetRegions,(function(e){o._logger.debug("resp GetRegions",e);var r={};if(0==e.errCode){var s=e.vals[t.Constants.ParameterCode.Region],a=e.vals[t.Constants.ParameterCode.Address];for(var i in s)r[s[i]]=a[i]}else o._logger.error("GetRegions request error.",e.errCode);n.onGetRegionsResult(e.errCode,e.errMsg,r)})),o.addResponseListener(t.Constants.OperationCode.Authenticate,(function(e){o._logger.debug("resp Authenticate",e),0==e.errCode?(o._logger.info("Authenticated"),o.disconnect(),n.updateUserIdAndNickname(e.vals,o._logger),n.masterServerAddress=e.vals[t.Constants.ParameterCode.Address],o._logger.info("Connecting to Master server",n.masterServerAddress,"..."),n.connectOptions.userAuthSecret=e.vals[t.Constants.ParameterCode.Secret],n.connect(n.connectOptions)):(n.changeState(LoadBalancingClient.State.Error),n._onErrorInternal(LoadBalancingClient.PeerErrorCode.NameServerAuthenticationFailed,"NameServer authentication failed: "+e.errCode+" "+e.errMsg))}))},LoadBalancingClient.prototype.initMasterPeer=function(o){var n=this;o.setLogLevel(this.logger.getLevel()),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.error,(function(){n.changeState(LoadBalancingClient.State.Error),n._onErrorInternal(LoadBalancingClient.PeerErrorCode.MasterError,"Master peer error")})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectFailed,(function(){n.changeState(LoadBalancingClient.State.Error),n._onErrorInternal(LoadBalancingClient.PeerErrorCode.MasterConnectFailed,"Master peer connect failed: "+n.masterServerAddress)})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.timeout,(function(){n.changeState(LoadBalancingClient.State.Error),n._onErrorInternal(LoadBalancingClient.PeerErrorCode.MasterTimeout,"Master peer error timeout")})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connecting,(function(){})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connect,(function(){o._logger.info("Connected");var r=[];n.connectOptions.userAuthSecret?(r.push(t.Constants.ParameterCode.Secret,n.connectOptions.userAuthSecret),o.sendOperation(t.Constants.OperationCode.Authenticate,r),o._logger.info("Authenticate with secret...")):(r.push(t.Constants.ParameterCode.ApplicationId),r.push(n.appId),r.push(t.Constants.ParameterCode.AppVersion),r.push(n.appVersion),n.userAuthType!=t.Constants.CustomAuthenticationType.None&&(r.push(t.Constants.ParameterCode.ClientAuthenticationType,e.TypeExt.Byte(n.userAuthType)),r.push(t.Constants.ParameterCode.ClientAuthenticationParams,n.userAuthParameters),n.userAuthData&&r.push(t.Constants.ParameterCode.ClientAuthenticationData,n.userAuthData)),n.userId&&r.push(t.Constants.ParameterCode.UserId,n.userId),n.connectOptions.lobbyStats&&r.push(t.Constants.ParameterCode.LobbyStats,!0),o.sendOperation(t.Constants.OperationCode.Authenticate,r),o._logger.info("Authenticate..."))})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.disconnect,(function(){o==n.masterPeer&&(n._cleanupMasterPeerData(),o._logger.info("Disconnected"))})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectClosed,(function(){o._logger.info("Server closed connection"),n.changeState(LoadBalancingClient.State.Error),n._onErrorInternal(LoadBalancingClient.PeerErrorCode.MasterConnectClosed,"Master server closed connection")})),o.addEventListener(t.Constants.EventCode.GameList,(function(e){var r=e.vals[t.Constants.ParameterCode.GameList];for(var s in n.clearRooms(),r){var i=new a(s);i._updateFromProps(r[s]),n.addRoom(i)}n.onRoomList(n.roomInfos),o._logger.debug("ev GameList",n.roomInfos,r)})),o.addEventListener(t.Constants.EventCode.GameListUpdate,(function(e){var r=e.vals[t.Constants.ParameterCode.GameList],s=new Array,i=new Array,c=new Array;for(var d in r){var p=n.roomInfos.filter((function(e){return e.name==d}));if(p.length>0){var l=p[0];l._updateFromProps(r[d]),l.removed?c.push(l):s.push(l)}else{var u=new a(d);u._updateFromProps(r[d]),n.addRoom(u),i.push(u)}}n.purgeRemovedRooms(),n.onRoomListUpdate(n.roomInfos,s,i,c),o._logger.debug("ev GameListUpdate:",n.roomInfos,"u:",s,"a:",i,"r:",c,r)})),o.addResponseListener(t.Constants.OperationCode.Authenticate,(function(e){if(o._logger.debug("resp Authenticate",e),e.errCode)n.changeState(LoadBalancingClient.State.Error),n._onErrorInternal(LoadBalancingClient.PeerErrorCode.MasterAuthenticationFailed,"Master authentication failed: "+e.errCode+" "+e.errMsg);else{o._logger.info("Authenticated"),n.updateUserIdAndNickname(e.vals,o._logger),null!=e.vals[t.Constants.ParameterCode.Secret]&&(n.connectOptions.userAuthSecret=e.vals[t.Constants.ParameterCode.Secret]),n.changeState(LoadBalancingClient.State.ConnectedToMaster);var r=[];n.connectOptions.lobbyName&&(r.push(t.Constants.ParameterCode.LobbyName),r.push(n.connectOptions.lobbyName),null!=n.connectOptions.lobbyType&&(r.push(t.Constants.ParameterCode.LobbyType),r.push(n.connectOptions.lobbyType))),n.autoJoinLobby&&(o.sendOperation(t.Constants.OperationCode.JoinLobby,r),o._logger.info("Join Lobby",n.connectOptions.lobbyName,n.connectOptions.lobbyType,"..."))}})),o.addResponseListener(t.Constants.OperationCode.JoinLobby,(function(e){o._logger.debug("resp JoinLobby",e),e.errCode||(o._logger.info("Joined to Lobby"),null!=e.vals[t.Constants.ParameterCode.Secret]&&(n.connectOptions.userAuthSecret=e.vals[t.Constants.ParameterCode.Secret]),n.changeState(LoadBalancingClient.State.JoinedLobby)),n._onOperationResponseInternal2(t.Constants.OperationCode.JoinLobby,e)})),o.addResponseListener(t.Constants.OperationCode.CreateGame,(function(e){o._logger.debug("resp CreateGame",e),e.errCode||(null!=e.vals[t.Constants.ParameterCode.Secret]&&(n.connectOptions.userAuthSecret=e.vals[t.Constants.ParameterCode.Secret]),n.currentRoom._updateFromMasterResponse(e.vals),o._logger.debug("Created/Joined "+n.currentRoom.name),n.connectToGameServer(t.Constants.OperationCode.CreateGame)),n._onOperationResponseInternal2(t.Constants.OperationCode.CreateGame,e)})),o.addResponseListener(t.Constants.OperationCode.JoinGame,(function(e){o._logger.debug("resp JoinGame",e),e.errCode||(null!=e.vals[t.Constants.ParameterCode.Secret]&&(n.connectOptions.userAuthSecret=e.vals[t.Constants.ParameterCode.Secret]),n.currentRoom._updateFromMasterResponse(e.vals),o._logger.debug("Joined "+n.currentRoom.name),n.connectToGameServer(t.Constants.OperationCode.JoinGame)),n._onOperationResponseInternal2(t.Constants.OperationCode.JoinGame,e)})),o.addResponseListener(t.Constants.OperationCode.JoinRandomGame,(function(e){o._logger.debug("resp JoinRandomGame",e),e.errCode||(null!=e.vals[t.Constants.ParameterCode.Secret]&&(n.connectOptions.userAuthSecret=e.vals[t.Constants.ParameterCode.Secret]),n.currentRoom._updateFromMasterResponse(e.vals),o._logger.debug("Joined "+n.currentRoom.name),n.connectToGameServer(t.Constants.OperationCode.JoinRandomGame)),n._onOperationResponseInternal2(t.Constants.OperationCode.JoinRandomGame,e)})),o.addResponseListener(t.Constants.OperationCode.FindFriends,(function(e){o._logger.debug("resp FindFriends",e);var r={};if(e.errCode)o._logger.error("FindFriends request error:",e.errCode);else for(var s=e.vals[t.Constants.ParameterCode.FindFriendsResponseOnlineList]||{},a=e.vals[t.Constants.ParameterCode.FindFriendsResponseRoomIdList]||{},i=0;i<n.findFriendsRequestList.length;++i){var c=n.findFriendsRequestList[i];c&&(r[c]={online:s[i],roomId:a[i]})}n.onFindFriendsResult(e.errCode,e.errMsg,r)})),o.addResponseListener(t.Constants.OperationCode.LobbyStats,(function(e){o._logger.debug("resp LobbyStats",e);var r=new Array;if(e.errCode)o._logger.error("LobbyStats request error:",e.errCode);else{var s=e.vals[t.Constants.ParameterCode.LobbyName],a=e.vals[t.Constants.ParameterCode.LobbyType]||{},i=e.vals[t.Constants.ParameterCode.PeerCount]||{},c=e.vals[t.Constants.ParameterCode.GameCount]||{};if(s)for(var d=0;d<s.length;++d)r[d]={lobbyName:s[d],lobbyType:a[d],peerCount:i[d],gameCount:c[d]};else for(d=0;d<n.lobbyStatsRequestList.length;++d){var p=n.lobbyStatsRequestList[d];r[d]={lobbyName:p[0],lobbyType:p[1],peerCount:i[d],gameCount:c[d]}}}n.onLobbyStats(e.errCode,e.errMsg,r)})),o.addEventListener(t.Constants.EventCode.LobbyStats,(function(e){o._logger.debug("ev LobbyStats",e);var r=new Array,s=e.vals[t.Constants.ParameterCode.LobbyName],a=e.vals[t.Constants.ParameterCode.LobbyType]||{},i=e.vals[t.Constants.ParameterCode.PeerCount]||{},c=e.vals[t.Constants.ParameterCode.GameCount]||{};if(s)for(var d=0;d<s.length;++d)r[d]={lobbyName:s[d],lobbyType:a[d],peerCount:i[d],gameCount:c[d]};n.onLobbyStats(0,"",r)})),o.addEventListener(t.Constants.EventCode.AppStats,(function(e){o._logger.debug("ev AppStats",e);var r={peerCount:e.vals[t.Constants.ParameterCode.PeerCount],masterPeerCount:e.vals[t.Constants.ParameterCode.MasterPeerCount],gameCount:e.vals[t.Constants.ParameterCode.GameCount]};n.onAppStats(0,"",r)})),o.addResponseListener(t.Constants.OperationCode.Rpc,o.webRpcHandler(this))},LoadBalancingClient.prototype.connectToGameServer=function(e){return!this.connectOptions.keepMasterConnection&&this.masterPeer&&this.masterPeer.disconnect(),!!this.checkNextState(LoadBalancingClient.State.ConnectingToGameserver,!0)&&(this.logger.info("Connecting to Game",this.currentRoom.address),this.gamePeer&&this.gamePeer.Destroy(),this.gamePeer=new u(this,this.connectionProtocol,this.currentRoom.address,""),this.gamePeerWaitingForDisconnect=!1,this.initGamePeer(this.gamePeer,e),this.gamePeer.connect(this.appId),this.changeState(LoadBalancingClient.State.ConnectingToGameserver),!0)},LoadBalancingClient.prototype.initGamePeer=function(o,n){var r=this;o.setLogLevel(this.logger.getLevel()),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.error,(function(){r.changeState(LoadBalancingClient.State.Error),r._onErrorInternal(LoadBalancingClient.PeerErrorCode.GameError,"Game peer error")})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectFailed,(function(){r.changeState(LoadBalancingClient.State.Error),r._onErrorInternal(LoadBalancingClient.PeerErrorCode.GameConnectFailed,"Game peer connect failed: "+r.currentRoom.address)})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.timeout,(function(){r.changeState(LoadBalancingClient.State.Error),r._onErrorInternal(LoadBalancingClient.PeerErrorCode.GameTimeout,"Game peer timeout")})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connect,(function(){o._logger.info("Connected");var n=[];n.push(t.Constants.ParameterCode.ApplicationId),n.push(r.appId),n.push(t.Constants.ParameterCode.AppVersion),n.push(r.appVersion),null!=r.connectOptions.userAuthSecret&&(n.push(t.Constants.ParameterCode.Secret),n.push(r.connectOptions.userAuthSecret)),r.userAuthType!=t.Constants.CustomAuthenticationType.None&&(n.push(t.Constants.ParameterCode.ClientAuthenticationType),n.push(e.TypeExt.Byte(r.userAuthType))),r.userId&&n.push(t.Constants.ParameterCode.UserId,r.userId),o.sendOperation(t.Constants.OperationCode.Authenticate,n),o._logger.info("Authenticate...")})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.disconnect,(function(){o==r.gamePeer&&(r._cleanupGamePeerData(),o._logger.info("Disconnected"))})),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectClosed,(function(){o._logger.info("Server closed connection"),r.gamePeerWaitingForDisconnect||(r.changeState(LoadBalancingClient.State.Error),r._onErrorInternal(LoadBalancingClient.PeerErrorCode.GameConnectClosed,"Game server closed connection"))})),o.addResponseListener(t.Constants.OperationCode.Authenticate,(function(e){if(o._logger.debug("resp Authenticate",e),e.errCode)r.changeState(LoadBalancingClient.State.Error),r._onErrorInternal(LoadBalancingClient.PeerErrorCode.GameAuthenticationFailed,"Game authentication failed: "+e.errCode+" "+e.errMsg);else{if(o._logger.info("Authenticated"),o._logger.info("Connected"),n==t.Constants.OperationCode.CreateGame)r.createRoomInternal(o,r.createRoomOptions);else{var s=[];s.push(t.Constants.ParameterCode.RoomName),s.push(r.currentRoom.name),s.push(t.Constants.ParameterCode.Broadcast),s.push(!0),s.push(t.Constants.ParameterCode.PlayerProperties),s.push(r._myActor._getAllProperties()),n==t.Constants.OperationCode.JoinGame&&(r.joinRoomOptions.createIfNotExists&&(s.push(t.Constants.ParameterCode.JoinMode,LoadBalancingClient.JoinMode.CreateIfNotExists),r.fillCreateRoomOptions(s,r.createRoomOptions)),r.joinRoomOptions.rejoin&&s.push(t.Constants.ParameterCode.JoinMode,LoadBalancingClient.JoinMode.RejoinOnly),r.joinRoomOptions.expectedUsers&&s.push(t.Constants.ParameterCode.Add,r.joinRoomOptions.expectedUsers)),o.sendOperation(t.Constants.OperationCode.JoinGame,s)}r.changeState(LoadBalancingClient.State.ConnectedToGameserver)}})),o.addResponseListener(t.Constants.OperationCode.CreateGame,(function(e){o._logger.debug("resp CreateGame",e),e.errCode||(r._myActor._updateMyActorFromResponse(e.vals),o._logger.info("myActor: ",r._myActor),r.currentRoom._updateFromProps(e.vals[t.Constants.ParameterCode.GameProperties]),r.clearActors(),r.addActor(r._myActor),r.changeState(LoadBalancingClient.State.Joined),r.onJoinRoom(!0)),r._onOperationResponseInternal2(t.Constants.OperationCode.CreateGame,e)})),o.addResponseListener(t.Constants.OperationCode.JoinGame,(function(e){if(o._logger.debug("resp JoinGame",e),!e.errCode){r._myActor._updateMyActorFromResponse(e.vals),o._logger.info("myActor: ",r._myActor),r.clearActors(),r.addActor(r._myActor);var n=e.vals[t.Constants.ParameterCode.ActorList],s=e.vals[t.Constants.ParameterCode.PlayerProperties];if(void 0!==n)for(var a=0;a<n.length;a++){var i,c=n[a];void 0!==s&&(i=s[c]);var d,p="";if(void 0!==i&&(p=i[t.Constants.ActorProperties.PlayerName]),c==r._myActor.actorNr?d=r._myActor:(d=r.actorFactoryInternal(p,c),r.addActor(d)),void 0!==i){var l=i[t.Constants.ActorProperties.UserId];null!=l&&(d.userId=l)}void 0!==i&&d._updateFromProps(i)}r.currentRoom._updateFromProps(e.vals[t.Constants.ParameterCode.GameProperties]),r.changeState(LoadBalancingClient.State.Joined),r.onJoinRoom(!1)}r._onOperationResponseInternal2(t.Constants.OperationCode.JoinGame,e)})),o.addResponseListener(t.Constants.OperationCode.SetProperties,(function(e){o._logger.debug("resp SetProperties",e),r._onOperationResponseInternal2(t.Constants.OperationCode.SetProperties,e)})),o.addResponseListener(t.Constants.OperationCode.Leave,(function(e){o._logger.debug("resp Leave",e),o.disconnect(),r._onOperationResponseInternal2(t.Constants.OperationCode.Leave,e)})),o.addResponseListener(t.Constants.OperationCode.Rpc,o.webRpcHandler(this)),o.addEventListener(t.Constants.EventCode.Join,(function(e){if(o._logger.debug("ev Join",e),s._getActorNrFromResponse(e.vals)===r._myActor.actorNr)r._myActor._updateFromResponse(e.vals),r.onActorJoin(r._myActor);else{var t=r.actorFactoryInternal();t._updateFromResponse(e.vals),r.addActor(t),r.onActorJoin(t)}})),o.addEventListener(t.Constants.EventCode.Leave,(function(e){o._logger.debug("ev Leave",e),r.myRoom()._updateFromEvent(e.vals);var n=s._getActorNrFromResponse(e.vals);if(n&&r.actors[n]){var a=r.actors[n];e.vals[t.Constants.ParameterCode.IsInactive]?(a._setSuspended(!0),r.onActorSuspend(a)):(r.removeActor(n),r.onActorLeave(a,!1))}})),o.addEventListener(t.Constants.EventCode.Disconnect,(function(e){o._logger.debug("ev Disconnect",e);var t=s._getActorNrFromResponse(e.vals);if(t&&r.actors[t]){var n=r.actors[t];n._setSuspended(!0),r.onActorSuspend(n)}})),o.addEventListener(t.Constants.EventCode.PropertiesChanged,(function(e){o._logger.debug("ev PropertiesChanged",e);var n=e.vals[t.Constants.ParameterCode.TargetActorNr];if(void 0!==n&&n>0){if(void 0!==r.actors[n]){var s=r.actors[n];s._updateFromProps(e.vals[t.Constants.ParameterCode.Properties]),r.onActorPropertiesChange(s)}}else r.currentRoom._updateFromProps(e.vals[t.Constants.ParameterCode.Properties]),r.onMyRoomPropertiesChange()}))},LoadBalancingClient.prototype._cleanupNameServerPeerData=function(){},LoadBalancingClient.prototype._cleanupMasterPeerData=function(){},LoadBalancingClient.prototype._cleanupGamePeerData=function(){for(var e in this.actors)this.onActorLeave(this.actors[e],!0);this.clearActors(),this.addActor(this._myActor)},LoadBalancingClient.prototype._onOperationResponseInternal2=function(e,t){t.errCode&&this.logger.warn("Operation",e,"error:",t.errMsg,"("+t.errCode+")"),this.onOperationResponse(t.errCode,t.errMsg,e,t.vals)},LoadBalancingClient.prototype._onErrorInternal=function(e,t){this.logger.error("Error:",e,t),this.onError(e,t)},LoadBalancingClient.prototype.initValidNextState=function(){this.validNextState[LoadBalancingClient.State.Error]=[LoadBalancingClient.State.ConnectingToMasterserver,LoadBalancingClient.State.ConnectingToNameServer],this.validNextState[LoadBalancingClient.State.Uninitialized]=[LoadBalancingClient.State.ConnectingToMasterserver,LoadBalancingClient.State.ConnectingToNameServer],this.validNextState[LoadBalancingClient.State.ConnectedToNameServer]=[LoadBalancingClient.State.ConnectingToMasterserver],this.validNextState[LoadBalancingClient.State.Disconnected]=[LoadBalancingClient.State.ConnectingToMasterserver,LoadBalancingClient.State.ConnectingToNameServer],this.validNextState[LoadBalancingClient.State.ConnectedToMaster]=[LoadBalancingClient.State.JoinedLobby,LoadBalancingClient.State.ConnectingToGameserver],this.validNextState[LoadBalancingClient.State.JoinedLobby]=[LoadBalancingClient.State.ConnectingToGameserver],this.validNextState[LoadBalancingClient.State.ConnectingToGameserver]=[LoadBalancingClient.State.ConnectedToGameserver],this.validNextState[LoadBalancingClient.State.ConnectedToGameserver]=[LoadBalancingClient.State.Joined]},LoadBalancingClient.prototype.checkNextState=function(e,t){void 0===t&&(t=!1);var o=this.validNextState[this.state],n=o&&o.indexOf(e)>=0;return n||(t?this.logger.error("LoadBalancingPeer checkNextState fail: "+LoadBalancingClient.StateToName(this.state)+" -> "+LoadBalancingClient.StateToName(e)):this.logger.exception(501,"LoadBalancingPeer checkNextState fail: "+LoadBalancingClient.StateToName(this.state)+" -> "+LoadBalancingClient.StateToName(e))),n},LoadBalancingClient.StateToName=function(e){return LoadBalancingClient.stateName[e]},LoadBalancingClient.JoinMode={Default:0,CreateIfNotExists:1,RejoinOnly:3},LoadBalancingClient.PeerErrorCode={Ok:0,MasterError:1001,MasterConnectFailed:1002,MasterConnectClosed:1003,MasterTimeout:1004,MasterEncryptionEstablishError:1005,MasterAuthenticationFailed:1101,GameError:2001,GameConnectFailed:2002,GameConnectClosed:2003,GameTimeout:2004,GameEncryptionEstablishError:2005,GameAuthenticationFailed:2101,NameServerError:3001,NameServerConnectFailed:3002,NameServerConnectClosed:3003,NameServerTimeout:3004,NameServerEncryptionEstablishError:3005,NameServerAuthenticationFailed:3101},LoadBalancingClient.State={Error:-1,Uninitialized:0,ConnectingToNameServer:1,ConnectedToNameServer:2,ConnectingToMasterserver:3,ConnectedToMaster:4,JoinedLobby:5,ConnectingToGameserver:6,ConnectedToGameserver:7,Joined:8,Disconnected:10},LoadBalancingClient.stateName=((o={})[LoadBalancingClient.State.Error]="Error",o[LoadBalancingClient.State.Uninitialized]="Uninitialized",o[LoadBalancingClient.State.ConnectingToNameServer]="ConnectingToNameServer",o[LoadBalancingClient.State.ConnectedToNameServer]="ConnectedToNameServer",o[LoadBalancingClient.State.ConnectingToMasterserver]="ConnectingToMasterserver",o[LoadBalancingClient.State.ConnectedToMaster]="ConnectedToMaster",o[LoadBalancingClient.State.JoinedLobby]="JoinedLobby",o[LoadBalancingClient.State.ConnectingToGameserver]="ConnectingToGameserver",o[LoadBalancingClient.State.ConnectedToGameserver]="ConnectedToGameserver",o[LoadBalancingClient.State.Joined]="Joined",o[LoadBalancingClient.State.Disconnected]="Disconnected",o),LoadBalancingClient}();t.LoadBalancingClient=c;var d=function(o){function LbcPeer(){return null!==o&&o.apply(this,arguments)||this}return __extends(LbcPeer,o),LbcPeer.prototype.webRpc=function(o,n,s){var a=[];a.push(t.Constants.ParameterCode.UriPath,o),a.push(t.Constants.ParameterCode.RpcCallParams,n),s&&s.sendAuthCookie&&a.push(t.Constants.ParameterCode.WebFlags,e.TypeExt.Byte(r)),this.sendOperation(t.Constants.OperationCode.Rpc,a)},LbcPeer.prototype.webRpcHandler=function(e){var o=this;return function(n){var r,s,a;o._logger.debug("resp Rpc",n),0==n.errCode?(r=n.vals[t.Constants.ParameterCode.UriPath],s=n.vals[t.Constants.ParameterCode.RpcCallRetData],a=n.vals[t.Constants.ParameterCode.RpcCallRetCode]):o._logger.error("WebRpc request error:",n.errCode),e.onWebRpcResult(n.errCode,n.errMsg,r,a,s)}},LbcPeer}(e.PhotonPeer);t.LbcPeer=d;var p=function(o){function NameServerPeer(e,t,n,r){var s=o.call(this,t,n,r,e.logger.getPrefix()+" NameServer")||this;return s.client=e,s}return __extends(NameServerPeer,o),NameServerPeer.prototype.onUnhandledEvent=function(e,o){this.client.onEvent(e,o.vals[t.Constants.ParameterCode.CustomEventContent],o.vals[t.Constants.ParameterCode.ActorNr])},NameServerPeer.prototype.onUnhandledResponse=function(e,t){this.client.onOperationResponse(t.errCode,t.errMsg,e,t.vals)},NameServerPeer.prototype.getRegions=function(e){var o=[];o.push(t.Constants.ParameterCode.ApplicationId,e),this.sendOperation(t.Constants.OperationCode.GetRegions,o,!0,0)},NameServerPeer.prototype.opAuth=function(o,n,r,s,a,i,c){var d=[];d.push(t.Constants.ParameterCode.ApplicationId,o),d.push(t.Constants.ParameterCode.AppVersion,n),r!=t.Constants.CustomAuthenticationType.None&&(d.push(t.Constants.ParameterCode.ClientAuthenticationType,e.TypeExt.Byte(r)),d.push(t.Constants.ParameterCode.ClientAuthenticationParams,s),a&&d.push(t.Constants.ParameterCode.ClientAuthenticationData,a)),i&&d.push(t.Constants.ParameterCode.UserId,i),d.push(t.Constants.ParameterCode.Region,c),this.sendOperation(t.Constants.OperationCode.Authenticate,d,!0,0),this._logger.info("Authenticate...")},NameServerPeer}(d);t.NameServerPeer=p;var l=function(e){function MasterPeer(t,o,n,r){var s=e.call(this,o,n,r,t.logger.getPrefix()+" Master")||this;return s.client=t,s}return __extends(MasterPeer,e),MasterPeer.prototype.onUnhandledEvent=function(e,o){this.client.onEvent(e,o.vals[t.Constants.ParameterCode.CustomEventContent],o.vals[t.Constants.ParameterCode.ActorNr])},MasterPeer.prototype.onUnhandledResponse=function(e,t){this.client.onOperationResponse(t.errCode,t.errMsg,e,t.vals)},MasterPeer.prototype.findFriends=function(e){var o=[];o.push(t.Constants.ParameterCode.FindFriendsRequestList),o.push(e),this.sendOperation(t.Constants.OperationCode.FindFriends,o)},MasterPeer.prototype.requestLobbyStats=function(e){var o=[];if(e&&e.length>0){for(var n=new Array,r=new Array,s=0;s<e.length;++s)n[s]=e[s][0],r[s]=e[s][1];o.push(t.Constants.ParameterCode.LobbyName),o.push(n),o.push(t.Constants.ParameterCode.LobbyType),o.push(r)}this.sendOperation(t.Constants.OperationCode.LobbyStats,o)},MasterPeer}(d);t.MasterPeer=l;var u=function(o){function GamePeer(e,t,n,r){var s=o.call(this,t,n,r,e.logger.getPrefix()+" Game")||this;return s.client=e,s}return __extends(GamePeer,o),GamePeer.prototype.onUnhandledEvent=function(e,o){this.client.onEvent(e,o.vals[t.Constants.ParameterCode.CustomEventContent],o.vals[t.Constants.ParameterCode.ActorNr])},GamePeer.prototype.onUnhandledResponse=function(e,t){this.client.onOperationResponse(t.errCode,t.errMsg,e,t.vals)},GamePeer.prototype.raiseEvent=function(o,r,s){if(!this.client.isJoinedToRoom())throw new Error("raiseEvent - Not joined!");this._logger.debug("raiseEvent",o,r,s);var a=[t.Constants.ParameterCode.Code,e.TypeExt.Byte(o),t.Constants.ParameterCode.Data,r];s&&(null!=s.receivers&&s.receivers!==t.Constants.ReceiverGroup.Others&&(a.push(t.Constants.ParameterCode.ReceiverGroup),a.push(e.TypeExt.Byte(s.receivers))),null!=s.cache&&s.cache!==t.Constants.EventCaching.DoNotCache&&(a.push(t.Constants.ParameterCode.Cache),a.push(e.TypeExt.Byte(s.cache))),null!=s.interestGroup&&(this.checkGroupNumber(s.interestGroup)?(a.push(t.Constants.ParameterCode.Group),a.push(e.TypeExt.Byte(s.interestGroup))):this._logger.exception(502,"raiseEvent - Group not a number: "+s.interestGroup)),null!=s.targetActors&&(a.push(t.Constants.ParameterCode.ActorList),a.push(s.targetActors)),s.webForward&&(a.push(t.Constants.ParameterCode.WebFlags),a.push(e.TypeExt.Byte(n)))),this.sendOperation(t.Constants.OperationCode.RaiseEvent,a)},GamePeer.prototype.changeGroups=function(o,n){var r=[];null!=o&&null!=o&&(this.checkGroupArray(o,"groupsToRemove"),r.push(t.Constants.ParameterCode.Remove),r.push(e.TypeExt.Byte(o))),null!=n&&null!=n&&(this.checkGroupArray(n,"groupsToAdd"),r.push(t.Constants.ParameterCode.Add),r.push(e.TypeExt.Byte(n))),this.sendOperation(t.Constants.OperationCode.ChangeGroups,r)},GamePeer.prototype.checkGroupNumber=function(e){return!("number"!=typeof e||isNaN(e)||e===1/0||e===-1/0)},GamePeer.prototype.checkGroupArray=function(e,t){if(Exitgames.Common.Util.isArray(e))for(var o=0;o<e.length;++o){var n=e[o];this.checkGroupNumber(n)||this._logger.exception(503,"changeGroups - "+t+" ("+e+") not an array of numbers: element "+o+" = "+n)}else this._logger.exception(504,"changeGroups - groupsToRemove not an array: "+e)},GamePeer}(d);t.GamePeer=u}(e.LoadBalancing||(e.LoadBalancing={}))}(Photon||(Photon={})),function(e){!function(e){!function(e){e.LiteOpKey={ActorList:252,ActorNr:254,ActorProperties:249,Add:238,Broadcast:250,Cache:247,Code:244,Data:245,GameId:255,GameProperties:248,Group:240,Properties:251,ReceiverGroup:246,Remove:239,TargetActorNr:253,EmptyRoomLiveTime:236},e.LiteEventCode={Join:255,Leave:254,PropertiesChanged:253},e.LiteOpCode={ChangeGroups:248,GetProperties:251,Join:255,Leave:254,RaiseEvent:253,SetProperties:252}}(e.Constants||(e.Constants={}))}(e.Lite||(e.Lite={}))}(Photon||(Photon={})),function(e){!function(t){!function(t){var o=e.Lite.Constants.LiteOpKey,n=e.Lite.Constants.LiteOpCode,r=e.Lite.Constants.LiteEventCode;t.ErrorCode={Ok:0,OperationNotAllowedInCurrentState:-3,InvalidOperationCode:-2,InternalServerError:-1,InvalidAuthentication:32767,GameIdAlreadyExists:32766,GameFull:32765,GameClosed:32764,NoRandomMatchFound:32760,GameDoesNotExist:32758,MaxCcuReached:32757,InvalidRegion:32756,CustomAuthenticationFailed:32755,AuthenticationTicketExpired:32753,PluginReportedError:32752,PluginMismatch:32751,JoinFailedPeerAlreadyJoined:32750,JoinFailedFoundInactiveJoiner:32749,JoinFailedWithRejoinerNotFound:32748,JoinFailedFoundExcludedUserId:32747,JoinFailedFoundActiveJoiner:32746,HttpLimitReached:32745,ExternalHttpCallFailed:32744,SlotError:32742,InvalidEncryptionParameters:32741},t.ActorProperties={PlayerName:255,UserId:253},t.GameProperties={MaxPlayers:255,IsVisible:254,IsOpen:253,PlayerCount:252,Removed:251,PropsListedInLobby:250,CleanupCacheOnLeave:249,MasterClientId:248,ExpectedUsers:247,PlayerTtl:246,EmptyRoomTtl:245},t.EventCode={GameList:230,GameListUpdate:229,QueueState:228,AppStats:226,AzureNodeInfo:210,Join:r.Join,Leave:r.Leave,PropertiesChanged:r.PropertiesChanged,Disconnect:252,LobbyStats:224},t.ParameterCode={Address:230,PeerCount:229,GameCount:228,MasterPeerCount:227,UserId:225,ApplicationId:224,Position:223,MatchMakingType:223,GameList:222,Secret:221,AppVersion:220,AzureNodeInfo:210,AzureLocalNodeId:209,AzureMasterNodeId:208,RoomName:o.GameId,Broadcast:o.Broadcast,ActorList:o.ActorList,ActorNr:o.ActorNr,PlayerProperties:o.ActorProperties,CustomEventContent:o.Data,Data:o.Data,Code:o.Code,GameProperties:o.GameProperties,Properties:o.Properties,TargetActorNr:o.TargetActorNr,ReceiverGroup:o.ReceiverGroup,Cache:o.Cache,CleanupCacheOnLeave:241,Group:o.Group,Remove:o.Remove,Add:o.Add,EmptyRoomTTL:o.EmptyRoomLiveTime,PlayerTTL:235,Plugins:204,ClientAuthenticationType:217,ClientAuthenticationParams:216,ClientAuthenticationData:214,JoinMode:215,MasterClientId:203,FindFriendsRequestList:1,FindFriendsResponseOnlineList:1,FindFriendsResponseRoomIdList:2,LobbyName:213,LobbyType:212,LobbyStats:211,Region:210,IsInactive:233,CheckUserOnJoin:232,ExpectedValues:231,UriPath:209,RpcCallParams:208,RpcCallRetCode:207,RpcCallRetMessage:206,RpcCallRetData:208,WebFlags:234,Nickname:202,PublishUserId:239},t.OperationCode={Authenticate:230,JoinLobby:229,LeaveLobby:228,CreateGame:227,JoinGame:226,JoinRandomGame:225,Leave:n.Leave,RaiseEvent:n.RaiseEvent,SetProperties:n.SetProperties,GetProperties:n.GetProperties,ChangeGroups:n.ChangeGroups,FindFriends:222,LobbyStats:221,GetRegions:220,Rpc:219},t.MatchmakingMode={FillRoom:0,SerialMatching:1,RandomMatching:2},t.EventCaching={DoNotCache:0,MergeCache:1,ReplaceCache:2,RemoveCache:3,AddToRoomCache:4,AddToRoomCacheGlobal:5,RemoveFromRoomCache:6,RemoveFromRoomCacheForActorsLeft:7},t.ReceiverGroup={Others:0,All:1,MasterClient:2},t.CustomAuthenticationType={Custom:0,Steam:1,Facebook:2,None:255},t.LobbyType={Default:0,SqlLobby:2}}(t.Constants||(t.Constants={}))}(e.LoadBalancing||(e.LoadBalancing={}))}(Photon||(Photon={})),function(e){!function(e){!function(e){var t;e.ParameterCode={Channels:0,Channel:1,Messages:2,Message:3,Senders:4,Sender:5,ChannelUserCount:6,UserId:225,MsgId:8,MsgIds:9,SubscribeResults:15,Status:10,Friends:11,SkipMessage:12,HistoryLength:14,WebFlags:21,Properties:22,ChannelSubscribers:23},e.OperationCode={Subscribe:0,Unsubscribe:1,Publish:2,SendPrivate:3,ChannelHistory:4,UpdateStatus:5,AddFriendds:6,RemoveFriends:7},e.EventCode={ChatMessages:0,Users:1,PrivateMessage:2,FriendsList:3,StatusUpdate:4,Subscribe:5,Unsubscribe:6,UserSubscribe:8,UserUnsubscribe:9},e.UserStatus={Offline:0,Invisible:1,Online:2,Away:3,Dnd:4,Lfg:5,Playing:6};var o=((t={})[e.UserStatus.Offline]="Offline",t[e.UserStatus.Invisible]="Invisible",t[e.UserStatus.Online]="Online",t[e.UserStatus.Away]="Away",t[e.UserStatus.Dnd]="Dnd",t[e.UserStatus.Lfg]="Lfg",t[e.UserStatus.Playing]="Playing",t);e.ChannelProperties={MaxSubscribers:255,PublishSubscribers:254},e.UserStatusToName=function UserStatusToName(e){return o[e]}}(e.Constants||(e.Constants={}))}(e.Chat||(e.Chat={}))}(Photon||(Photon={})),function(e){!function(t){var o,n=1,r=function(){function Message(e,t){this.sender=e,this.content=t}return Message.prototype.getSender=function(){return this.sender},Message.prototype.getContent=function(){return this.content},Message}();t.Message=r;var s=function(){function Channel(e,t){this.name=e,this.isPrivat=t,this.messages=[],this.lastId=0,this.properties={},this.publishSubscribers=!1,this.maxSubscribers=0,this.subscribers={}}return Channel.prototype.getName=function(){return this.name},Channel.prototype.isPrivate=function(){return this.isPrivat},Channel.prototype.getMessages=function(){return this.messages},Channel.prototype.getLastId=function(){return this.lastId},Channel.prototype.clearMessages=function(){this.messages.splice(0)},Channel.prototype.addMessages=function(e,t){var o=[];for(var n in e)if(parseInt(n)<t.length){var s=new r(e[n],t[n]);this.messages.push(s),o.push(s)}return o},Channel.prototype.readProperties=function(e){if(e){for(var o in e)null==e[o]?this.properties[o]=void 0:this.properties[o]=e[o];var n=e[t.Constants.ChannelProperties.PublishSubscribers];null!=n&&(this.publishSubscribers=n),null!=(n=e[t.Constants.ChannelProperties.MaxSubscribers])&&(this.maxSubscribers=n)}},Channel.prototype.addSubscriber=function(e){return!this.subscribers[e]&&(!(Object.keys(this.subscribers).length>this.maxSubscribers)&&(this.subscribers[e]=!0,!0))},Channel.prototype.removeSubscriber=function(e){return!!this.subscribers[e]&&(delete this.subscribers[e],!0)},Channel.prototype.reset=function(){this.subscribers={},this.properties={}},Channel}();t.Channel=s;var a=function(a){function ChatClient(e,t,o){var n=a.call(this,e,t,o)||this;return n.DefaultMaxSubscribers=100,n.publicChannels={},n.privateChannels={},n.subscribeRequests=[],n.unsubscribeRequests=[],n.autoJoinLobby=!1,n}return __extends(ChatClient,a),ChatClient.prototype.onStateChange=function(e){},ChatClient.prototype.onError=function(e,t){},ChatClient.prototype.onSubscribeResult=function(e){},ChatClient.prototype.onUnsubscribeResult=function(e){},ChatClient.prototype.onChatMessages=function(e,t){},ChatClient.prototype.onPrivateMessage=function(e,t){},ChatClient.prototype.onUserStatusUpdate=function(e,t,o,n){},ChatClient.prototype.onUserSubscribe=function(e,t){},ChatClient.prototype.onUserUnsubscribe=function(e,t){},ChatClient.prototype.connectToNameServer=function(e){return a.prototype.connectToNameServer.call(this,e)},ChatClient.prototype.connectToRegionFrontEnd=function(e){return this.connectToRegionMaster(e)},ChatClient.prototype.isConnectedToFrontEnd=function(){return this.state==ChatClient.ChatState.ConnectedToFrontEnd},ChatClient.prototype.subscribe=function(o,n){if("number"==typeof n&&(n={historyLength:n}),this.masterPeer&&this.isConnectedToFrontEnd()){this.logger.debug("Subscribe channels:",o);var r=[];if(r.push(t.Constants.ParameterCode.Channels,e.TypeExt.String(o)),n&&(n.historyLength&&r.push(t.Constants.ParameterCode.HistoryLength,e.TypeExt.Int(n.historyLength)),n.lastIds&&(r.push(t.Constants.ParameterCode.MsgIds,e.TypeExt.Int(n.lastIds)),void 0===n.historyLength&&r.push(t.Constants.ParameterCode.HistoryLength,e.TypeExt.Int(-1))),n.createOptions&&n.createOptions.publishSubscribers)){if(n.createOptions.maxSubscribers>this.DefaultMaxSubscribers)return this.logger.error("Cannot set MaxSubscribers > "+this.DefaultMaxSubscribers+" when PublishSubscribers == true."),!1;var s=e.TypeExt.DictTypedKeys(e.TypeExtType.Object,e.TypeExtType.Object);e.TypeExt.PutTypedKey(s,e.TypeExt.Byte(t.Constants.ChannelProperties.PublishSubscribers),!0),e.TypeExt.PutTypedKey(s,e.TypeExt.Byte(t.Constants.ChannelProperties.MaxSubscribers),e.TypeExt.Int(n.createOptions.maxSubscribers)),r.push(t.Constants.ParameterCode.Properties,s)}return this.masterPeer.sendOperation(t.Constants.OperationCode.Subscribe,r),!0}return this.logger.error("subscribe request error:","Not connected to Front End"),!1},ChatClient.prototype.unsubscribe=function(o){if(this.masterPeer&&this.isConnectedToFrontEnd()){this.logger.debug("Unsubscribe channels:",o);var n=[];return n.push(t.Constants.ParameterCode.Channels,e.TypeExt.String(o)),this.masterPeer.sendOperation(t.Constants.OperationCode.Unsubscribe,n),!0}return this.logger.error("unsubscribe request error:","Not connected to Front End"),!1},ChatClient.prototype.publishMessage=function(o,r,s){if(this.masterPeer&&this.isConnectedToFrontEnd()){var a=[];return a.push(t.Constants.ParameterCode.Channel,o),a.push(t.Constants.ParameterCode.Message,r),s&&s.webForward&&(a.push(t.Constants.ParameterCode.WebFlags),a.push(e.TypeExt.Byte(n))),this.masterPeer.sendOperation(t.Constants.OperationCode.Publish,a),!0}return this.logger.error("publishMessage request error:","Not connected to Front End"),!1},ChatClient.prototype.sendPrivateMessage=function(o,r,s){if(this.masterPeer&&this.isConnectedToFrontEnd()){var a=[];return a.push(t.Constants.ParameterCode.UserId,o),a.push(t.Constants.ParameterCode.Message,r),s&&s.webForward&&(a.push(t.Constants.ParameterCode.WebFlags),a.push(e.TypeExt.Byte(n))),this.masterPeer.sendOperation(t.Constants.OperationCode.SendPrivate,a),!0}return this.logger.error("sendPrivateMessage request error:","Not connected to Front End"),!1},ChatClient.prototype.setUserStatus=function(o,n,r){if(void 0===n&&(n=null),void 0===r&&(r=!1),this.masterPeer&&this.isConnectedToFrontEnd()){var s=[];return s.push(t.Constants.ParameterCode.Status,e.TypeExt.Int(o)),r?s.push(t.Constants.ParameterCode.SkipMessage,!0):s.push(t.Constants.ParameterCode.Message,n),this.masterPeer.sendOperation(t.Constants.OperationCode.UpdateStatus,s),!0}return this.logger.error("setUserStatus request error:","Not connected to Front End"),!1},ChatClient.prototype.addFriends=function(o){if(this.masterPeer&&this.isConnectedToFrontEnd()){var n=[];return n.push(t.Constants.ParameterCode.Friends,e.TypeExt.String(o)),this.masterPeer.sendOperation(t.Constants.OperationCode.AddFriendds,n),!0}return this.logger.error("addFriends request error:","Not connected to Front End"),!1},ChatClient.prototype.removeFriends=function(o){if(this.masterPeer&&this.isConnectedToFrontEnd()){var n=[];return n.push(t.Constants.ParameterCode.Friends,e.TypeExt.String(o)),this.masterPeer.sendOperation(t.Constants.OperationCode.RemoveFriends,n),!0}return this.logger.error("removeFriends request error:","Not connected to Front End"),!1},ChatClient.prototype.getPublicChannels=function(){return this.publicChannels},ChatClient.prototype.getPrivateChannels=function(){return this.privateChannels},ChatClient.prototype.getOrAddChannel=function(e,t,o){return null==e[t]&&(e[t]=new s(t,o)),e[t]},ChatClient.prototype.initMasterPeer=function(e){var o=this;a.prototype.initMasterPeer.call(this,e),e.addEventListener(t.Constants.EventCode.ChatMessages,(function(n){var r=n.vals[t.Constants.ParameterCode.Senders],s=n.vals[t.Constants.ParameterCode.Messages],a=n.vals[t.Constants.ParameterCode.Channel],i=o.publicChannels[a];if(i){var c=i.addMessages(r,s);i.lastId=n.vals[t.Constants.ParameterCode.MsgId],o.onChatMessages(a,c)}else e._logger.warn("ev ChatMessages: Got message from unsubscribed channel ",a)})),e.addEventListener(t.Constants.EventCode.PrivateMessage,(function(e){var n=e.vals[t.Constants.ParameterCode.Sender],s=e.vals[t.Constants.ParameterCode.Message],a=e.vals[t.Constants.ParameterCode.UserId],i="";i=o.getUserId()==n?a:n,o.getOrAddChannel(o.privateChannels,i,!0).lastId=e.vals[t.Constants.ParameterCode.MsgId],o.onPrivateMessage(i,new r(n,s))})),e.addEventListener(t.Constants.EventCode.StatusUpdate,(function(e){var n=e.vals[t.Constants.ParameterCode.Sender],r=e.vals[t.Constants.ParameterCode.Status],s=e.vals[t.Constants.ParameterCode.Message],a=void 0!==s;o.onUserStatusUpdate(n,r,a,s)})),e.addEventListener(t.Constants.EventCode.Subscribe,(function(n){e._logger.debug("ev Subscribe",n);var r={},s=n.vals[t.Constants.ParameterCode.Channels]||[],a=n.vals[t.Constants.ParameterCode.SubscribeResults]||[],i=!1,c=n.vals[t.Constants.ParameterCode.Properties],d=n.vals[t.Constants.ParameterCode.ChannelSubscribers];for(var p in null!=c&&(1==s.length?i=!0:o.logger.error("Subscribe event for multiple channels with channels properties returned. Ignoring properties.")),s){var l=s[p];if(r[l]=!1,p<a.length&&a[p]){var u=o.getOrAddChannel(o.publicChannels,l,!1);if(u.reset(),r[l]=!0,i&&(u.readProperties(c),d))for(var p in d)if(!u.addSubscriber(d[p])){e._logger.error("Subscribe: channel '"+l+"' max subscribers exceeded");break}}}o.onSubscribeResult(r)})),e.addEventListener(t.Constants.EventCode.Unsubscribe,(function(n){e._logger.debug("ev Unsubscribe",n);var r={},s=n.vals[t.Constants.ParameterCode.Channels]||[];for(var a in s){var i=s[a];delete o.publicChannels[i],r[i]=!0}o.onUnsubscribeResult(r)})),e.addEventListener(t.Constants.EventCode.UserSubscribe,(function(n){e._logger.debug("ev UserSubscribe",n);var r=n.vals[t.Constants.ParameterCode.Channel],s=n.vals[t.Constants.ParameterCode.UserId],a=o.publicChannels[r];null==a?e._logger.error("UserSubscribe: channel '"+r+"' not found"):a.addSubscriber(s)||e._logger.error("UserSubscribe: channel '"+r+"' max subscribers exceeded"),o.onUserSubscribe(r,s)})),e.addEventListener(t.Constants.EventCode.UserUnsubscribe,(function(n){e._logger.debug("ev UserUnsubscribe",n);var r=n.vals[t.Constants.ParameterCode.Channel],s=n.vals[t.Constants.ParameterCode.UserId],a=o.publicChannels[r];null==a?e._logger.debug("UserUnsubscribe: channel '"+r+"' not found"):a.removeSubscriber(s)||e._logger.debug("UserUnsubscribe: subscriber '"+s+"' not found in channel '"+r+"'"),o.onUserUnsubscribe(r,s)}))},ChatClient.StateToName=function(e){var t=ChatClient.chatStateName[e];return void 0===t?a.StateToName.call(this,e):t},ChatClient.ChatPeerErrorCode={Ok:0,FrontEndError:1001,FrontEndConnectFailed:1002,FrontEndConnectClosed:1003,FrontEndTimeout:1004,FrontEndEncryptionEstablishError:1005,FrontEndAuthenticationFailed:1101,NameServerError:3001,NameServerConnectFailed:3002,NameServerConnectClosed:3003,NameServerTimeout:3004,NameServerEncryptionEstablishError:300,NameServerAuthenticationFailed:3101},ChatClient.ChatState={Error:-1,Uninitialized:0,ConnectingToNameServer:1,ConnectedToNameServer:2,ConnectingToFrontEnd:3,ConnectedToFrontEnd:4,Disconnected:10},ChatClient.chatStateName=((o={})[ChatClient.ChatState.Error]="Error",o[ChatClient.ChatState.Uninitialized]="Uninitialized",o[ChatClient.ChatState.ConnectingToNameServer]="ConnectingToNameServer",o[ChatClient.ChatState.ConnectedToNameServer]="ConnectedToNameServer",o[ChatClient.ChatState.ConnectingToFrontEnd]="ConnectingToFrontEnd",o[ChatClient.ChatState.ConnectedToFrontEnd]="ConnectedToFrontEnd",o[ChatClient.ChatState.Disconnected]="Disconnected",o),ChatClient}(e.LoadBalancing.LoadBalancingClient);t.ChatClient=a}(e.Chat||(e.Chat={}))}(Photon||(Photon={}));var demo,__extends=this&&this.__extends||function(){var extendStatics=function(e,o){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=o[t])})(e,o)};return function(e,o){function __(){this.constructor=e}extendStatics(e,o),e.prototype=null===o?Object.create(o):(__.prototype=o.prototype,new __)}}(),DemoWss=this.AppInfo&&this.AppInfo.Wss,DemoAppId=this.AppInfo&&this.AppInfo.AppId?this.AppInfo.AppId:"<no-app-id>",DemoAppVersion=this.AppInfo&&this.AppInfo.AppVersion?this.AppInfo.AppVersion:"1.0",DemoMasterServer=this.AppInfo&&this.AppInfo.MasterServer,DemoNameServer=this.AppInfo&&this.AppInfo.NameServer,DemoRegion=this.AppInfo&&this.AppInfo.Region,DemoFbAppId=this.AppInfo&&this.AppInfo.FbAppId,ConnectOnStart=!1,DemoLoadBalancing=function(e){function DemoLoadBalancing(){var o=e.call(this,DemoWss?Photon.ConnectionProtocol.Wss:Photon.ConnectionProtocol.Ws,DemoAppId,DemoAppVersion)||this;return o.logger=new Exitgames.Common.Logger("Demo:"),o.USERCOLORS=["#FF0000","#00AA00","#0000FF","#FFFF00","#00FFFF","#FF00FF"],o.output(o.logger.format("Init",o.getNameServerAddress(),DemoAppId,DemoAppVersion)),o.logger.info("Init",o.getNameServerAddress(),DemoAppId,DemoAppVersion),o.setLogLevel(Exitgames.Common.Logger.Level.INFO),o.myActor().setCustomProperty("color",o.USERCOLORS[0]),o}return __extends(DemoLoadBalancing,e),DemoLoadBalancing.prototype.start=function(){this.setupUI(),ConnectOnStart&&(DemoMasterServer&&(this.setMasterServerAddress(DemoMasterServer),this.connect()),DemoNameServer?(this.setNameServerAddress(DemoNameServer),this.connectToRegionMaster(DemoRegion||"EU")):this.connectToRegionMaster(DemoRegion||"EU"))},DemoLoadBalancing.prototype.onError=function(e,o){this.output("Error "+e+": "+o)},DemoLoadBalancing.prototype.onEvent=function(e,o,t){switch(e){case 1:var n=o.message,a=o.senderName;t?this.output(a+": "+n,this.myRoomActors()[t].getCustomProperty("color")):this.output(a+": "+n)}this.logger.debug("onEvent",e,"content:",o,"actor:",t)},DemoLoadBalancing.prototype.onStateChange=function(e){var o=Photon.LoadBalancing.LoadBalancingClient;document.getElementById("statetxt").textContent=o.StateToName(e),this.updateRoomButtons(),this.updateRoomInfo()},DemoLoadBalancing.prototype.objToStr=function(e){var o="";for(var t in e)o+=(""==o?"":" ,")+t+"="+e[t];return o},DemoLoadBalancing.prototype.updateRoomInfo=function(){var e=document.getElementById("roominfo");for(var o in e.innerHTML="room: "+this.myRoom().name+" ["+this.objToStr(this.myRoom().getCustomProperties())+"] ["+this.myRoom().expectedUsers+"]",e.innerHTML=e.innerHTML+"<br>",e.innerHTML+=" actors: ",e.innerHTML=e.innerHTML+"<br>",this.myRoomActors()){var t=this.myRoomActors()[o];e.innerHTML+=" "+o+" "+t.name+" ["+this.objToStr(t.getCustomProperties())+"]",e.innerHTML=e.innerHTML+"<br>"}this.updateRoomButtons()},DemoLoadBalancing.prototype.onActorPropertiesChange=function(e){this.updateRoomInfo()},DemoLoadBalancing.prototype.onMyRoomPropertiesChange=function(){this.updateRoomInfo()},DemoLoadBalancing.prototype.onRoomListUpdate=function(e,o,t,n){this.logger.info("Demo: onRoomListUpdate",e,o,t,n),this.output("Demo: Rooms update: "+o.length+" updated, "+t.length+" added, "+n.length+" removed"),this.onRoomList(e),this.updateRoomButtons()},DemoLoadBalancing.prototype.onRoomList=function(e){for(var o=document.getElementById("gamelist");o.firstChild;)o.removeChild(o.firstChild);for(var t=0,n=0;n<e.length;++n){var a=e[n],r=document.createElement("option");r.attributes.value=a.name,r.textContent=a.name,o.appendChild(r),this.myRoom().name==a.name&&(t=n)}o.selectedIndex=t,this.output("Demo: Rooms total: "+e.length),this.updateRoomButtons()},DemoLoadBalancing.prototype.onJoinRoom=function(){this.output("Game "+this.myRoom().name+" joined"),this.updateRoomInfo()},DemoLoadBalancing.prototype.onActorJoin=function(e){this.output("actor "+e.actorNr+" joined"),this.updateRoomInfo()},DemoLoadBalancing.prototype.onActorLeave=function(e){this.output("actor "+e.actorNr+" left"),this.updateRoomInfo()},DemoLoadBalancing.prototype.sendMessage=function(e){try{this.raiseEvent(1,{message:e,senderName:"user"+this.myActor().actorNr}),this.output("me["+this.myActor().actorNr+"]: "+e,this.myActor().getCustomProperty("color"))}catch(e){this.output("error: "+e.message)}},DemoLoadBalancing.prototype.setupUI=function(){var e=this;this.logger.info("Setting up UI.");var o=document.getElementById("input");o.value="hello",o.focus(),document.getElementById("joingamebtn").onclick=function(o){if(e.isInLobby()){var t=document.getElementById("gamelist"),n=t.children[t.selectedIndex].textContent,a=document.getElementById("expectedusers");e.output(n),e.joinRoom(n,{expectedUsers:a.value.length>0?a.value.split(","):void 0})}else e.output("Reload page to connect to Master");return!1},document.getElementById("joinorcreategamebtn").onclick=function(o){if(e.isInLobby()){var t=document.getElementById("newgamename"),n=document.getElementById("expectedusers");e.output(t.value),e.joinRoom(t.value.length>0?t.value:void 0,{createIfNotExists:!0,expectedUsers:n.value.length>0?n.value.split(","):void 0})}else e.output("Reload page to connect to Master");return!1},document.getElementById("joinrandomgamebtn").onclick=function(o){if(e.isInLobby()){e.output("Random Game...");var t=document.getElementById("expectedusers");e.joinRandomRoom({expectedUsers:t.value.split(",")})}else e.output("Reload page to connect to Master");return!1},document.getElementById("newgamebtn").onclick=function(o){if(e.isInLobby()){var t=document.getElementById("newgamename");e.output("New Game");var n=document.getElementById("expectedusers");e.createRoom(t.value.length>0?t.value:void 0,{expectedUsers:n.value.length>0?n.value.split(","):void 0,maxPlayers:6})}else e.output("Reload page to connect to Master");return!1},document.getElementById("setexpectedusers").onclick=function(o){e.myRoom().setExpectedUsers(document.getElementById("expectedusers").value.split(","))},document.getElementById("clearexpectedusers").onclick=function(o){e.myRoom().clearExpectedUsers()},document.getElementById("mainfrm").onsubmit=function(){if(e.isJoinedToRoom()){var o=document.getElementById("input");e.sendMessage(o.value),o.value="",o.focus()}else e.isInLobby()?e.output("Press Join or New Game to connect to Game"):e.output("Reload page to connect to Master");return!1};var t=document.getElementById("leavebtn");t.onclick=function(o){return e.leaveRoom(),!1},(t=document.getElementById("colorbtn")).onclick=function(o){var t=Math.floor(Math.random()*e.USERCOLORS.length),n=e.USERCOLORS[t];e.myActor().setCustomProperty("color",n),e.sendMessage("... changed his / her color!")},this.updateRoomButtons()},DemoLoadBalancing.prototype.output=function(e,o){var t=document.getElementById("theDialogue"),n=e.replace(/&/,"&amp;").replace(/</,"&lt;").replace(/>/,"&gt;").replace(/"/,"&quot;");o&&(n="<FONT COLOR='"+o+"'>"+n+"</FONT>"),t.innerHTML=t.innerHTML+n+"<br>",t.scrollTop=t.scrollHeight},DemoLoadBalancing.prototype.updateRoomButtons=function(){document.getElementById("newgamebtn").disabled=!(this.isInLobby()&&!this.isJoinedToRoom());var e=this.isInLobby()&&!this.isJoinedToRoom()&&this.availableRooms().length>0;document.getElementById("joingamebtn").disabled=!e,document.getElementById("joinrandomgamebtn").disabled=!e,document.getElementById("leavebtn").disabled=!this.isJoinedToRoom()},DemoLoadBalancing}(Photon.LoadBalancing.LoadBalancingClient);window.onload=function(){(demo=new DemoLoadBalancing).start()};// p2.min.js
/**
 * The MIT License (MIT)
 *
 * Copyright (c) 2015 p2.js authors
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&false)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.p2=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){}var e=a("./Scalar");b.exports=d,d.lineInt=function(a,b,c){c=c||0;var d,f,g,h,i,j,k,l=[0,0];return d=a[1][1]-a[0][1],f=a[0][0]-a[1][0],g=d*a[0][0]+f*a[0][1],h=b[1][1]-b[0][1],i=b[0][0]-b[1][0],j=h*b[0][0]+i*b[0][1],k=d*i-h*f,e.eq(k,0,c)||(l[0]=(i*g-f*j)/k,l[1]=(d*j-h*g)/k),l},d.segmentsIntersect=function(a,b,c,d){var e=b[0]-a[0],f=b[1]-a[1],g=d[0]-c[0],h=d[1]-c[1];if(g*f-h*e==0)return!1;var i=(e*(c[1]-a[1])+f*(a[0]-c[0]))/(g*f-h*e),j=(g*(a[1]-c[1])+h*(c[0]-a[0]))/(h*e-g*f);return i>=0&&1>=i&&j>=0&&1>=j}},{"./Scalar":4}],2:[function(a,b,c){function d(){}b.exports=d,d.area=function(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1])},d.left=function(a,b,c){return d.area(a,b,c)>0},d.leftOn=function(a,b,c){return d.area(a,b,c)>=0},d.right=function(a,b,c){return d.area(a,b,c)<0},d.rightOn=function(a,b,c){return d.area(a,b,c)<=0};var e=[],f=[];d.collinear=function(a,b,c,g){if(g){var h=e,i=f;h[0]=b[0]-a[0],h[1]=b[1]-a[1],i[0]=c[0]-b[0],i[1]=c[1]-b[1];var j=h[0]*i[0]+h[1]*i[1],k=Math.sqrt(h[0]*h[0]+h[1]*h[1]),l=Math.sqrt(i[0]*i[0]+i[1]*i[1]),m=Math.acos(j/(k*l));return g>m}return 0==d.area(a,b,c)},d.sqdist=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d}},{}],3:[function(a,b,c){function d(){this.vertices=[]}function e(a,b,c,d,e){e=e||0;var f=b[1]-a[1],g=a[0]-b[0],i=f*a[0]+g*a[1],j=d[1]-c[1],k=c[0]-d[0],l=j*c[0]+k*c[1],m=f*k-j*g;return h.eq(m,0,e)?[0,0]:[(k*i-g*l)/m,(f*l-j*i)/m]}var f=a("./Line"),g=a("./Point"),h=a("./Scalar");b.exports=d,d.prototype.at=function(a){var b=this.vertices,c=b.length;return b[0>a?a%c+c:a%c]},d.prototype.first=function(){return this.vertices[0]},d.prototype.last=function(){return this.vertices[this.vertices.length-1]},d.prototype.clear=function(){this.vertices.length=0},d.prototype.append=function(a,b,c){if("undefined"==typeof b)throw new Error("From is not given!");if("undefined"==typeof c)throw new Error("To is not given!");if(b>c-1)throw new Error("lol1");if(c>a.vertices.length)throw new Error("lol2");if(0>b)throw new Error("lol3");for(var d=b;c>d;d++)this.vertices.push(a.vertices[d])},d.prototype.makeCCW=function(){for(var a=0,b=this.vertices,c=1;c<this.vertices.length;++c)(b[c][1]<b[a][1]||b[c][1]==b[a][1]&&b[c][0]>b[a][0])&&(a=c);g.left(this.at(a-1),this.at(a),this.at(a+1))||this.reverse()},d.prototype.reverse=function(){for(var a=[],b=0,c=this.vertices.length;b!==c;b++)a.push(this.vertices.pop());this.vertices=a},d.prototype.isReflex=function(a){return g.right(this.at(a-1),this.at(a),this.at(a+1))};var i=[],j=[];d.prototype.canSee=function(a,b){var c,d,e=i,h=j;if(g.leftOn(this.at(a+1),this.at(a),this.at(b))&&g.rightOn(this.at(a-1),this.at(a),this.at(b)))return!1;d=g.sqdist(this.at(a),this.at(b));for(var k=0;k!==this.vertices.length;++k)if((k+1)%this.vertices.length!==a&&k!==a&&g.leftOn(this.at(a),this.at(b),this.at(k+1))&&g.rightOn(this.at(a),this.at(b),this.at(k))&&(e[0]=this.at(a),e[1]=this.at(b),h[0]=this.at(k),h[1]=this.at(k+1),c=f.lineInt(e,h),g.sqdist(this.at(a),c)<d))return!1;return!0},d.prototype.copy=function(a,b,c){var e=c||new d;if(e.clear(),b>a)for(var f=a;b>=f;f++)e.vertices.push(this.vertices[f]);else{for(var f=0;b>=f;f++)e.vertices.push(this.vertices[f]);for(var f=a;f<this.vertices.length;f++)e.vertices.push(this.vertices[f])}return e},d.prototype.getCutEdges=function(){for(var a=[],b=[],c=[],e=new d,f=Number.MAX_VALUE,g=0;g<this.vertices.length;++g)if(this.isReflex(g))for(var h=0;h<this.vertices.length;++h)if(this.canSee(g,h)){b=this.copy(g,h,e).getCutEdges(),c=this.copy(h,g,e).getCutEdges();for(var i=0;i<c.length;i++)b.push(c[i]);b.length<f&&(a=b,f=b.length,a.push([this.at(g),this.at(h)]))}return a},d.prototype.decomp=function(){var a=this.getCutEdges();return a.length>0?this.slice(a):[this]},d.prototype.slice=function(a){if(0==a.length)return[this];if(a instanceof Array&&a.length&&a[0]instanceof Array&&2==a[0].length&&a[0][0]instanceof Array){for(var b=[this],c=0;c<a.length;c++)for(var d=a[c],e=0;e<b.length;e++){var f=b[e],g=f.slice(d);if(g){b.splice(e,1),b.push(g[0],g[1]);break}}return b}var d=a,c=this.vertices.indexOf(d[0]),e=this.vertices.indexOf(d[1]);return-1!=c&&-1!=e?[this.copy(c,e),this.copy(e,c)]:!1},d.prototype.isSimple=function(){for(var a=this.vertices,b=0;b<a.length-1;b++)for(var c=0;b-1>c;c++)if(f.segmentsIntersect(a[b],a[b+1],a[c],a[c+1]))return!1;for(var b=1;b<a.length-2;b++)if(f.segmentsIntersect(a[0],a[a.length-1],a[b],a[b+1]))return!1;return!0},d.prototype.quickDecomp=function(a,b,c,f,h,i){h=h||100,i=i||0,f=f||25,a="undefined"!=typeof a?a:[],b=b||[],c=c||[];var j=[0,0],k=[0,0],l=[0,0],m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=new d,u=new d,v=this,w=this.vertices;if(w.length<3)return a;if(i++,i>h)return console.warn("quickDecomp: max level ("+h+") reached."),a;for(var x=0;x<this.vertices.length;++x)if(v.isReflex(x)){b.push(v.vertices[x]),m=n=Number.MAX_VALUE;for(var y=0;y<this.vertices.length;++y)g.left(v.at(x-1),v.at(x),v.at(y))&&g.rightOn(v.at(x-1),v.at(x),v.at(y-1))&&(l=e(v.at(x-1),v.at(x),v.at(y),v.at(y-1)),g.right(v.at(x+1),v.at(x),l)&&(o=g.sqdist(v.vertices[x],l),n>o&&(n=o,k=l,r=y))),g.left(v.at(x+1),v.at(x),v.at(y+1))&&g.rightOn(v.at(x+1),v.at(x),v.at(y))&&(l=e(v.at(x+1),v.at(x),v.at(y),v.at(y+1)),g.left(v.at(x-1),v.at(x),l)&&(o=g.sqdist(v.vertices[x],l),m>o&&(m=o,j=l,q=y)));if(r==(q+1)%this.vertices.length)l[0]=(k[0]+j[0])/2,l[1]=(k[1]+j[1])/2,c.push(l),q>x?(t.append(v,x,q+1),t.vertices.push(l),u.vertices.push(l),0!=r&&u.append(v,r,v.vertices.length),u.append(v,0,x+1)):(0!=x&&t.append(v,x,v.vertices.length),t.append(v,0,q+1),t.vertices.push(l),u.vertices.push(l),u.append(v,r,x+1));else{if(r>q&&(q+=this.vertices.length),p=Number.MAX_VALUE,r>q)return a;for(var y=r;q>=y;++y)g.leftOn(v.at(x-1),v.at(x),v.at(y))&&g.rightOn(v.at(x+1),v.at(x),v.at(y))&&(o=g.sqdist(v.at(x),v.at(y)),p>o&&(p=o,s=y%this.vertices.length));s>x?(t.append(v,x,s+1),0!=s&&u.append(v,s,w.length),u.append(v,0,x+1)):(0!=x&&t.append(v,x,w.length),t.append(v,0,s+1),u.append(v,s,x+1))}return t.vertices.length<u.vertices.length?(t.quickDecomp(a,b,c,f,h,i),u.quickDecomp(a,b,c,f,h,i)):(u.quickDecomp(a,b,c,f,h,i),t.quickDecomp(a,b,c,f,h,i)),a}return a.push(this),a},d.prototype.removeCollinearPoints=function(a){for(var b=0,c=this.vertices.length-1;this.vertices.length>3&&c>=0;--c)g.collinear(this.at(c-1),this.at(c),this.at(c+1),a)&&(this.vertices.splice(c%this.vertices.length,1),c--,b++);return b}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(a,b,c){function d(){}b.exports=d,d.eq=function(a,b,c){return c=c||0,Math.abs(a-b)<c}},{}],5:[function(a,b,c){b.exports={Polygon:a("./Polygon"),Point:a("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(a,b,c){b.exports={name:"p2",version:"0.7.1",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.1"}}},{}],7:[function(a,b,c){function d(a){this.lowerBound=e.create(),a&&a.lowerBound&&e.copy(this.lowerBound,a.lowerBound),this.upperBound=e.create(),a&&a.upperBound&&e.copy(this.upperBound,a.upperBound)}var e=a("../math/vec2");a("../utils/Utils");b.exports=d;var f=e.create();d.prototype.setFromPoints=function(a,b,c,d){var g=this.lowerBound,h=this.upperBound;"number"!=typeof c&&(c=0),0!==c?e.rotate(g,a[0],c):e.copy(g,a[0]),e.copy(h,g);for(var i=Math.cos(c),j=Math.sin(c),k=1;k<a.length;k++){var l=a[k];if(0!==c){var m=l[0],n=l[1];f[0]=i*m-j*n,f[1]=j*m+i*n,l=f}for(var o=0;2>o;o++)l[o]>h[o]&&(h[o]=l[o]),l[o]<g[o]&&(g[o]=l[o])}b&&(e.add(this.lowerBound,this.lowerBound,b),e.add(this.upperBound,this.upperBound,b)),d&&(this.lowerBound[0]-=d,this.lowerBound[1]-=d,this.upperBound[0]+=d,this.upperBound[1]+=d)},d.prototype.copy=function(a){e.copy(this.lowerBound,a.lowerBound),e.copy(this.upperBound,a.upperBound)},d.prototype.extend=function(a){for(var b=2;b--;){var c=a.lowerBound[b];this.lowerBound[b]>c&&(this.lowerBound[b]=c);var d=a.upperBound[b];this.upperBound[b]<d&&(this.upperBound[b]=d)}},d.prototype.overlaps=function(a){var b=this.lowerBound,c=this.upperBound,d=a.lowerBound,e=a.upperBound;return(d[0]<=c[0]&&c[0]<=e[0]||b[0]<=e[0]&&e[0]<=c[0])&&(d[1]<=c[1]&&c[1]<=e[1]||b[1]<=e[1]&&e[1]<=c[1])},d.prototype.containsPoint=function(a){var b=this.lowerBound,c=this.upperBound;return b[0]<=a[0]&&a[0]<=c[0]&&b[1]<=a[1]&&a[1]<=c[1]},d.prototype.overlapsRay=function(a){var b=1/a.direction[0],c=1/a.direction[1],d=(this.lowerBound[0]-a.from[0])*b,e=(this.upperBound[0]-a.from[0])*b,f=(this.lowerBound[1]-a.from[1])*c,g=(this.upperBound[1]-a.from[1])*c,h=Math.max(Math.max(Math.min(d,e),Math.min(f,g))),i=Math.min(Math.min(Math.max(d,e),Math.max(f,g)));return 0>i?-1:h>i?-1:h}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(a,b,c){function d(a){this.type=a,this.result=[],this.world=null,this.boundingVolumeType=d.AABB}var e=a("../math/vec2"),f=a("../objects/Body");b.exports=d,d.AABB=1,d.BOUNDING_CIRCLE=2,d.prototype.setWorld=function(a){this.world=a},d.prototype.getCollisionPairs=function(a){};var g=e.create();d.boundingRadiusCheck=function(a,b){e.sub(g,a.position,b.position);var c=e.squaredLength(g),d=a.boundingRadius+b.boundingRadius;return d*d>=c},d.aabbCheck=function(a,b){return a.getAABB().overlaps(b.getAABB())},d.prototype.boundingVolumeCheck=function(a,b){var c;switch(this.boundingVolumeType){case d.BOUNDING_CIRCLE:c=d.boundingRadiusCheck(a,b);break;case d.AABB:c=d.aabbCheck(a,b);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return c},d.canCollide=function(a,b){var c=f.KINEMATIC,d=f.STATIC;return a.type===d&&b.type===d?!1:a.type===c&&b.type===d||a.type===d&&b.type===c?!1:a.type===c&&b.type===c?!1:a.sleepState===f.SLEEPING&&b.sleepState===f.SLEEPING?!1:a.sleepState===f.SLEEPING&&b.type===d||b.sleepState===f.SLEEPING&&a.type===d?!1:!0},d.NAIVE=1,d.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(a,b,c){function d(){e.call(this,e.NAIVE)}var e=(a("../shapes/Circle"),a("../shapes/Plane"),a("../shapes/Shape"),a("../shapes/Particle"),a("../collision/Broadphase"));a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.getCollisionPairs=function(a){var b=a.bodies,c=this.result;c.length=0;for(var d=0,f=b.length;d!==f;d++)for(var g=b[d],h=0;d>h;h++){var i=b[h];e.canCollide(g,i)&&this.boundingVolumeCheck(g,i)&&c.push(g,i)}return c},d.prototype.aabbQuery=function(a,b,c){c=c||[];for(var d=a.bodies,e=0;e<d.length;e++){var f=d[e];f.aabbNeedsUpdate&&f.updateAABB(),f.aabb.overlaps(b)&&c.push(f)}return c}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(a,b,c){function d(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new k({size:32}),this.frictionEquationPool=new l({size:64}),this.restitution=0,this.stiffness=n.DEFAULT_STIFFNESS,this.relaxation=n.DEFAULT_RELAXATION,this.frictionStiffness=n.DEFAULT_STIFFNESS,this.frictionRelaxation=n.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new m,this.contactSkinSize=.01}function e(a,b){g.set(a.vertices[0],.5*-b.length,-b.radius),g.set(a.vertices[1],.5*b.length,-b.radius),g.set(a.vertices[2],.5*b.length,b.radius),g.set(a.vertices[3],.5*-b.length,b.radius)}function f(a,b,c,d){for(var e=T,f=U,j=V,k=W,l=a,m=b.vertices,n=null,o=0;o!==m.length+1;o++){var p=m[o%m.length],q=m[(o+1)%m.length];g.rotate(e,p,d),g.rotate(f,q,d),i(e,e,c),i(f,f,c),h(j,e,l),h(k,f,l);var r=g.crossLength(j,k);if(null===n&&(n=r),0>=r*n)return!1;n=r}return!0}var g=a("../math/vec2"),h=g.sub,i=g.add,j=g.dot,k=(a("../utils/Utils"),a("../utils/ContactEquationPool")),l=a("../utils/FrictionEquationPool"),m=a("../utils/TupleDictionary"),n=a("../equations/Equation"),o=(a("../equations/ContactEquation"),a("../equations/FrictionEquation"),a("../shapes/Circle")),p=a("../shapes/Convex"),q=a("../shapes/Shape"),r=(a("../objects/Body"),a("../shapes/Box"));b.exports=d;var s=g.fromValues(0,1),t=g.fromValues(0,0),u=g.fromValues(0,0),v=g.fromValues(0,0),w=g.fromValues(0,0),x=g.fromValues(0,0),y=g.fromValues(0,0),z=g.fromValues(0,0),A=g.fromValues(0,0),B=g.fromValues(0,0),C=g.fromValues(0,0),D=g.fromValues(0,0),E=g.fromValues(0,0),F=g.fromValues(0,0),G=g.fromValues(0,0),H=g.fromValues(0,0),I=g.fromValues(0,0),J=g.fromValues(0,0),K=g.fromValues(0,0),L=[],M=g.create(),N=g.create();d.prototype.bodiesOverlap=function(a,b){for(var c=M,d=N,e=0,f=a.shapes.length;e!==f;e++){var g=a.shapes[e];a.toWorldFrame(c,g.position);for(var h=0,i=b.shapes.length;h!==i;h++){var j=b.shapes[h];if(b.toWorldFrame(d,j.position),this[g.type|j.type](a,g,c,g.angle+a.angle,b,j,d,j.angle+b.angle,!0))return!0}}return!1},d.prototype.collidedLastStep=function(a,b){var c=0|a.id,d=0|b.id;return!!this.collidingBodiesLastStep.get(c,d)},d.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var a=this.contactEquations,b=a.length;b--;){var c=a[b],d=c.bodyA.id,e=c.bodyB.id;this.collidingBodiesLastStep.set(d,e,!0)}for(var f=this.contactEquations,g=this.frictionEquations,h=0;h<f.length;h++)this.contactEquationPool.release(f[h]);for(var h=0;h<g.length;h++)this.frictionEquationPool.release(g[h]);this.contactEquations.length=this.frictionEquations.length=0},d.prototype.createContactEquation=function(a,b,c,d){var e=this.contactEquationPool.get();return e.bodyA=a,e.bodyB=b,e.shapeA=c,e.shapeB=d,e.restitution=this.restitution,e.firstImpact=!this.collidedLastStep(a,b),e.stiffness=this.stiffness,e.relaxation=this.relaxation,e.needsUpdate=!0,e.enabled=this.enabledEquations,e.offset=this.contactSkinSize,e},d.prototype.createFrictionEquation=function(a,b,c,d){var e=this.frictionEquationPool.get();return e.bodyA=a,e.bodyB=b,e.shapeA=c,e.shapeB=d,e.setSlipForce(this.slipForce),e.frictionCoefficient=this.frictionCoefficient,e.relativeVelocity=this.surfaceVelocity,e.enabled=this.enabledEquations,e.needsUpdate=!0,e.stiffness=this.frictionStiffness,e.relaxation=this.frictionRelaxation,e.contactEquations.length=0,e},d.prototype.createFrictionFromContact=function(a){var b=this.createFrictionEquation(a.bodyA,a.bodyB,a.shapeA,a.shapeB);return g.copy(b.contactPointA,a.contactPointA),g.copy(b.contactPointB,a.contactPointB),g.rotate90cw(b.t,a.normalA),b.contactEquations.push(a),b},d.prototype.createFrictionFromAverage=function(a){var b=this.contactEquations[this.contactEquations.length-1],c=this.createFrictionEquation(b.bodyA,b.bodyB,b.shapeA,b.shapeB),d=b.bodyA;b.bodyB;g.set(c.contactPointA,0,0),g.set(c.contactPointB,0,0),g.set(c.t,0,0);for(var e=0;e!==a;e++)b=this.contactEquations[this.contactEquations.length-1-e],b.bodyA===d?(g.add(c.t,c.t,b.normalA),g.add(c.contactPointA,c.contactPointA,b.contactPointA),g.add(c.contactPointB,c.contactPointB,b.contactPointB)):(g.sub(c.t,c.t,b.normalA),g.add(c.contactPointA,c.contactPointA,b.contactPointB),g.add(c.contactPointB,c.contactPointB,b.contactPointA)),c.contactEquations.push(b);var f=1/a;return g.scale(c.contactPointA,c.contactPointA,f),g.scale(c.contactPointB,c.contactPointB,f),g.normalize(c.t,c.t),g.rotate90cw(c.t,c.t),c},d.prototype[q.LINE|q.CONVEX]=d.prototype.convexLine=function(a,b,c,d,e,f,g,h,i){return i?!1:0},d.prototype[q.LINE|q.BOX]=d.prototype.lineBox=function(a,b,c,d,e,f,g,h,i){return i?!1:0};var O=new r({width:1,height:1}),P=g.create();d.prototype[q.CAPSULE|q.CONVEX]=d.prototype[q.CAPSULE|q.BOX]=d.prototype.convexCapsule=function(a,b,c,d,f,h,i,j,k){var l=P;g.set(l,h.length/2,0),g.rotate(l,l,j),g.add(l,l,i);var m=this.circleConvex(f,h,l,j,a,b,c,d,k,h.radius);g.set(l,-h.length/2,0),g.rotate(l,l,j),g.add(l,l,i);var n=this.circleConvex(f,h,l,j,a,b,c,d,k,h.radius);if(k&&(m||n))return!0;var o=O;e(o,h);var p=this.convexConvex(a,b,c,d,f,o,i,j,k);return p+m+n},d.prototype[q.CAPSULE|q.LINE]=d.prototype.lineCapsule=function(a,b,c,d,e,f,g,h,i){return i?!1:0};var Q=g.create(),R=g.create(),S=new r({width:1,height:1});d.prototype[q.CAPSULE|q.CAPSULE]=d.prototype.capsuleCapsule=function(a,b,c,d,f,h,i,j,k){for(var l,m=Q,n=R,o=0,p=0;2>p;p++){g.set(m,(0===p?-1:1)*b.length/2,0),g.rotate(m,m,d),g.add(m,m,c);for(var q=0;2>q;q++){g.set(n,(0===q?-1:1)*h.length/2,0),g.rotate(n,n,j),g.add(n,n,i),this.enableFrictionReduction&&(l=this.enableFriction,this.enableFriction=!1);var r=this.circleCircle(a,b,m,d,f,h,n,j,k,b.radius,h.radius);if(this.enableFrictionReduction&&(this.enableFriction=l),k&&r)return!0;o+=r}}this.enableFrictionReduction&&(l=this.enableFriction,this.enableFriction=!1);var s=S;e(s,b);var t=this.convexCapsule(a,s,c,d,f,h,i,j,k);if(this.enableFrictionReduction&&(this.enableFriction=l),k&&t)return!0;if(o+=t,this.enableFrictionReduction){var l=this.enableFriction;this.enableFriction=!1}e(s,h);var u=this.convexCapsule(f,s,i,j,a,b,c,d,k);return this.enableFrictionReduction&&(this.enableFriction=l),k&&u?!0:(o+=u,this.enableFrictionReduction&&o&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(o)),o)},d.prototype[q.LINE|q.LINE]=d.prototype.lineLine=function(a,b,c,d,e,f,g,h,i){return i?!1:0},d.prototype[q.PLANE|q.LINE]=d.prototype.planeLine=function(a,b,c,d,e,f,k,l,m){var n=t,o=u,p=v,q=w,r=x,C=y,D=z,E=A,F=B,G=L,H=0;g.set(n,-f.length/2,0),g.set(o,f.length/2,0),g.rotate(p,n,l),g.rotate(q,o,l),i(p,p,k),i(q,q,k),g.copy(n,p),g.copy(o,q),h(r,o,n),g.normalize(C,r),g.rotate90cw(F,C),g.rotate(E,s,d),G[0]=n,G[1]=o;for(var I=0;I<G.length;I++){var J=G[I];h(D,J,c);var K=j(D,E);if(0>K){if(m)return!0;var M=this.createContactEquation(a,e,b,f);H++,g.copy(M.normalA,E),g.normalize(M.normalA,M.normalA),g.scale(D,E,K),h(M.contactPointA,J,D),h(M.contactPointA,M.contactPointA,a.position),h(M.contactPointB,J,k),i(M.contactPointB,M.contactPointB,k),h(M.contactPointB,M.contactPointB,e.position),this.contactEquations.push(M),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(M))}}return m?!1:(this.enableFrictionReduction||H&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(H)),H)},d.prototype[q.PARTICLE|q.CAPSULE]=d.prototype.particleCapsule=function(a,b,c,d,e,f,g,h,i){return this.circleLine(a,b,c,d,e,f,g,h,i,f.radius,0)},d.prototype[q.CIRCLE|q.LINE]=d.prototype.circleLine=function(a,b,c,d,e,f,k,l,m,n,o){var n=n||0,o="undefined"!=typeof o?o:b.radius,p=t,q=u,r=v,s=w,H=x,I=y,J=z,K=A,M=B,N=C,O=D,P=E,Q=F,R=G,S=L;g.set(K,-f.length/2,0),g.set(M,f.length/2,0),g.rotate(N,K,l),g.rotate(O,M,l),i(N,N,k),i(O,O,k),g.copy(K,N),g.copy(M,O),h(I,M,K),g.normalize(J,I),g.rotate90cw(H,J),h(P,c,K);var T=j(P,H);h(s,K,k),h(Q,c,k);var U=o+n;if(Math.abs(T)<U){g.scale(p,H,T),h(r,c,p),g.scale(q,H,j(H,Q)),g.normalize(q,q),g.scale(q,q,n),i(r,r,q);var V=j(J,r),W=j(J,K),X=j(J,M);if(V>W&&X>V){if(m)return!0;var Y=this.createContactEquation(a,e,b,f);return g.scale(Y.normalA,p,-1),g.normalize(Y.normalA,Y.normalA),g.scale(Y.contactPointA,Y.normalA,o),i(Y.contactPointA,Y.contactPointA,c),h(Y.contactPointA,Y.contactPointA,a.position),h(Y.contactPointB,r,k),i(Y.contactPointB,Y.contactPointB,k),h(Y.contactPointB,Y.contactPointB,e.position),this.contactEquations.push(Y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Y)),1}}S[0]=K,S[1]=M;for(var Z=0;Z<S.length;Z++){var $=S[Z];if(h(P,$,c),g.squaredLength(P)<Math.pow(U,2)){if(m)return!0;var Y=this.createContactEquation(a,e,b,f);return g.copy(Y.normalA,P),g.normalize(Y.normalA,Y.normalA),g.scale(Y.contactPointA,Y.normalA,o),i(Y.contactPointA,Y.contactPointA,c),h(Y.contactPointA,Y.contactPointA,a.position),h(Y.contactPointB,$,k),g.scale(R,Y.normalA,-n),i(Y.contactPointB,Y.contactPointB,R),i(Y.contactPointB,Y.contactPointB,k),h(Y.contactPointB,Y.contactPointB,e.position),this.contactEquations.push(Y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Y)),1}}return 0},d.prototype[q.CIRCLE|q.CAPSULE]=d.prototype.circleCapsule=function(a,b,c,d,e,f,g,h,i){return this.circleLine(a,b,c,d,e,f,g,h,i,f.radius)},d.prototype[q.CIRCLE|q.CONVEX]=d.prototype[q.CIRCLE|q.BOX]=d.prototype.circleConvex=function(a,b,c,d,e,j,k,l,m,n){for(var n="number"==typeof n?n:b.radius,o=t,p=u,q=v,r=w,s=x,y=C,z=D,A=F,B=G,E=H,J=I,K=!1,L=Number.MAX_VALUE,M=j.vertices,N=0;N!==M.length+1;N++){var O=M[N%M.length],P=M[(N+1)%M.length];if(g.rotate(o,O,l),g.rotate(p,P,l),i(o,o,k),i(p,p,k),h(q,p,o),g.normalize(r,q),g.rotate90cw(s,r),g.scale(B,s,-b.radius),i(B,B,c),f(B,j,k,l)){g.sub(E,o,B);var Q=Math.abs(g.dot(E,s));L>Q&&(g.copy(J,B),L=Q,g.scale(A,s,Q),g.add(A,A,B),K=!0)}}if(K){if(m)return!0;var R=this.createContactEquation(a,e,b,j);return g.sub(R.normalA,J,c),g.normalize(R.normalA,R.normalA),g.scale(R.contactPointA,R.normalA,n),i(R.contactPointA,R.contactPointA,c),h(R.contactPointA,R.contactPointA,a.position),h(R.contactPointB,A,k),i(R.contactPointB,R.contactPointB,k),h(R.contactPointB,R.contactPointB,e.position),this.contactEquations.push(R),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(R)),1}if(n>0)for(var N=0;N<M.length;N++){var S=M[N];if(g.rotate(z,S,l),i(z,z,k),h(y,z,c),g.squaredLength(y)<Math.pow(n,2)){if(m)return!0;var R=this.createContactEquation(a,e,b,j);return g.copy(R.normalA,y),g.normalize(R.normalA,R.normalA),g.scale(R.contactPointA,R.normalA,n),i(R.contactPointA,R.contactPointA,c),h(R.contactPointA,R.contactPointA,a.position),h(R.contactPointB,z,k),i(R.contactPointB,R.contactPointB,k),h(R.contactPointB,R.contactPointB,e.position),this.contactEquations.push(R),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(R)),1}}return 0};var T=g.create(),U=g.create(),V=g.create(),W=g.create();d.prototype[q.PARTICLE|q.CONVEX]=d.prototype[q.PARTICLE|q.BOX]=d.prototype.particleConvex=function(a,b,c,d,e,k,l,m,n){var o=t,p=u,q=v,r=w,s=x,A=y,B=z,D=C,E=F,G=J,H=K,I=Number.MAX_VALUE,L=!1,M=k.vertices;if(!f(c,k,l,m))return 0;if(n)return!0;for(var N=0;N!==M.length+1;N++){var O=M[N%M.length],P=M[(N+1)%M.length];g.rotate(o,O,m),g.rotate(p,P,m),i(o,o,l),i(p,p,l),h(q,p,o),g.normalize(r,q),g.rotate90cw(s,r),h(D,c,o);j(D,s);h(A,o,l),h(B,c,l),g.sub(G,o,c);var Q=Math.abs(g.dot(G,s));I>Q&&(I=Q,g.scale(E,s,Q),g.add(E,E,c),g.copy(H,s),L=!0)}if(L){var R=this.createContactEquation(a,e,b,k);return g.scale(R.normalA,H,-1),g.normalize(R.normalA,R.normalA),g.set(R.contactPointA,0,0),i(R.contactPointA,R.contactPointA,c),h(R.contactPointA,R.contactPointA,a.position),h(R.contactPointB,E,l),i(R.contactPointB,R.contactPointB,l),h(R.contactPointB,R.contactPointB,e.position),this.contactEquations.push(R),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(R)),1}return 0},d.prototype[q.CIRCLE]=d.prototype.circleCircle=function(a,b,c,d,e,f,j,k,l,m,n){var o=t,m=m||b.radius,n=n||f.radius;h(o,c,j);var p=m+n;if(g.squaredLength(o)>Math.pow(p,2))return 0;if(l)return!0;var q=this.createContactEquation(a,e,b,f);return h(q.normalA,j,c),g.normalize(q.normalA,q.normalA),g.scale(q.contactPointA,q.normalA,m),g.scale(q.contactPointB,q.normalA,-n),i(q.contactPointA,q.contactPointA,c),h(q.contactPointA,q.contactPointA,a.position),i(q.contactPointB,q.contactPointB,j),h(q.contactPointB,q.contactPointB,e.position),this.contactEquations.push(q),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(q)),1},d.prototype[q.PLANE|q.CONVEX]=d.prototype[q.PLANE|q.BOX]=d.prototype.planeConvex=function(a,b,c,d,e,f,k,l,m){var n=t,o=u,p=v,q=0;g.rotate(o,s,d);for(var r=0;r!==f.vertices.length;r++){var w=f.vertices[r];if(g.rotate(n,w,l),i(n,n,k),h(p,n,c),j(p,o)<=0){if(m)return!0;q++;var x=this.createContactEquation(a,e,b,f);h(p,n,c),g.copy(x.normalA,o);var y=j(p,x.normalA);g.scale(p,x.normalA,y),h(x.contactPointB,n,e.position),h(x.contactPointA,n,p),h(x.contactPointA,x.contactPointA,a.position),this.contactEquations.push(x),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x))}}return this.enableFrictionReduction&&this.enableFriction&&q&&this.frictionEquations.push(this.createFrictionFromAverage(q)),q},d.prototype[q.PARTICLE|q.PLANE]=d.prototype.particlePlane=function(a,b,c,d,e,f,i,k,l){var m=t,n=u;k=k||0,h(m,c,i),g.rotate(n,s,k);var o=j(m,n);if(o>0)return 0;if(l)return!0;var p=this.createContactEquation(e,a,f,b);return g.copy(p.normalA,n),g.scale(m,p.normalA,o),h(p.contactPointA,c,m),h(p.contactPointA,p.contactPointA,e.position),h(p.contactPointB,c,a.position),this.contactEquations.push(p),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(p)),1},d.prototype[q.CIRCLE|q.PARTICLE]=d.prototype.circleParticle=function(a,b,c,d,e,f,j,k,l){var m=t;if(h(m,j,c),g.squaredLength(m)>Math.pow(b.radius,2))return 0;if(l)return!0;var n=this.createContactEquation(a,e,b,f);return g.copy(n.normalA,m),g.normalize(n.normalA,n.normalA),g.scale(n.contactPointA,n.normalA,b.radius),i(n.contactPointA,n.contactPointA,c),h(n.contactPointA,n.contactPointA,a.position),h(n.contactPointB,j,e.position),this.contactEquations.push(n),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(n)),1};var X=new o({radius:1}),Y=g.create(),Z=g.create();g.create();d.prototype[q.PLANE|q.CAPSULE]=d.prototype.planeCapsule=function(a,b,c,d,e,f,h,j,k){var l=Y,m=Z,n=X;g.set(l,-f.length/2,0),g.rotate(l,l,j),i(l,l,h),g.set(m,f.length/2,0),g.rotate(m,m,j),i(m,m,h),n.radius=f.radius;var o;this.enableFrictionReduction&&(o=this.enableFriction,this.enableFriction=!1);var p=this.circlePlane(e,n,l,0,a,b,c,d,k),q=this.circlePlane(e,n,m,0,a,b,c,d,k);if(this.enableFrictionReduction&&(this.enableFriction=o),k)return p||q;var r=p+q;return this.enableFrictionReduction&&r&&this.frictionEquations.push(this.createFrictionFromAverage(r)),r},d.prototype[q.CIRCLE|q.PLANE]=d.prototype.circlePlane=function(a,b,c,d,e,f,k,l,m){var n=a,o=b,p=c,q=e,r=k,w=l;w=w||0;var x=t,y=u,z=v;h(x,p,r),g.rotate(y,s,w);var A=j(y,x);if(A>o.radius)return 0;if(m)return!0;var B=this.createContactEquation(q,n,f,b);return g.copy(B.normalA,y),g.scale(B.contactPointB,B.normalA,-o.radius),i(B.contactPointB,B.contactPointB,p),h(B.contactPointB,B.contactPointB,n.position),g.scale(z,B.normalA,A),h(B.contactPointA,x,z),i(B.contactPointA,B.contactPointA,r),h(B.contactPointA,B.contactPointA,q.position),this.contactEquations.push(B),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(B)),1},d.prototype[q.CONVEX]=d.prototype[q.CONVEX|q.BOX]=d.prototype[q.BOX]=d.prototype.convexConvex=function(a,b,c,e,f,k,l,m,n,o){var p=t,q=u,r=v,s=w,y=x,C=z,D=A,E=B,F=0,o="number"==typeof o?o:0,G=d.findSeparatingAxis(b,c,e,k,l,m,p);if(!G)return 0;h(D,l,c),j(p,D)>0&&g.scale(p,p,-1);var H=d.getClosestEdge(b,e,p,!0),I=d.getClosestEdge(k,m,p);if(-1===H||-1===I)return 0;for(var J=0;2>J;J++){var K=H,L=I,M=b,N=k,O=c,P=l,Q=e,R=m,S=a,T=f;if(0===J){var U;U=K,K=L,L=U,U=M,M=N,N=U,U=O,O=P,P=U,U=Q,Q=R,R=U,U=S,S=T,T=U}for(var V=L;L+2>V;V++){var W=N.vertices[(V+N.vertices.length)%N.vertices.length];g.rotate(q,W,R),i(q,q,P);for(var X=0,Y=K-1;K+2>Y;Y++){var Z=M.vertices[(Y+M.vertices.length)%M.vertices.length],$=M.vertices[(Y+1+M.vertices.length)%M.vertices.length];g.rotate(r,Z,Q),g.rotate(s,$,Q),i(r,r,O),i(s,s,O),h(y,s,r),g.rotate90cw(E,y),g.normalize(E,E),h(D,q,r);var _=j(E,D);(Y===K&&o>=_||Y!==K&&0>=_)&&X++}if(X>=3){if(n)return!0;var aa=this.createContactEquation(S,T,M,N);F++;var Z=M.vertices[K%M.vertices.length],$=M.vertices[(K+1)%M.vertices.length];g.rotate(r,Z,Q),g.rotate(s,$,Q),i(r,r,O),i(s,s,O),h(y,s,r),g.rotate90cw(aa.normalA,y),g.normalize(aa.normalA,aa.normalA),h(D,q,r);var _=j(aa.normalA,D);g.scale(C,aa.normalA,_),h(aa.contactPointA,q,O),h(aa.contactPointA,aa.contactPointA,C),i(aa.contactPointA,aa.contactPointA,O),h(aa.contactPointA,aa.contactPointA,S.position),h(aa.contactPointB,q,P),i(aa.contactPointB,aa.contactPointB,P),h(aa.contactPointB,aa.contactPointB,T.position),this.contactEquations.push(aa),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(aa))}}}return this.enableFrictionReduction&&this.enableFriction&&F&&this.frictionEquations.push(this.createFrictionFromAverage(F)),F};var $=g.fromValues(0,0);d.projectConvexOntoAxis=function(a,b,c,d,e){var f,h,i=null,k=null,l=$;g.rotate(l,d,-c);for(var m=0;m<a.vertices.length;m++)f=a.vertices[m],h=j(f,l),(null===i||h>i)&&(i=h),(null===k||k>h)&&(k=h);if(k>i){var n=k;k=i,i=n}var o=j(b,d);g.set(e,k+o,i+o)};var _=g.fromValues(0,0),aa=g.fromValues(0,0),ba=g.fromValues(0,0),ca=g.fromValues(0,0),da=g.fromValues(0,0),ea=g.fromValues(0,0);d.findSeparatingAxis=function(a,b,c,e,f,i,j){var k=null,l=!1,m=!1,n=_,o=aa,p=ba,q=ca,s=da,t=ea;if(a instanceof r&&e instanceof r)for(var u=0;2!==u;u++){var v=a,w=c;1===u&&(v=e,w=i);for(var x=0;2!==x;x++){0===x?g.set(q,0,1):1===x&&g.set(q,1,0),0!==w&&g.rotate(q,q,w),d.projectConvexOntoAxis(a,b,c,q,s),d.projectConvexOntoAxis(e,f,i,q,t);var y=s,z=t,A=!1;s[0]>t[0]&&(z=s,y=t,A=!0);var B=z[0]-y[1];l=0>=B,(null===k||B>k)&&(g.copy(j,q),k=B,m=l)}}else for(var u=0;2!==u;u++){var v=a,w=c;1===u&&(v=e,w=i);for(var x=0;x!==v.vertices.length;x++){g.rotate(o,v.vertices[x],w),g.rotate(p,v.vertices[(x+1)%v.vertices.length],w),h(n,p,o),g.rotate90cw(q,n),g.normalize(q,q),d.projectConvexOntoAxis(a,b,c,q,s),d.projectConvexOntoAxis(e,f,i,q,t);var y=s,z=t,A=!1;s[0]>t[0]&&(z=s,y=t,A=!0);var B=z[0]-y[1];l=0>=B,(null===k||B>k)&&(g.copy(j,q),k=B,m=l)}}return m};var fa=g.fromValues(0,0),ga=g.fromValues(0,0),ha=g.fromValues(0,0);d.getClosestEdge=function(a,b,c,d){var e=fa,f=ga,i=ha;g.rotate(e,c,-b),d&&g.scale(e,e,-1);for(var k=-1,l=a.vertices.length,m=-1,n=0;n!==l;n++){h(f,a.vertices[(n+1)%l],a.vertices[n%l]),g.rotate90cw(i,f),g.normalize(i,i);var o=j(i,e);(-1===k||o>m)&&(k=n%l,m=o)}return k};var ia=g.create(),ja=g.create(),ka=g.create(),la=g.create(),ma=g.create(),na=g.create(),oa=g.create();d.prototype[q.CIRCLE|q.HEIGHTFIELD]=d.prototype.circleHeightfield=function(a,b,c,d,e,f,j,k,l,m){var n=f.heights,m=m||b.radius,o=f.elementWidth,p=ja,q=ia,r=ma,s=oa,t=na,u=ka,v=la,w=Math.floor((c[0]-m-j[0])/o),x=Math.ceil((c[0]+m-j[0])/o);0>w&&(w=0),x>=n.length&&(x=n.length-1);for(var y=n[w],z=n[x],A=w;x>A;A++)n[A]<z&&(z=n[A]),n[A]>y&&(y=n[A]);if(c[1]-m>y)return l?!1:0;for(var B=!1,A=w;x>A;A++){g.set(u,A*o,n[A]),g.set(v,(A+1)*o,n[A+1]),g.add(u,u,j),g.add(v,v,j),g.sub(t,v,u),g.rotate(t,t,Math.PI/2),g.normalize(t,t),g.scale(q,t,-m),g.add(q,q,c),g.sub(p,q,u);var C=g.dot(p,t);if(q[0]>=u[0]&&q[0]<v[0]&&0>=C){if(l)return!0;B=!0,g.scale(p,t,-C),g.add(r,q,p),g.copy(s,t);var D=this.createContactEquation(e,a,f,b);g.copy(D.normalA,s),g.scale(D.contactPointB,D.normalA,-m),i(D.contactPointB,D.contactPointB,c),h(D.contactPointB,D.contactPointB,a.position),g.copy(D.contactPointA,r),g.sub(D.contactPointA,D.contactPointA,e.position),this.contactEquations.push(D),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(D))}}if(B=!1,m>0)for(var A=w;x>=A;A++)if(g.set(u,A*o,n[A]),g.add(u,u,j),g.sub(p,c,u),g.squaredLength(p)<Math.pow(m,2)){
if(l)return!0;B=!0;var D=this.createContactEquation(e,a,f,b);g.copy(D.normalA,p),g.normalize(D.normalA,D.normalA),g.scale(D.contactPointB,D.normalA,-m),i(D.contactPointB,D.contactPointB,c),h(D.contactPointB,D.contactPointB,a.position),h(D.contactPointA,u,j),i(D.contactPointA,D.contactPointA,j),h(D.contactPointA,D.contactPointA,e.position),this.contactEquations.push(D),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(D))}return B?1:0};var pa=g.create(),qa=g.create(),ra=g.create(),sa=new p({vertices:[g.create(),g.create(),g.create(),g.create()]});d.prototype[q.BOX|q.HEIGHTFIELD]=d.prototype[q.CONVEX|q.HEIGHTFIELD]=d.prototype.convexHeightfield=function(a,b,c,d,e,f,h,i,j){var k=f.heights,l=f.elementWidth,m=pa,n=qa,o=ra,p=sa,q=Math.floor((a.aabb.lowerBound[0]-h[0])/l),r=Math.ceil((a.aabb.upperBound[0]-h[0])/l);0>q&&(q=0),r>=k.length&&(r=k.length-1);for(var s=k[q],t=k[r],u=q;r>u;u++)k[u]<t&&(t=k[u]),k[u]>s&&(s=k[u]);if(a.aabb.lowerBound[1]>s)return j?!1:0;for(var v=0,u=q;r>u;u++){g.set(m,u*l,k[u]),g.set(n,(u+1)*l,k[u+1]),g.add(m,m,h),g.add(n,n,h);var w=100;g.set(o,.5*(n[0]+m[0]),.5*(n[1]+m[1]-w)),g.sub(p.vertices[0],n,o),g.sub(p.vertices[1],m,o),g.copy(p.vertices[2],p.vertices[1]),g.copy(p.vertices[3],p.vertices[0]),p.vertices[2][1]-=w,p.vertices[3][1]-=w,v+=this.convexConvex(a,b,c,d,e,p,o,0,j)}return v}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(a,b,c){function d(a){a=a||{},this.from=a.from?f.fromValues(a.from[0],a.from[1]):f.create(),this.to=a.to?f.fromValues(a.to[0],a.to[1]):f.create(),this.checkCollisionResponse=void 0!==a.checkCollisionResponse?a.checkCollisionResponse:!0,this.skipBackfaces=!!a.skipBackfaces,this.collisionMask=void 0!==a.collisionMask?a.collisionMask:-1,this.collisionGroup=void 0!==a.collisionGroup?a.collisionGroup:-1,this.mode=void 0!==a.mode?a.mode:d.ANY,this.callback=a.callback||function(a){},this.direction=f.create(),this.length=1,this.update()}function e(a,b,c){f.sub(h,c,a);var d=f.dot(h,b);return f.scale(i,b,d),f.add(i,i,a),f.squaredDistance(c,i)}b.exports=d;var f=a("../math/vec2");a("../collision/RaycastResult"),a("../shapes/Shape"),a("../collision/AABB");d.prototype.constructor=d,d.CLOSEST=1,d.ANY=2,d.ALL=4,d.prototype.update=function(){var a=this.direction;f.sub(a,this.to,this.from),this.length=f.length(a),f.normalize(a,a)},d.prototype.intersectBodies=function(a,b){for(var c=0,d=b.length;!a.shouldStop(this)&&d>c;c++){var e=b[c],f=e.getAABB();(f.overlapsRay(this)>=0||f.containsPoint(this.from))&&this.intersectBody(a,e)}};var g=f.create();d.prototype.intersectBody=function(a,b){var c=this.checkCollisionResponse;if(!c||b.collisionResponse)for(var d=g,e=0,h=b.shapes.length;h>e;e++){var i=b.shapes[e];if((!c||i.collisionResponse)&&0!==(this.collisionGroup&i.collisionMask)&&0!==(i.collisionGroup&this.collisionMask)){f.rotate(d,i.position,b.angle),f.add(d,d,b.position);var j=i.angle+b.angle;if(this.intersectShape(a,i,j,d,b),a.shouldStop(this))break}}},d.prototype.intersectShape=function(a,b,c,d,f){var g=this.from,h=e(g,this.direction,d);h>b.boundingRadius*b.boundingRadius||(this._currentBody=f,this._currentShape=b,b.raycast(a,this,d,c),this._currentBody=this._currentShape=null)},d.prototype.getAABB=function(a){var b=this.to,c=this.from;f.set(a.lowerBound,Math.min(b[0],c[0]),Math.min(b[1],c[1])),f.set(a.upperBound,Math.max(b[0],c[0]),Math.max(b[1],c[1]))};f.create();d.prototype.reportIntersection=function(a,b,c,e){var g=(this.from,this.to,this._currentShape),h=this._currentBody;if(!(this.skipBackfaces&&f.dot(c,this.direction)>0))switch(this.mode){case d.ALL:a.set(c,g,h,b,e),this.callback(a);break;case d.CLOSEST:(b<a.fraction||!a.hasHit())&&a.set(c,g,h,b,e);break;case d.ANY:a.set(c,g,h,b,e)}};var h=f.create(),i=f.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(a,b,c){function d(){this.normal=e.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var e=a("../math/vec2"),f=a("../collision/Ray");b.exports=d,d.prototype.reset=function(){e.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},d.prototype.getHitDistance=function(a){return e.distance(a.from,a.to)*this.fraction},d.prototype.hasHit=function(){return-1!==this.fraction},d.prototype.getHitPoint=function(a,b){e.lerp(a,b.from,b.to,this.fraction)},d.prototype.stop=function(){this.isStopped=!0},d.prototype.shouldStop=function(a){return this.isStopped||-1!==this.fraction&&a.mode===f.ANY},d.prototype.set=function(a,b,c,d,f){e.copy(this.normal,a),this.shape=b,this.body=c,this.fraction=d,this.faceIndex=f}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(a,b,c){function d(){f.call(this,f.SAP),this.axisList=[],this.axisIndex=0;var a=this;this._addBodyHandler=function(b){a.axisList.push(b.body)},this._removeBodyHandler=function(b){var c=a.axisList.indexOf(b.body);-1!==c&&a.axisList.splice(c,1)}}var e=a("../utils/Utils"),f=a("../collision/Broadphase");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.setWorld=function(a){this.axisList.length=0,e.appendArray(this.axisList,a.bodies),a.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),a.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=a},d.sortAxisList=function(a,b){b=0|b;for(var c=1,d=a.length;d>c;c++){for(var e=a[c],f=c-1;f>=0&&!(a[f].aabb.lowerBound[b]<=e.aabb.lowerBound[b]);f--)a[f+1]=a[f];a[f+1]=e}return a},d.prototype.sortList=function(){var a=this.axisList,b=this.axisIndex;d.sortAxisList(a,b)},d.prototype.getCollisionPairs=function(a){var b=this.axisList,c=this.result,d=this.axisIndex;c.length=0;for(var e=b.length;e--;){var g=b[e];g.aabbNeedsUpdate&&g.updateAABB()}this.sortList();for(var h=0,i=0|b.length;h!==i;h++)for(var j=b[h],k=h+1;i>k;k++){var l=b[k],m=l.aabb.lowerBound[d]<=j.aabb.upperBound[d];if(!m)break;f.canCollide(j,l)&&this.boundingVolumeCheck(j,l)&&c.push(j,l)}return c},d.prototype.aabbQuery=function(a,b,c){c=c||[],this.sortList();var d=this.axisIndex,e="x";1===d&&(e="y"),2===d&&(e="z");for(var f=this.axisList,g=(b.lowerBound[e],b.upperBound[e],0);g<f.length;g++){var h=f[g];h.aabbNeedsUpdate&&h.updateAABB(),h.aabb.overlaps(b)&&c.push(h)}return c}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(a,b,c){function d(a,b,c,d){this.type=c,d=e.defaults(d,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=a,this.bodyB=b,this.collideConnected=d.collideConnected,d.wakeUpBodies&&(a&&a.wakeUp(),b&&b.wakeUp())}b.exports=d;var e=a("../utils/Utils");d.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},d.DISTANCE=1,d.GEAR=2,d.LOCK=3,d.PRISMATIC=4,d.REVOLUTE=5,d.prototype.setStiffness=function(a){for(var b=this.equations,c=0;c!==b.length;c++){var d=b[c];d.stiffness=a,d.needsUpdate=!0}},d.prototype.setRelaxation=function(a){for(var b=this.equations,c=0;c!==b.length;c++){var d=b[c];d.relaxation=a,d.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(a,b,c){function d(a,b,c){c=h.defaults(c,{localAnchorA:[0,0],localAnchorB:[0,0]}),e.call(this,a,b,e.DISTANCE,c),this.localAnchorA=g.fromValues(c.localAnchorA[0],c.localAnchorA[1]),this.localAnchorB=g.fromValues(c.localAnchorB[0],c.localAnchorB[1]);var d=this.localAnchorA,i=this.localAnchorB;if(this.distance=0,"number"==typeof c.distance)this.distance=c.distance;else{var j=g.create(),k=g.create(),l=g.create();g.rotate(j,d,a.angle),g.rotate(k,i,b.angle),g.add(l,b.position,k),g.sub(l,l,j),g.sub(l,l,a.position),this.distance=g.length(l)}var m;m="undefined"==typeof c.maxForce?Number.MAX_VALUE:c.maxForce;var n=new f(a,b,-m,m);this.equations=[n],this.maxForce=m;var l=g.create(),o=g.create(),p=g.create(),q=this;n.computeGq=function(){var a=this.bodyA,b=this.bodyB,c=a.position,e=b.position;return g.rotate(o,d,a.angle),g.rotate(p,i,b.angle),g.add(l,e,p),g.sub(l,l,o),g.sub(l,l,c),g.length(l)-q.distance},this.setMaxForce(m),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var e=a("./Constraint"),f=a("../equations/Equation"),g=a("../math/vec2"),h=a("../utils/Utils");b.exports=d,d.prototype=new e,d.prototype.constructor=d;var i=g.create(),j=g.create(),k=g.create();d.prototype.update=function(){var a=this.equations[0],b=this.bodyA,c=this.bodyB,d=(this.distance,b.position),e=c.position,f=this.equations[0],h=a.G;g.rotate(j,this.localAnchorA,b.angle),g.rotate(k,this.localAnchorB,c.angle),g.add(i,e,k),g.sub(i,i,j),g.sub(i,i,d),this.position=g.length(i);var l=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(f.maxForce=0,f.minForce=-this.maxForce,this.distance=this.upperLimit,l=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(f.maxForce=this.maxForce,f.minForce=0,this.distance=this.lowerLimit,l=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!l)return void(f.enabled=!1);f.enabled=!0,g.normalize(i,i);var m=g.crossLength(j,i),n=g.crossLength(k,i);h[0]=-i[0],h[1]=-i[1],h[2]=-m,h[3]=i[0],h[4]=i[1],h[5]=n},d.prototype.setMaxForce=function(a){var b=this.equations[0];b.minForce=-a,b.maxForce=a},d.prototype.getMaxForce=function(){var a=this.equations[0];return a.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(a,b,c){function d(a,b,c){c=c||{},e.call(this,a,b,e.GEAR,c),this.ratio=void 0!==c.ratio?c.ratio:1,this.angle=void 0!==c.angle?c.angle:b.angle-this.ratio*a.angle,c.angle=this.angle,c.ratio=this.ratio,this.equations=[new f(a,b,c)],void 0!==c.maxTorque&&this.setMaxTorque(c.maxTorque)}var e=a("./Constraint"),f=(a("../equations/Equation"),a("../equations/AngleLockEquation"));a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.update=function(){var a=this.equations[0];a.ratio!==this.ratio&&a.setRatio(this.ratio),a.angle=this.angle},d.prototype.setMaxTorque=function(a){this.equations[0].setMaxTorque(a)},d.prototype.getMaxTorque=function(a){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(a,b,c){function d(a,b,c){c=c||{},e.call(this,a,b,e.LOCK,c);var d="undefined"==typeof c.maxForce?Number.MAX_VALUE:c.maxForce,h=(c.localAngleB||0,new g(a,b,-d,d)),i=new g(a,b,-d,d),j=new g(a,b,-d,d),k=f.create(),l=f.create(),m=this;h.computeGq=function(){return f.rotate(k,m.localOffsetB,a.angle),f.sub(l,b.position,a.position),f.sub(l,l,k),l[0]},i.computeGq=function(){return f.rotate(k,m.localOffsetB,a.angle),f.sub(l,b.position,a.position),f.sub(l,l,k),l[1]};var n=f.create(),o=f.create();j.computeGq=function(){return f.rotate(n,m.localOffsetB,b.angle-m.localAngleB),f.scale(n,n,-1),f.sub(l,a.position,b.position),f.add(l,l,n),f.rotate(o,n,-Math.PI/2),f.normalize(o,o),f.dot(l,o)},this.localOffsetB=f.create(),c.localOffsetB?f.copy(this.localOffsetB,c.localOffsetB):(f.sub(this.localOffsetB,b.position,a.position),f.rotate(this.localOffsetB,this.localOffsetB,-a.angle)),this.localAngleB=0,"number"==typeof c.localAngleB?this.localAngleB=c.localAngleB:this.localAngleB=b.angle-a.angle,this.equations.push(h,i,j),this.setMaxForce(d)}var e=a("./Constraint"),f=a("../math/vec2"),g=a("../equations/Equation");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.setMaxForce=function(a){for(var b=this.equations,c=0;c<this.equations.length;c++)b[c].maxForce=a,b[c].minForce=-a},d.prototype.getMaxForce=function(){return this.equations[0].maxForce};var h=f.create(),i=f.create(),j=f.create(),k=f.fromValues(1,0),l=f.fromValues(0,1);d.prototype.update=function(){var a=this.equations[0],b=this.equations[1],c=this.equations[2],d=this.bodyA,e=this.bodyB;f.rotate(h,this.localOffsetB,d.angle),f.rotate(i,this.localOffsetB,e.angle-this.localAngleB),f.scale(i,i,-1),f.rotate(j,i,Math.PI/2),f.normalize(j,j),a.G[0]=-1,a.G[1]=0,a.G[2]=-f.crossLength(h,k),a.G[3]=1,b.G[0]=0,b.G[1]=-1,b.G[2]=-f.crossLength(h,l),b.G[4]=1,c.G[0]=-j[0],c.G[1]=-j[1],c.G[3]=j[0],c.G[4]=j[1],c.G[5]=f.crossLength(i,j)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(a,b,c){function d(a,b,c){c=c||{},e.call(this,a,b,e.PRISMATIC,c);var d=h.fromValues(0,0),j=h.fromValues(1,0),k=h.fromValues(0,0);c.localAnchorA&&h.copy(d,c.localAnchorA),c.localAxisA&&h.copy(j,c.localAxisA),c.localAnchorB&&h.copy(k,c.localAnchorB),this.localAnchorA=d,this.localAnchorB=k,this.localAxisA=j;var l=this.maxForce="undefined"!=typeof c.maxForce?c.maxForce:Number.MAX_VALUE,m=new g(a,b,-l,l),n=new h.create,o=new h.create,p=new h.create,q=new h.create;if(m.computeGq=function(){return h.dot(p,q)},m.updateJacobian=function(){var c=this.G,e=a.position,f=b.position;h.rotate(n,d,a.angle),h.rotate(o,k,b.angle),h.add(p,f,o),h.sub(p,p,e),h.sub(p,p,n),h.rotate(q,j,a.angle+Math.PI/2),c[0]=-q[0],c[1]=-q[1],c[2]=-h.crossLength(n,q)+h.crossLength(q,p),c[3]=q[0],c[4]=q[1],c[5]=h.crossLength(o,q)},this.equations.push(m),!c.disableRotationalLock){var r=new i(a,b,-l,l);this.equations.push(r)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof c.lowerLimit?!0:!1,this.upperLimitEnabled="undefined"!=typeof c.upperLimit?!0:!1,this.lowerLimit="undefined"!=typeof c.lowerLimit?c.lowerLimit:0,this.upperLimit="undefined"!=typeof c.upperLimit?c.upperLimit:1,this.upperLimitEquation=new f(a,b),this.lowerLimitEquation=new f(a,b),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=l,this.motorEquation=new g(a,b),this.motorEnabled=!1,this.motorSpeed=0;var s=this,t=this.motorEquation;t.computeGW;t.computeGq=function(){return 0},t.computeGW=function(){var a=this.G,b=this.bodyA,c=this.bodyB,d=b.velocity,e=c.velocity,f=b.angularVelocity,g=c.angularVelocity;return this.gmult(a,d,f,e,g)+s.motorSpeed}}var e=a("./Constraint"),f=a("../equations/ContactEquation"),g=a("../equations/Equation"),h=a("../math/vec2"),i=a("../equations/RotationalLockEquation");b.exports=d,d.prototype=new e,d.prototype.constructor=d;var j=h.create(),k=h.create(),l=h.create(),m=h.create(),n=h.create(),o=h.create();d.prototype.update=function(){var a=this.equations,b=a[0],c=this.upperLimit,d=this.lowerLimit,e=this.upperLimitEquation,f=this.lowerLimitEquation,g=this.bodyA,i=this.bodyB,p=this.localAxisA,q=this.localAnchorA,r=this.localAnchorB;b.updateJacobian(),h.rotate(j,p,g.angle),h.rotate(m,q,g.angle),h.add(k,m,g.position),h.rotate(n,r,i.angle),h.add(l,n,i.position);var s=this.position=h.dot(l,j)-h.dot(k,j);if(this.motorEnabled){var t=this.motorEquation.G;t[0]=j[0],t[1]=j[1],t[2]=h.crossLength(j,n),t[3]=-j[0],t[4]=-j[1],t[5]=-h.crossLength(j,m)}if(this.upperLimitEnabled&&s>c)h.scale(e.normalA,j,-1),h.sub(e.contactPointA,k,g.position),h.sub(e.contactPointB,l,i.position),h.scale(o,j,c),h.add(e.contactPointA,e.contactPointA,o),-1===a.indexOf(e)&&a.push(e);else{var u=a.indexOf(e);-1!==u&&a.splice(u,1)}if(this.lowerLimitEnabled&&d>s)h.scale(f.normalA,j,1),h.sub(f.contactPointA,k,g.position),h.sub(f.contactPointB,l,i.position),h.scale(o,j,d),h.sub(f.contactPointB,f.contactPointB,o),-1===a.indexOf(f)&&a.push(f);else{var u=a.indexOf(f);-1!==u&&a.splice(u,1)}},d.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},d.prototype.disableMotor=function(){if(this.motorEnabled){var a=this.equations.indexOf(this.motorEquation);this.equations.splice(a,1),this.motorEnabled=!1}},d.prototype.setLimits=function(a,b){"number"==typeof a?(this.lowerLimit=a,this.lowerLimitEnabled=!0):(this.lowerLimit=a,this.lowerLimitEnabled=!1),"number"==typeof b?(this.upperLimit=b,this.upperLimitEnabled=!0):(this.upperLimit=b,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(a,b,c){function d(a,b,c){c=c||{},e.call(this,a,b,e.REVOLUTE,c);var d=this.maxForce="undefined"!=typeof c.maxForce?c.maxForce:Number.MAX_VALUE;this.pivotA=i.create(),this.pivotB=i.create(),c.worldPivot?(i.sub(this.pivotA,c.worldPivot,a.position),i.sub(this.pivotB,c.worldPivot,b.position),i.rotate(this.pivotA,this.pivotA,-a.angle),i.rotate(this.pivotB,this.pivotB,-b.angle)):(i.copy(this.pivotA,c.localPivotA),i.copy(this.pivotB,c.localPivotB));var o=this.equations=[new f(a,b,-d,d),new f(a,b,-d,d)],p=o[0],q=o[1],r=this;p.computeGq=function(){return i.rotate(j,r.pivotA,a.angle),i.rotate(k,r.pivotB,b.angle),i.add(n,b.position,k),i.sub(n,n,a.position),i.sub(n,n,j),i.dot(n,l)},q.computeGq=function(){return i.rotate(j,r.pivotA,a.angle),i.rotate(k,r.pivotB,b.angle),i.add(n,b.position,k),i.sub(n,n,a.position),i.sub(n,n,j),i.dot(n,m)},q.minForce=p.minForce=-d,q.maxForce=p.maxForce=d,this.motorEquation=new g(a,b),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new h(a,b),this.lowerLimitEquation=new h(a,b),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var e=a("./Constraint"),f=a("../equations/Equation"),g=a("../equations/RotationalVelocityEquation"),h=a("../equations/RotationalLockEquation"),i=a("../math/vec2");b.exports=d;var j=i.create(),k=i.create(),l=i.fromValues(1,0),m=i.fromValues(0,1),n=i.create();d.prototype=new e,d.prototype.constructor=d,d.prototype.setLimits=function(a,b){"number"==typeof a?(this.lowerLimit=a,this.lowerLimitEnabled=!0):(this.lowerLimit=a,this.lowerLimitEnabled=!1),"number"==typeof b?(this.upperLimit=b,this.upperLimitEnabled=!0):(this.upperLimit=b,this.upperLimitEnabled=!1)},d.prototype.update=function(){var a=this.bodyA,b=this.bodyB,c=this.pivotA,d=this.pivotB,e=this.equations,f=(e[0],e[1],e[0]),g=e[1],h=this.upperLimit,n=this.lowerLimit,o=this.upperLimitEquation,p=this.lowerLimitEquation,q=this.angle=b.angle-a.angle;if(this.upperLimitEnabled&&q>h)o.angle=h,-1===e.indexOf(o)&&e.push(o);else{var r=e.indexOf(o);-1!==r&&e.splice(r,1)}if(this.lowerLimitEnabled&&n>q)p.angle=n,-1===e.indexOf(p)&&e.push(p);else{var r=e.indexOf(p);-1!==r&&e.splice(r,1)}i.rotate(j,c,a.angle),i.rotate(k,d,b.angle),f.G[0]=-1,f.G[1]=0,f.G[2]=-i.crossLength(j,l),f.G[3]=1,f.G[4]=0,f.G[5]=i.crossLength(k,l),g.G[0]=0,g.G[1]=-1,g.G[2]=-i.crossLength(j,m),g.G[3]=0,g.G[4]=1,g.G[5]=i.crossLength(k,m)},d.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},d.prototype.disableMotor=function(){if(this.motorEnabled){var a=this.equations.indexOf(this.motorEquation);this.equations.splice(a,1),this.motorEnabled=!1}},d.prototype.motorIsEnabled=function(){return!!this.motorEnabled},d.prototype.setMotorSpeed=function(a){if(this.motorEnabled){var b=this.equations.indexOf(this.motorEquation);this.equations[b].relativeVelocity=a}},d.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(a,b,c){function d(a,b,c){c=c||{},e.call(this,a,b,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=c.angle||0,this.ratio="number"==typeof c.ratio?c.ratio:1,this.setRatio(this.ratio)}var e=a("./Equation");a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},d.prototype.setRatio=function(a){var b=this.G;b[2]=a,b[5]=-1,this.ratio=a},d.prototype.setMaxTorque=function(a){this.maxForce=a,this.minForce=-a}},{"../math/vec2":30,"./Equation":22}],21:[function(a,b,c){function d(a,b){e.call(this,a,b,0,Number.MAX_VALUE),this.contactPointA=f.create(),this.penetrationVec=f.create(),this.contactPointB=f.create(),this.normalA=f.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var e=a("./Equation"),f=a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeB=function(a,b,c){var d=this.bodyA,e=this.bodyB,g=this.contactPointA,h=this.contactPointB,i=d.position,j=e.position,k=this.penetrationVec,l=this.normalA,m=this.G,n=f.crossLength(g,l),o=f.crossLength(h,l);m[0]=-l[0],m[1]=-l[1],m[2]=-n,m[3]=l[0],m[4]=l[1],m[5]=o,f.add(k,j,h),f.sub(k,k,i),f.sub(k,k,g);var p,q;this.firstImpact&&0!==this.restitution?(q=0,p=1/b*(1+this.restitution)*this.computeGW()):(q=f.dot(l,k)+this.offset,p=this.computeGW());var r=this.computeGiMf(),s=-q*a-p*b-c*r;return s};var g=f.create(),h=f.create(),i=f.create();d.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(g,this.contactPointA),this.bodyB.getVelocityAtPoint(h,this.contactPointB),f.subtract(i,g,h),f.dot(this.normalA,i)}},{"../math/vec2":30,"./Equation":22}],22:[function(a,b,c){function d(a,b,c,e){this.minForce="undefined"==typeof c?-Number.MAX_VALUE:c,this.maxForce="undefined"==typeof e?Number.MAX_VALUE:e,this.bodyA=a,this.bodyB=b,this.stiffness=d.DEFAULT_STIFFNESS,this.relaxation=d.DEFAULT_RELAXATION,this.G=new f.ARRAY_TYPE(6);for(var g=0;6>g;g++)this.G[g]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}b.exports=d;var e=a("../math/vec2"),f=a("../utils/Utils");a("../objects/Body");d.prototype.constructor=d,d.DEFAULT_STIFFNESS=1e6,d.DEFAULT_RELAXATION=4,d.prototype.update=function(){var a=this.stiffness,b=this.relaxation,c=this.timeStep;this.a=4/(c*(1+4*b)),this.b=4*b/(1+4*b),this.epsilon=4/(c*c*a*(1+4*b)),this.needsUpdate=!1},d.prototype.gmult=function(a,b,c,d,e){return a[0]*b[0]+a[1]*b[1]+a[2]*c+a[3]*d[0]+a[4]*d[1]+a[5]*e},d.prototype.computeB=function(a,b,c){var d=this.computeGW(),e=this.computeGq(),f=this.computeGiMf();return-e*a-d*b-f*c};var g=e.create(),h=e.create();d.prototype.computeGq=function(){var a=this.G,b=this.bodyA,c=this.bodyB,d=(b.position,c.position,b.angle),e=c.angle;return this.gmult(a,g,d,h,e)+this.offset},d.prototype.computeGW=function(){var a=this.G,b=this.bodyA,c=this.bodyB,d=b.velocity,e=c.velocity,f=b.angularVelocity,g=c.angularVelocity;return this.gmult(a,d,f,e,g)+this.relativeVelocity},d.prototype.computeGWlambda=function(){var a=this.G,b=this.bodyA,c=this.bodyB,d=b.vlambda,e=c.vlambda,f=b.wlambda,g=c.wlambda;return this.gmult(a,d,f,e,g)};var i=e.create(),j=e.create();d.prototype.computeGiMf=function(){var a=this.bodyA,b=this.bodyB,c=a.force,d=a.angularForce,f=b.force,g=b.angularForce,h=a.invMassSolve,k=b.invMassSolve,l=a.invInertiaSolve,m=b.invInertiaSolve,n=this.G;return e.scale(i,c,h),e.multiply(i,a.massMultiplier,i),e.scale(j,f,k),e.multiply(j,b.massMultiplier,j),this.gmult(n,i,d*l,j,g*m)},d.prototype.computeGiMGt=function(){var a=this.bodyA,b=this.bodyB,c=a.invMassSolve,d=b.invMassSolve,e=a.invInertiaSolve,f=b.invInertiaSolve,g=this.G;return g[0]*g[0]*c*a.massMultiplier[0]+g[1]*g[1]*c*a.massMultiplier[1]+g[2]*g[2]*e+g[3]*g[3]*d*b.massMultiplier[0]+g[4]*g[4]*d*b.massMultiplier[1]+g[5]*g[5]*f};var k=e.create(),l=e.create(),m=e.create();e.create(),e.create(),e.create();d.prototype.addToWlambda=function(a){var b=this.bodyA,c=this.bodyB,d=k,f=l,g=m,h=b.invMassSolve,i=c.invMassSolve,j=b.invInertiaSolve,n=c.invInertiaSolve,o=this.G;f[0]=o[0],f[1]=o[1],g[0]=o[3],g[1]=o[4],e.scale(d,f,h*a),e.multiply(d,d,b.massMultiplier),e.add(b.vlambda,b.vlambda,d),b.wlambda+=j*o[2]*a,e.scale(d,g,i*a),e.multiply(d,d,c.massMultiplier),e.add(c.vlambda,c.vlambda,d),c.wlambda+=n*o[5]*a},d.prototype.computeInvC=function(a){return 1/(this.computeGiMGt()+a)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(a,b,c){function d(a,b,c){f.call(this,a,b,-c,c),this.contactPointA=e.create(),this.contactPointB=e.create(),this.t=e.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var e=a("../math/vec2"),f=a("./Equation");a("../utils/Utils");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.setSlipForce=function(a){this.maxForce=a,this.minForce=-a},d.prototype.getSlipForce=function(){return this.maxForce},d.prototype.computeB=function(a,b,c){var d=(this.bodyA,this.bodyB,this.contactPointA),f=this.contactPointB,g=this.t,h=this.G;h[0]=-g[0],h[1]=-g[1],h[2]=-e.crossLength(d,g),h[3]=g[0],h[4]=g[1],h[5]=e.crossLength(f,g);var i=this.computeGW(),j=this.computeGiMf(),k=-i*b-c*j;return k}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(a,b,c){function d(a,b,c){c=c||{},e.call(this,a,b,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=c.angle||0;var d=this.G;d[2]=1,d[5]=-1}var e=a("./Equation"),f=a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d;var g=f.create(),h=f.create(),i=f.fromValues(1,0),j=f.fromValues(0,1);d.prototype.computeGq=function(){return f.rotate(g,i,this.bodyA.angle+this.angle),f.rotate(h,j,this.bodyB.angle),f.dot(g,h)}},{"../math/vec2":30,"./Equation":22}],25:[function(a,b,c){function d(a,b){e.call(this,a,b,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var e=a("./Equation");a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeB=function(a,b,c){var d=this.G;d[2]=-1,d[5]=this.ratio;var e=this.computeGiMf(),f=this.computeGW(),g=-f*b-c*e;return g}},{"../math/vec2":30,"./Equation":22}],26:[function(a,b,c){var d=function(){};b.exports=d,d.prototype={constructor:d,on:function(a,b,c){b.context=c||this,void 0===this._listeners&&(this._listeners={});var d=this._listeners;return void 0===d[a]&&(d[a]=[]),-1===d[a].indexOf(b)&&d[a].push(b),this},has:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;if(b){if(void 0!==c[a]&&-1!==c[a].indexOf(b))return!0}else if(void 0!==c[a])return!0;return!1},off:function(a,b){if(void 0===this._listeners)return this;var c=this._listeners,d=c[a].indexOf(b);return-1!==d&&c[a].splice(d,1),this},emit:function(a){if(void 0===this._listeners)return this;var b=this._listeners,c=b[a.type];if(void 0!==c){a.target=this;for(var d=0,e=c.length;e>d;d++){var f=c[d];f.call(f.context,a)}}return this}}},{}],27:[function(a,b,c){function d(a,b,c){if(c=c||{},!(a instanceof e&&b instanceof e))throw new Error("First two arguments must be Material instances.");this.id=d.idCounter++,this.materialA=a,this.materialB=b,this.friction="undefined"!=typeof c.friction?Number(c.friction):.3,this.restitution="undefined"!=typeof c.restitution?Number(c.restitution):0,this.stiffness="undefined"!=typeof c.stiffness?Number(c.stiffness):f.DEFAULT_STIFFNESS,this.relaxation="undefined"!=typeof c.relaxation?Number(c.relaxation):f.DEFAULT_RELAXATION,this.frictionStiffness="undefined"!=typeof c.frictionStiffness?Number(c.frictionStiffness):f.DEFAULT_STIFFNESS,this.frictionRelaxation="undefined"!=typeof c.frictionRelaxation?Number(c.frictionRelaxation):f.DEFAULT_RELAXATION,this.surfaceVelocity="undefined"!=typeof c.surfaceVelocity?Number(c.surfaceVelocity):0,this.contactSkinSize=.005}var e=a("./Material"),f=a("../equations/Equation");b.exports=d,d.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(a,b,c){function d(a){this.id=a||d.idCounter++}b.exports=d,d.idCounter=0},{}],29:[function(a,b,c){var d={};d.GetArea=function(a){if(a.length<6)return 0;for(var b=a.length-2,c=0,d=0;b>d;d+=2)c+=(a[d+2]-a[d])*(a[d+1]+a[d+3]);return c+=(a[0]-a[b])*(a[b+1]+a[1]),.5*-c},d.Triangulate=function(a){var b=a.length>>1;if(3>b)return[];for(var c=[],e=[],f=0;b>f;f++)e.push(f);for(var f=0,g=b;g>3;){var h=e[(f+0)%g],i=e[(f+1)%g],j=e[(f+2)%g],k=a[2*h],l=a[2*h+1],m=a[2*i],n=a[2*i+1],o=a[2*j],p=a[2*j+1],q=!1;if(d._convex(k,l,m,n,o,p)){q=!0;for(var r=0;g>r;r++){var s=e[r];if(s!=h&&s!=i&&s!=j&&d._PointInTriangle(a[2*s],a[2*s+1],k,l,m,n,o,p)){q=!1;break}}}if(q)c.push(h,i,j),e.splice((f+1)%g,1),g--,f=0;else if(f++>3*g)break}return c.push(e[0],e[1],e[2]),c},d._PointInTriangle=function(a,b,c,d,e,f,g,h){var i=g-c,j=h-d,k=e-c,l=f-d,m=a-c,n=b-d,o=i*i+j*j,p=i*k+j*l,q=i*m+j*n,r=k*k+l*l,s=k*m+l*n,t=1/(o*r-p*p),u=(r*q-p*s)*t,v=(o*s-p*q)*t;return u>=0&&v>=0&&1>u+v},d._convex=function(a,b,c,d,e,f){return(b-d)*(e-c)+(c-a)*(f-d)>=0},b.exports=d},{}],30:[function(a,b,c){var d=b.exports={},e=a("../utils/Utils");d.crossLength=function(a,b){return a[0]*b[1]-a[1]*b[0]},d.crossVZ=function(a,b,c){return d.rotate(a,b,-Math.PI/2),d.scale(a,a,c),a},d.crossZV=function(a,b,c){return d.rotate(a,c,Math.PI/2),d.scale(a,a,b),a},d.rotate=function(a,b,c){if(0!==c){var d=Math.cos(c),e=Math.sin(c),f=b[0],g=b[1];a[0]=d*f-e*g,a[1]=e*f+d*g}else a[0]=b[0],a[1]=b[1]},d.rotate90cw=function(a,b){var c=b[0],d=b[1];a[0]=d,a[1]=-c},d.toLocalFrame=function(a,b,c,e){d.copy(a,b),d.sub(a,a,c),d.rotate(a,a,-e)},d.toGlobalFrame=function(a,b,c,e){d.copy(a,b),d.rotate(a,a,e),d.add(a,a,c)},d.vectorToLocalFrame=function(a,b,c){d.rotate(a,b,-c)},d.vectorToGlobalFrame=function(a,b,c){d.rotate(a,b,c)},d.centroid=function(a,b,c,e){return d.add(a,b,c),d.add(a,a,e),d.scale(a,a,1/3),a},d.create=function(){var a=new e.ARRAY_TYPE(2);return a[0]=0,a[1]=0,a},d.clone=function(a){var b=new e.ARRAY_TYPE(2);return b[0]=a[0],b[1]=a[1],b},d.fromValues=function(a,b){var c=new e.ARRAY_TYPE(2);return c[0]=a,c[1]=b,c},d.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},d.set=function(a,b,c){return a[0]=b,a[1]=c,a},d.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},d.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},d.sub=d.subtract,d.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},d.mul=d.multiply,d.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},d.div=d.divide,d.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},d.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},d.dist=d.distance,d.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},d.sqrDist=d.squaredDistance,d.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},d.len=d.length,d.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},d.sqrLen=d.squaredLength,d.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},d.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},d.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},d.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},d.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},d.reflect=function(a,b,c){var d=b[0]*c[0]+b[1]*c[1];a[0]=b[0]-2*c[0]*d,a[1]=b[1]-2*c[1]*d},d.getLineSegmentsIntersection=function(a,b,c,e,f){var g=d.getLineSegmentsIntersectionFraction(b,c,e,f);return 0>g?!1:(a[0]=b[0]+g*(c[0]-b[0]),a[1]=b[1]+g*(c[1]-b[1]),!0)},d.getLineSegmentsIntersectionFraction=function(a,b,c,d){var e,f,g=b[0]-a[0],h=b[1]-a[1],i=d[0]-c[0],j=d[1]-c[1];return e=(-h*(a[0]-c[0])+g*(a[1]-c[1]))/(-i*h+g*j),f=(i*(a[1]-c[1])-j*(a[0]-c[0]))/(-i*h+g*j),e>=0&&1>=e&&f>=0&&1>=f?f:-1}},{"../utils/Utils":57}],31:[function(a,b,c){function d(a){a=a||{},k.call(this),this.id=a.id||++d._idCounter,this.world=null,this.shapes=[],this.mass=a.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!a.fixedRotation,this.fixedX=!!a.fixedX,this.fixedY=!!a.fixedY,this.massMultiplier=e.create(),this.position=e.fromValues(0,0),a.position&&e.copy(this.position,a.position),this.interpolatedPosition=e.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=e.fromValues(0,0),this.previousAngle=0,this.velocity=e.fromValues(0,0),a.velocity&&e.copy(this.velocity,a.velocity),this.vlambda=e.fromValues(0,0),this.wlambda=0,this.angle=a.angle||0,this.angularVelocity=a.angularVelocity||0,this.force=e.create(),a.force&&e.copy(this.force,a.force),this.angularForce=a.angularForce||0,this.damping="number"==typeof a.damping?a.damping:.1,
this.angularDamping="number"==typeof a.angularDamping?a.angularDamping:.1,this.type=d.STATIC,"undefined"!=typeof a.type?this.type=a.type:a.mass?this.type=d.DYNAMIC:this.type=d.STATIC,this.boundingRadius=0,this.aabb=new j,this.aabbNeedsUpdate=!0,this.allowSleep=void 0!==a.allowSleep?a.allowSleep:!0,this.wantsToSleep=!1,this.sleepState=d.AWAKE,this.sleepSpeedLimit=void 0!==a.sleepSpeedLimit?a.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==a.sleepTimeLimit?a.sleepTimeLimit:1,this.gravityScale=void 0!==a.gravityScale?a.gravityScale:1,this.collisionResponse=void 0!==a.collisionResponse?a.collisionResponse:!0,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==a.ccdSpeedThreshold?a.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==a.ccdIterations?a.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var e=a("../math/vec2"),f=a("poly-decomp"),g=a("../shapes/Convex"),h=a("../collision/RaycastResult"),i=a("../collision/Ray"),j=a("../collision/AABB"),k=a("../events/EventEmitter");b.exports=d,d.prototype=new k,d.prototype.constructor=d,d._idCounter=0,d.prototype.updateSolveMassProperties=function(){this.sleepState===d.SLEEPING||this.type===d.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},d.prototype.setDensity=function(a){var b=this.getArea();this.mass=b*a,this.updateMassProperties()},d.prototype.getArea=function(){for(var a=0,b=0;b<this.shapes.length;b++)a+=this.shapes[b].area;return a},d.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var l=new j,m=e.create();d.prototype.updateAABB=function(){for(var a=this.shapes,b=a.length,c=m,d=this.angle,f=0;f!==b;f++){var g=a[f],h=g.angle+d;e.rotate(c,g.position,d),e.add(c,c,this.position),g.computeAABB(l,c,h),0===f?this.aabb.copy(l):this.aabb.extend(l)}this.aabbNeedsUpdate=!1},d.prototype.updateBoundingRadius=function(){for(var a=this.shapes,b=a.length,c=0,d=0;d!==b;d++){var f=a[d],g=e.length(f.position),h=f.boundingRadius;g+h>c&&(c=g+h)}this.boundingRadius=c},d.prototype.addShape=function(a,b,c){if(a.body)throw new Error("A shape can only be added to one body.");a.body=this,b?e.copy(a.position,b):e.set(a.position,0,0),a.angle=c||0,this.shapes.push(a),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},d.prototype.removeShape=function(a){var b=this.shapes.indexOf(a);return-1!==b?(this.shapes.splice(b,1),this.aabbNeedsUpdate=!0,a.body=null,!0):!1},d.prototype.updateMassProperties=function(){if(this.type===d.STATIC||this.type===d.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var a=this.shapes,b=a.length,c=this.mass/b,f=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var g=0;b>g;g++){var h=a[g],i=e.squaredLength(h.position),j=h.computeMomentOfInertia(c);f+=j+c*i}this.inertia=f,this.invInertia=f>0?1/f:0}this.invMass=1/this.mass,e.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};e.create();d.prototype.applyForce=function(a,b){if(e.add(this.force,this.force,a),b){var c=e.crossLength(b,a);this.angularForce+=c}};var n=e.create(),o=e.create(),p=e.create();d.prototype.applyForceLocal=function(a,b){b=b||p;var c=n,d=o;this.vectorToWorldFrame(c,a),this.vectorToWorldFrame(d,b),this.applyForce(c,d)};var q=e.create();d.prototype.applyImpulse=function(a,b){if(this.type===d.DYNAMIC){var c=q;if(e.scale(c,a,this.invMass),e.multiply(c,this.massMultiplier,c),e.add(this.velocity,c,this.velocity),b){var f=e.crossLength(b,a);f*=this.invInertia,this.angularVelocity+=f}}};var r=e.create(),s=e.create(),t=e.create();d.prototype.applyImpulseLocal=function(a,b){b=b||t;var c=r,d=s;this.vectorToWorldFrame(c,a),this.vectorToWorldFrame(d,b),this.applyImpulse(c,d)},d.prototype.toLocalFrame=function(a,b){e.toLocalFrame(a,b,this.position,this.angle)},d.prototype.toWorldFrame=function(a,b){e.toGlobalFrame(a,b,this.position,this.angle)},d.prototype.vectorToLocalFrame=function(a,b){e.vectorToLocalFrame(a,b,this.angle)},d.prototype.vectorToWorldFrame=function(a,b){e.vectorToGlobalFrame(a,b,this.angle)},d.prototype.fromPolygon=function(a,b){b=b||{};for(var c=this.shapes.length;c>=0;--c)this.removeShape(this.shapes[c]);var d=new f.Polygon;if(d.vertices=a,d.makeCCW(),"number"==typeof b.removeCollinearPoints&&d.removeCollinearPoints(b.removeCollinearPoints),"undefined"==typeof b.skipSimpleCheck&&!d.isSimple())return!1;this.concavePath=d.vertices.slice(0);for(var c=0;c<this.concavePath.length;c++){var h=[0,0];e.copy(h,this.concavePath[c]),this.concavePath[c]=h}var i;i=b.optimalDecomp?d.decomp():d.quickDecomp();for(var j=e.create(),c=0;c!==i.length;c++){for(var k=new g({vertices:i[c].vertices}),l=0;l!==k.vertices.length;l++){var h=k.vertices[l];e.sub(h,h,k.centerOfMass)}e.scale(j,k.centerOfMass,1),k.updateTriangles(),k.updateCenterOfMass(),k.updateBoundingRadius(),this.addShape(k,j)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var u=(e.fromValues(0,0),e.fromValues(0,0)),v=e.fromValues(0,0),w=e.fromValues(0,0);d.prototype.adjustCenterOfMass=function(){var a=u,b=v,c=w,d=0;e.set(b,0,0);for(var f=0;f!==this.shapes.length;f++){var g=this.shapes[f];e.scale(a,g.position,g.area),e.add(b,b,a),d+=g.area}e.scale(c,b,1/d);for(var f=0;f!==this.shapes.length;f++){var g=this.shapes[f];e.sub(g.position,g.position,c)}e.add(this.position,this.position,c);for(var f=0;this.concavePath&&f<this.concavePath.length;f++)e.sub(this.concavePath[f],this.concavePath[f],c);this.updateMassProperties(),this.updateBoundingRadius()},d.prototype.setZeroForce=function(){e.set(this.force,0,0),this.angularForce=0},d.prototype.resetConstraintVelocity=function(){var a=this,b=a.vlambda;e.set(b,0,0),a.wlambda=0},d.prototype.addConstraintVelocity=function(){var a=this,b=a.velocity;e.add(b,b,a.vlambda),a.angularVelocity+=a.wlambda},d.prototype.applyDamping=function(a){if(this.type===d.DYNAMIC){var b=this.velocity;e.scale(b,b,Math.pow(1-this.damping,a)),this.angularVelocity*=Math.pow(1-this.angularDamping,a)}},d.prototype.wakeUp=function(){var a=this.sleepState;this.sleepState=d.AWAKE,this.idleTime=0,a!==d.AWAKE&&this.emit(d.wakeUpEvent)},d.prototype.sleep=function(){this.sleepState=d.SLEEPING,this.angularVelocity=0,this.angularForce=0,e.set(this.velocity,0,0),e.set(this.force,0,0),this.emit(d.sleepEvent)},d.prototype.sleepTick=function(a,b,c){if(this.allowSleep&&this.type!==d.SLEEPING){this.wantsToSleep=!1;var f=(this.sleepState,e.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)),g=Math.pow(this.sleepSpeedLimit,2);f>=g?(this.idleTime=0,this.sleepState=d.AWAKE):(this.idleTime+=c,this.sleepState=d.SLEEPY),this.idleTime>this.sleepTimeLimit&&(b?this.wantsToSleep=!0:this.sleep())}},d.prototype.overlaps=function(a){return this.world.overlapKeeper.bodiesAreOverlapping(this,a)};var x=e.create(),y=e.create();d.prototype.integrate=function(a){var b=this.invMass,c=this.force,d=this.position,f=this.velocity;e.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*a),e.scale(x,c,a*b),e.multiply(x,this.massMultiplier,x),e.add(f,x,f),this.integrateToTimeOfImpact(a)||(e.scale(y,f,a),e.add(d,d,y),this.fixedRotation||(this.angle+=this.angularVelocity*a)),this.aabbNeedsUpdate=!0};var z=new h,A=new i({mode:i.ALL}),B=e.create(),C=e.create(),D=e.create(),E=e.create();d.prototype.integrateToTimeOfImpact=function(a){if(this.ccdSpeedThreshold<0||e.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;e.normalize(B,this.velocity),e.scale(C,this.velocity,a),e.add(C,C,this.position),e.sub(D,C,this.position);var b,c=this.angularVelocity*a,d=e.length(D),f=1,g=this;if(z.reset(),A.callback=function(a){a.body!==g&&(b=a.body,a.getHitPoint(C,A),e.sub(D,C,g.position),f=e.length(D)/d,a.stop())},e.copy(A.from,this.position),e.copy(A.to,C),A.update(),this.world.raycast(z,A),!b)return!1;var h=this.angle;e.copy(E,this.position);for(var i=0,j=0,k=0,l=f;l>=j&&i<this.ccdIterations;){i++,k=(l-j)/2,e.scale(y,D,f),e.add(this.position,E,y),this.angle=h+c*f,this.updateAABB();var m=this.aabb.overlaps(b.aabb)&&this.world.narrowphase.bodiesOverlap(this,b);m?j=k:l=k}return f=k,e.copy(this.position,E),this.angle=h,e.scale(y,D,f),e.add(this.position,this.position,y),this.fixedRotation||(this.angle+=c*f),!0},d.prototype.getVelocityAtPoint=function(a,b){return e.crossVZ(a,b,this.angularVelocity),e.subtract(a,this.velocity,a),a},d.sleepyEvent={type:"sleepy"},d.sleepEvent={type:"sleep"},d.wakeUpEvent={type:"wakeup"},d.DYNAMIC=1,d.STATIC=2,d.KINEMATIC=4,d.AWAKE=0,d.SLEEPY=1,d.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(a,b,c){function d(a,b,c){c=c||{},f.call(this,a,b,c),this.localAnchorA=e.fromValues(0,0),this.localAnchorB=e.fromValues(0,0),c.localAnchorA&&e.copy(this.localAnchorA,c.localAnchorA),c.localAnchorB&&e.copy(this.localAnchorB,c.localAnchorB),c.worldAnchorA&&this.setWorldAnchorA(c.worldAnchorA),c.worldAnchorB&&this.setWorldAnchorB(c.worldAnchorB);var d=e.create(),g=e.create();this.getWorldAnchorA(d),this.getWorldAnchorB(g);var h=e.distance(d,g);this.restLength="number"==typeof c.restLength?c.restLength:h}var e=a("../math/vec2"),f=a("./Spring");a("../utils/Utils");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.setWorldAnchorA=function(a){this.bodyA.toLocalFrame(this.localAnchorA,a)},d.prototype.setWorldAnchorB=function(a){this.bodyB.toLocalFrame(this.localAnchorB,a)},d.prototype.getWorldAnchorA=function(a){this.bodyA.toWorldFrame(a,this.localAnchorA)},d.prototype.getWorldAnchorB=function(a){this.bodyB.toWorldFrame(a,this.localAnchorB)};var g=e.create(),h=e.create(),i=e.create(),j=e.create(),k=e.create(),l=e.create(),m=e.create(),n=e.create(),o=e.create();d.prototype.applyForce=function(){var a=this.stiffness,b=this.damping,c=this.restLength,d=this.bodyA,f=this.bodyB,p=g,q=h,r=i,s=j,t=o,u=k,v=l,w=m,x=n;this.getWorldAnchorA(u),this.getWorldAnchorB(v),e.sub(w,u,d.position),e.sub(x,v,f.position),e.sub(p,v,u);var y=e.len(p);e.normalize(q,p),e.sub(r,f.velocity,d.velocity),e.crossZV(t,f.angularVelocity,x),e.add(r,r,t),e.crossZV(t,d.angularVelocity,w),e.sub(r,r,t),e.scale(s,q,-a*(y-c)-b*e.dot(r,q)),e.sub(d.force,d.force,s),e.add(f.force,f.force,s);var z=e.crossLength(w,s),A=e.crossLength(x,s);d.angularForce-=z,f.angularForce+=A}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(a,b,c){function d(a,b,c){c=c||{},e.call(this,a,b,c),this.restAngle="number"==typeof c.restAngle?c.restAngle:b.angle-a.angle}var e=(a("../math/vec2"),a("./Spring"));b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.applyForce=function(){var a=this.stiffness,b=this.damping,c=this.restAngle,d=this.bodyA,e=this.bodyB,f=e.angle-d.angle,g=e.angularVelocity-d.angularVelocity,h=-a*(f-c)-b*g*0;d.angularForce-=h,e.angularForce+=h}},{"../math/vec2":30,"./Spring":34}],34:[function(a,b,c){function d(a,b,c){c=e.defaults(c,{stiffness:100,damping:1}),this.stiffness=c.stiffness,this.damping=c.damping,this.bodyA=a,this.bodyB=b}var e=(a("../math/vec2"),a("../utils/Utils"));b.exports=d,d.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(a,b,c){function d(a,b){b=b||{},this.chassisBody=a,this.wheels=[],this.groundBody=new i({mass:0}),this.world=null;var c=this;this.preStepCallback=function(){c.update()}}function e(a,b){b=b||{},this.vehicle=a,this.forwardEquation=new h(a.chassisBody,a.groundBody),this.sideEquation=new h(a.chassisBody,a.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==b.sideFriction?b.sideFriction:5),this.localForwardVector=f.fromValues(0,1),b.localForwardVector&&f.copy(this.localForwardVector,b.localForwardVector),this.localPosition=f.fromValues(0,0),b.localPosition&&f.copy(this.localPosition,b.localPosition),g.apply(this,a.chassisBody,a.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var f=a("../math/vec2"),g=(a("../utils/Utils"),a("../constraints/Constraint")),h=a("../equations/FrictionEquation"),i=a("../objects/Body");b.exports=d,d.prototype.addToWorld=function(a){this.world=a,a.addBody(this.groundBody),a.on("preStep",this.preStepCallback);for(var b=0;b<this.wheels.length;b++){var c=this.wheels[b];a.addConstraint(c)}},d.prototype.removeFromWorld=function(){var a=this.world;a.removeBody(this.groundBody),a.off("preStep",this.preStepCallback);for(var b=0;b<this.wheels.length;b++){var c=this.wheels[b];a.removeConstraint(c)}this.world=null},d.prototype.addWheel=function(a){var b=new e(this,a);return this.wheels.push(b),b},d.prototype.update=function(){for(var a=0;a<this.wheels.length;a++)this.wheels[a].update()},e.prototype=new g,e.prototype.setBrakeForce=function(a){this.forwardEquation.setSlipForce(a)},e.prototype.setSideFriction=function(a){this.sideEquation.setSlipForce(a)};var j=f.create(),k=f.create();e.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(k,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(j,k),f.dot(j,k)};var l=f.create();e.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),f.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),f.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),f.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),f.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),f.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),f.normalize(l,this.forwardEquation.t),f.scale(l,l,this.engineForce),this.vehicle.chassisBody.applyForce(l,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(a,b,c){var d=b.exports={AABB:a("./collision/AABB"),AngleLockEquation:a("./equations/AngleLockEquation"),Body:a("./objects/Body"),Broadphase:a("./collision/Broadphase"),Capsule:a("./shapes/Capsule"),Circle:a("./shapes/Circle"),Constraint:a("./constraints/Constraint"),ContactEquation:a("./equations/ContactEquation"),ContactEquationPool:a("./utils/ContactEquationPool"),ContactMaterial:a("./material/ContactMaterial"),Convex:a("./shapes/Convex"),DistanceConstraint:a("./constraints/DistanceConstraint"),Equation:a("./equations/Equation"),EventEmitter:a("./events/EventEmitter"),FrictionEquation:a("./equations/FrictionEquation"),FrictionEquationPool:a("./utils/FrictionEquationPool"),GearConstraint:a("./constraints/GearConstraint"),GSSolver:a("./solver/GSSolver"),Heightfield:a("./shapes/Heightfield"),Line:a("./shapes/Line"),LockConstraint:a("./constraints/LockConstraint"),Material:a("./material/Material"),Narrowphase:a("./collision/Narrowphase"),NaiveBroadphase:a("./collision/NaiveBroadphase"),Particle:a("./shapes/Particle"),Plane:a("./shapes/Plane"),Pool:a("./utils/Pool"),RevoluteConstraint:a("./constraints/RevoluteConstraint"),PrismaticConstraint:a("./constraints/PrismaticConstraint"),Ray:a("./collision/Ray"),RaycastResult:a("./collision/RaycastResult"),Box:a("./shapes/Box"),RotationalVelocityEquation:a("./equations/RotationalVelocityEquation"),SAPBroadphase:a("./collision/SAPBroadphase"),Shape:a("./shapes/Shape"),Solver:a("./solver/Solver"),Spring:a("./objects/Spring"),TopDownVehicle:a("./objects/TopDownVehicle"),LinearSpring:a("./objects/LinearSpring"),RotationalSpring:a("./objects/RotationalSpring"),Utils:a("./utils/Utils"),World:a("./world/World"),vec2:a("./math/vec2"),version:a("../package.json").version};Object.defineProperty(d,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(a,b,c){function d(a){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(a={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),a=a||{};var b=this.width=a.width||1,c=this.height=a.height||1,d=[e.fromValues(-b/2,-c/2),e.fromValues(b/2,-c/2),e.fromValues(b/2,c/2),e.fromValues(-b/2,c/2)],h=[e.fromValues(1,0),e.fromValues(0,1)];a.vertices=d,a.axes=h,a.type=f.BOX,g.call(this,a)}var e=a("../math/vec2"),f=a("./Shape"),g=a("./Convex");b.exports=d,d.prototype=new g,d.prototype.constructor=d,d.prototype.computeMomentOfInertia=function(a){var b=this.width,c=this.height;return a*(c*c+b*b)/12},d.prototype.updateBoundingRadius=function(){var a=this.width,b=this.height;this.boundingRadius=Math.sqrt(a*a+b*b)/2};e.create(),e.create(),e.create(),e.create();d.prototype.computeAABB=function(a,b,c){a.setFromPoints(this.vertices,b,c,0)},d.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(a,b,c){function d(a){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(a={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),a=a||{},this.length=a.length||1,this.radius=a.radius||1,a.type=e.CAPSULE,e.call(this,a)}var e=a("./Shape"),f=a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeMomentOfInertia=function(a){var b=this.radius,c=this.length+b,d=2*b;return a*(d*d+c*c)/12},d.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},d.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var g=f.create();d.prototype.computeAABB=function(a,b,c){var d=this.radius;f.set(g,this.length/2,0),0!==c&&f.rotate(g,g,c),f.set(a.upperBound,Math.max(g[0]+d,-g[0]+d),Math.max(g[1]+d,-g[1]+d)),f.set(a.lowerBound,Math.min(g[0]-d,-g[0]-d),Math.min(g[1]-d,-g[1]-d)),f.add(a.lowerBound,a.lowerBound,b),f.add(a.upperBound,a.upperBound,b)};var h=f.create(),i=f.create(),j=f.create(),k=f.create(),l=f.fromValues(0,1);d.prototype.raycast=function(a,b,c,d){for(var e=b.from,g=b.to,m=(b.direction,h),n=i,o=j,p=k,q=this.length/2,r=0;2>r;r++){var s=this.radius*(2*r-1);f.set(o,-q,s),f.set(p,q,s),f.toGlobalFrame(o,o,c,d),f.toGlobalFrame(p,p,c,d);var t=f.getLineSegmentsIntersectionFraction(e,g,o,p);if(t>=0&&(f.rotate(n,l,d),f.scale(n,n,2*r-1),b.reportIntersection(a,t,n,-1),a.shouldStop(b)))return}for(var u=Math.pow(this.radius,2)+Math.pow(q,2),r=0;2>r;r++){f.set(o,q*(2*r-1),0),f.toGlobalFrame(o,o,c,d);var v=Math.pow(g[0]-e[0],2)+Math.pow(g[1]-e[1],2),w=2*((g[0]-e[0])*(e[0]-o[0])+(g[1]-e[1])*(e[1]-o[1])),x=Math.pow(e[0]-o[0],2)+Math.pow(e[1]-o[1],2)-Math.pow(this.radius,2),t=Math.pow(w,2)-4*v*x;if(!(0>t))if(0===t){if(f.lerp(m,e,g,t),f.squaredDistance(m,c)>u&&(f.sub(n,m,o),f.normalize(n,n),b.reportIntersection(a,t,n,-1),a.shouldStop(b)))return}else{var y=Math.sqrt(t),z=1/(2*v),A=(-w-y)*z,B=(-w+y)*z;if(A>=0&&1>=A&&(f.lerp(m,e,g,A),f.squaredDistance(m,c)>u&&(f.sub(n,m,o),f.normalize(n,n),b.reportIntersection(a,A,n,-1),a.shouldStop(b))))return;if(B>=0&&1>=B&&(f.lerp(m,e,g,B),f.squaredDistance(m,c)>u&&(f.sub(n,m,o),f.normalize(n,n),b.reportIntersection(a,B,n,-1),a.shouldStop(b))))return}}}},{"../math/vec2":30,"./Shape":45}],39:[function(a,b,c){function d(a){"number"==typeof arguments[0]&&(a={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),a=a||{},this.radius=a.radius||1,a.type=e.CIRCLE,e.call(this,a)}var e=a("./Shape"),f=a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeMomentOfInertia=function(a){var b=this.radius;return a*b*b/2},d.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},d.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},d.prototype.computeAABB=function(a,b,c){var d=this.radius;f.set(a.upperBound,d,d),f.set(a.lowerBound,-d,-d),b&&(f.add(a.lowerBound,a.lowerBound,b),f.add(a.upperBound,a.upperBound,b))};var g=f.create(),h=f.create();d.prototype.raycast=function(a,b,c,d){var e=b.from,i=b.to,j=this.radius,k=Math.pow(i[0]-e[0],2)+Math.pow(i[1]-e[1],2),l=2*((i[0]-e[0])*(e[0]-c[0])+(i[1]-e[1])*(e[1]-c[1])),m=Math.pow(e[0]-c[0],2)+Math.pow(e[1]-c[1],2)-Math.pow(j,2),n=Math.pow(l,2)-4*k*m,o=g,p=h;if(!(0>n))if(0===n)f.lerp(o,e,i,n),f.sub(p,o,c),f.normalize(p,p),b.reportIntersection(a,n,p,-1);else{var q=Math.sqrt(n),r=1/(2*k),s=(-l-q)*r,t=(-l+q)*r;if(s>=0&&1>=s&&(f.lerp(o,e,i,s),f.sub(p,o,c),f.normalize(p,p),b.reportIntersection(a,s,p,-1),a.shouldStop(b)))return;t>=0&&1>=t&&(f.lerp(o,e,i,t),f.sub(p,o,c),f.normalize(p,p),b.reportIntersection(a,t,p,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(a,b,c){function d(a){Array.isArray(arguments[0])&&(a={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),a=a||{},this.vertices=[];for(var b=void 0!==a.vertices?a.vertices:[],c=0;c<b.length;c++){var d=f.create();f.copy(d,b[c]),this.vertices.push(d)}if(this.axes=[],a.axes)for(var c=0;c<a.axes.length;c++){var g=f.create();f.copy(g,a.axes[c]),this.axes.push(g)}else for(var c=0;c<this.vertices.length;c++){var h=this.vertices[c],i=this.vertices[(c+1)%this.vertices.length],j=f.create();f.sub(j,i,h),f.rotate90cw(j,j),f.normalize(j,j),this.axes.push(j)}if(this.centerOfMass=f.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,a.type=e.CONVEX,e.call(this,a),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var e=a("./Shape"),f=a("../math/vec2"),g=a("../math/polyk");a("poly-decomp");b.exports=d,d.prototype=new e,d.prototype.constructor=d;var h=f.create(),i=f.create();d.prototype.projectOntoLocalAxis=function(a,b){for(var c,d,e=null,g=null,a=h,i=0;i<this.vertices.length;i++)c=this.vertices[i],d=f.dot(c,a),(null===e||d>e)&&(e=d),(null===g||g>d)&&(g=d);if(g>e){var j=g;g=e,e=j}f.set(b,g,e)},d.prototype.projectOntoWorldAxis=function(a,b,c,d){var e=i;this.projectOntoLocalAxis(a,d),0!==c?f.rotate(e,a,c):e=a;var g=f.dot(b,e);f.set(d,d[0]+g,d[1]+g)},d.prototype.updateTriangles=function(){this.triangles.length=0;for(var a=[],b=0;b<this.vertices.length;b++){var c=this.vertices[b];a.push(c[0],c[1])}for(var d=g.Triangulate(a),b=0;b<d.length;b+=3){var e=d[b],f=d[b+1],h=d[b+2];this.triangles.push([e,f,h])}};var j=f.create(),k=f.create(),l=f.create(),m=f.create(),n=f.create();f.create(),f.create(),f.create(),f.create();d.prototype.updateCenterOfMass=function(){var a=this.triangles,b=this.vertices,c=this.centerOfMass,e=j,g=l,h=m,i=n,o=k;f.set(c,0,0);for(var p=0,q=0;q!==a.length;q++){var r=a[q],g=b[r[0]],h=b[r[1]],i=b[r[2]];f.centroid(e,g,h,i);var s=d.triangleArea(g,h,i);p+=s,f.scale(o,e,s),f.add(c,c,o)}f.scale(c,c,1/p)},d.prototype.computeMomentOfInertia=function(a){for(var b=0,c=0,d=this.vertices.length,e=d-1,g=0;d>g;e=g,g++){var h=this.vertices[e],i=this.vertices[g],j=Math.abs(f.crossLength(h,i)),k=f.dot(i,i)+f.dot(i,h)+f.dot(h,h);b+=j*k,c+=j}return a/6*(b/c)},d.prototype.updateBoundingRadius=function(){for(var a=this.vertices,b=0,c=0;c!==a.length;c++){var d=f.squaredLength(a[c]);d>b&&(b=d)}this.boundingRadius=Math.sqrt(b)},d.triangleArea=function(a,b,c){return.5*((b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1]))},d.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var a=this.triangles,b=this.vertices,c=0;c!==a.length;c++){var e=a[c],f=b[e[0]],g=b[e[1]],h=b[e[2]],i=d.triangleArea(f,g,h);this.area+=i}},d.prototype.computeAABB=function(a,b,c){a.setFromPoints(this.vertices,b,c,0)};var o=f.create(),p=f.create(),q=f.create();d.prototype.raycast=function(a,b,c,d){var e=o,g=p,h=q,i=this.vertices;f.toLocalFrame(e,b.from,c,d),f.toLocalFrame(g,b.to,c,d);for(var j=i.length,k=0;j>k&&!a.shouldStop(b);k++){var l=i[k],m=i[(k+1)%j],n=f.getLineSegmentsIntersectionFraction(e,g,l,m);n>=0&&(f.sub(h,m,l),f.rotate(h,h,-Math.PI/2+d),f.normalize(h,h),b.reportIntersection(a,n,h,k))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(a,b,c){function d(a){if(Array.isArray(arguments[0])){if(a={heights:arguments[0]},"object"==typeof arguments[1])for(var b in arguments[1])a[b]=arguments[1][b];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}a=a||{},this.heights=a.heights?a.heights.slice(0):[],this.maxValue=a.maxValue||null,this.minValue=a.minValue||null,this.elementWidth=a.elementWidth||.1,(void 0===a.maxValue||void 0===a.minValue)&&this.updateMaxMinValues(),a.type=e.HEIGHTFIELD,e.call(this,a)}var e=a("./Shape"),f=a("../math/vec2");a("../utils/Utils");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.updateMaxMinValues=function(){for(var a=this.heights,b=a[0],c=a[0],d=0;d!==a.length;d++){var e=a[d];e>b&&(b=e),c>e&&(c=e)}this.maxValue=b,this.minValue=c},d.prototype.computeMomentOfInertia=function(a){return Number.MAX_VALUE},d.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},d.prototype.updateArea=function(){for(var a=this.heights,b=0,c=0;c<a.length-1;c++)b+=(a[c]+a[c+1])/2*this.elementWidth;this.area=b};var g=[f.create(),f.create(),f.create(),f.create()];d.prototype.computeAABB=function(a,b,c){f.set(g[0],0,this.maxValue),f.set(g[1],this.elementWidth*this.heights.length,this.maxValue),f.set(g[2],this.elementWidth*this.heights.length,this.minValue),f.set(g[3],0,this.minValue),a.setFromPoints(g,b,c)},d.prototype.getLineSegment=function(a,b,c){var d=this.heights,e=this.elementWidth;f.set(a,c*e,d[c]),f.set(b,(c+1)*e,d[c+1])},d.prototype.getSegmentIndex=function(a){return Math.floor(a[0]/this.elementWidth)},d.prototype.getClampedSegmentIndex=function(a){var b=this.getSegmentIndex(a);return b=Math.min(this.heights.length,Math.max(b,0))};var h=(f.create(),f.create()),i=f.create(),j=f.create(),k=f.create(),l=f.create();f.fromValues(0,1);d.prototype.raycast=function(a,b,c,d){var e=b.from,g=b.to,m=(b.direction,h),n=i,o=j,p=k,q=l;f.toLocalFrame(p,e,c,d),f.toLocalFrame(q,g,c,d);var r=this.getClampedSegmentIndex(p),s=this.getClampedSegmentIndex(q);if(r>s){var t=r;r=s,s=t}for(var u=0;u<this.heights.length-1;u++){this.getLineSegment(n,o,u);var v=f.getLineSegmentsIntersectionFraction(p,q,n,o);if(v>=0&&(f.sub(m,o,n),f.rotate(m,m,d+Math.PI/2),f.normalize(m,m),b.reportIntersection(a,v,m,-1),a.shouldStop(b)))return}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(a,b,c){function d(a){"number"==typeof arguments[0]&&(a={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),a=a||{},this.length=a.length||1,a.type=e.LINE,e.call(this,a)}var e=a("./Shape"),f=a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeMomentOfInertia=function(a){return a*Math.pow(this.length,2)/12},d.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var g=[f.create(),f.create()];d.prototype.computeAABB=function(a,b,c){var d=this.length/2;f.set(g[0],-d,0),f.set(g[1],d,0),a.setFromPoints(g,b,c,0)};var h=(f.create(),f.create()),i=f.create(),j=f.create(),k=f.fromValues(0,1);d.prototype.raycast=function(a,b,c,d){var e=b.from,g=b.to,l=i,m=j,n=this.length/2;f.set(l,-n,0),f.set(m,n,0),f.toGlobalFrame(l,l,c,d),f.toGlobalFrame(m,m,c,d);var o=f.getLineSegmentsIntersectionFraction(l,m,e,g);if(o>=0){var p=h;f.rotate(p,k,d),b.reportIntersection(a,o,p,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(a,b,c){function d(a){a=a||{},a.type=e.PARTICLE,e.call(this,a)}var e=a("./Shape"),f=a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeMomentOfInertia=function(a){return 0},d.prototype.updateBoundingRadius=function(){this.boundingRadius=0},d.prototype.computeAABB=function(a,b,c){f.copy(a.lowerBound,b),f.copy(a.upperBound,b)}},{"../math/vec2":30,"./Shape":45}],44:[function(a,b,c){function d(a){a=a||{},a.type=e.PLANE,e.call(this,a)}var e=a("./Shape"),f=a("../math/vec2");a("../utils/Utils");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeMomentOfInertia=function(a){return 0},d.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},d.prototype.computeAABB=function(a,b,c){var d=c%(2*Math.PI),e=f.set,g=1e7,h=a.lowerBound,i=a.upperBound;e(h,-g,-g),e(i,g,g),0===d?i[1]=0:d===Math.PI/2?h[0]=0:d===Math.PI?h[1]=0:d===3*Math.PI/2&&(i[0]=0)},d.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var g=f.create(),h=(f.create(),f.create(),f.create()),i=f.create();d.prototype.raycast=function(a,b,c,d){var e=b.from,j=b.to,k=b.direction,l=g,m=h,n=i;f.set(m,0,1),f.rotate(m,m,d),f.sub(n,e,c);var o=f.dot(n,m);f.sub(n,j,c);var p=f.dot(n,m);if(!(o*p>0||f.squaredDistance(e,j)<o*o)){var q=f.dot(m,k);f.sub(l,e,c);var r=-f.dot(m,l)/q/b.length;b.reportIntersection(a,r,m,-1)}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(a,b,c){function d(a){a=a||{},this.body=null,this.position=e.fromValues(0,0),a.position&&e.copy(this.position,a.position),this.angle=a.angle||0,this.type=a.type||0,this.id=d.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==a.collisionGroup?a.collisionGroup:1,this.collisionResponse=void 0!==a.collisionResponse?a.collisionResponse:!0,this.collisionMask=void 0!==a.collisionMask?a.collisionMask:1,this.material=a.material||null,this.area=0,this.sensor=void 0!==a.sensor?a.sensor:!1,this.type&&this.updateBoundingRadius(),this.updateArea()}b.exports=d;var e=a("../math/vec2");d.idCounter=0,d.CIRCLE=1,d.PARTICLE=2,d.PLANE=4,d.CONVEX=8,d.LINE=16,d.BOX=32,Object.defineProperty(d,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),d.BOX}}),d.CAPSULE=64,d.HEIGHTFIELD=128,d.prototype.computeMomentOfInertia=function(a){},d.prototype.updateBoundingRadius=function(){},d.prototype.updateArea=function(){},d.prototype.computeAABB=function(a,b,c){},d.prototype.raycast=function(a,b,c,d){}},{"../math/vec2":30}],46:[function(a,b,c){function d(a){g.call(this,a,g.GS),a=a||{},this.iterations=a.iterations||10,this.tolerance=a.tolerance||1e-7,this.arrayStep=30,this.lambda=new h.ARRAY_TYPE(this.arrayStep),
this.Bs=new h.ARRAY_TYPE(this.arrayStep),this.invCs=new h.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=void 0!==a.frictionIterations?0:a.frictionIterations,this.usedIterations=0}function e(a){for(var b=a.length;b--;)a[b]=0}var f=a("../math/vec2"),g=a("./Solver"),h=a("../utils/Utils"),i=a("../equations/FrictionEquation");b.exports=d,d.prototype=new g,d.prototype.constructor=d,d.prototype.solve=function(a,b){this.sortEquations();var c=0,g=this.iterations,j=this.frictionIterations,k=this.equations,l=k.length,m=Math.pow(this.tolerance*l,2),n=b.bodies,o=b.bodies.length,p=(f.add,f.set,this.useZeroRHS),q=this.lambda;if(this.usedIterations=0,l)for(var r=0;r!==o;r++){var s=n[r];s.updateSolveMassProperties()}q.length<l&&(q=this.lambda=new h.ARRAY_TYPE(l+this.arrayStep),this.Bs=new h.ARRAY_TYPE(l+this.arrayStep),this.invCs=new h.ARRAY_TYPE(l+this.arrayStep)),e(q);for(var t=this.invCs,u=this.Bs,q=this.lambda,r=0;r!==k.length;r++){var v=k[r];(v.timeStep!==a||v.needsUpdate)&&(v.timeStep=a,v.update()),u[r]=v.computeB(v.a,v.b,a),t[r]=v.computeInvC(v.epsilon)}var v,w,r,x;if(0!==l){for(r=0;r!==o;r++){var s=n[r];s.resetConstraintVelocity()}if(j){for(c=0;c!==j;c++){for(w=0,x=0;x!==l;x++){v=k[x];var y=d.iterateEquation(x,v,v.epsilon,u,t,q,p,a,c);w+=Math.abs(y)}if(this.usedIterations++,m>=w*w)break}for(d.updateMultipliers(k,q,1/a),x=0;x!==l;x++){var z=k[x];if(z instanceof i){for(var A=0,B=0;B!==z.contactEquations.length;B++)A+=z.contactEquations[B].multiplier;A*=z.frictionCoefficient/z.contactEquations.length,z.maxForce=A,z.minForce=-A}}}for(c=0;c!==g;c++){for(w=0,x=0;x!==l;x++){v=k[x];var y=d.iterateEquation(x,v,v.epsilon,u,t,q,p,a,c);w+=Math.abs(y)}if(this.usedIterations++,m>=w*w)break}for(r=0;r!==o;r++)n[r].addConstraintVelocity();d.updateMultipliers(k,q,1/a)}},d.updateMultipliers=function(a,b,c){for(var d=a.length;d--;)a[d].multiplier=b[d]*c},d.iterateEquation=function(a,b,c,d,e,f,g,h,i){var j=d[a],k=e[a],l=f[a],m=b.computeGWlambda(),n=b.maxForce,o=b.minForce;g&&(j=0);var p=k*(j-m-c*l),q=l+p;return o*h>q?p=o*h-l:q>n*h&&(p=n*h-l),f[a]+=p,b.addToWlambda(p),p}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(a,b,c){function d(a,b){a=a||{},e.call(this),this.type=b,this.equations=[],this.equationSortFunction=a.equationSortFunction||!1}var e=(a("../utils/Utils"),a("../events/EventEmitter"));b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.solve=function(a,b){throw new Error("Solver.solve should be implemented by subclasses!")};var f={bodies:[]};d.prototype.solveIsland=function(a,b){this.removeAllEquations(),b.equations.length&&(this.addEquations(b.equations),f.bodies.length=0,b.getBodies(f.bodies),f.bodies.length&&this.solve(a,f))},d.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},d.prototype.addEquation=function(a){a.enabled&&this.equations.push(a)},d.prototype.addEquations=function(a){for(var b=0,c=a.length;b!==c;b++){var d=a[b];d.enabled&&this.equations.push(d)}},d.prototype.removeEquation=function(a){var b=this.equations.indexOf(a);-1!==b&&this.equations.splice(b,1)},d.prototype.removeAllEquations=function(){this.equations.length=0},d.GS=1,d.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(a,b,c){function d(){f.apply(this,arguments)}var e=a("../equations/ContactEquation"),f=a("./Pool");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.create=function(){return new e},d.prototype.destroy=function(a){return a.bodyA=a.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(a,b,c){function d(){f.apply(this,arguments)}var e=a("../equations/FrictionEquation"),f=a("./Pool");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.create=function(){return new e},d.prototype.destroy=function(a){return a.bodyA=a.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(a,b,c){function d(){f.apply(this,arguments)}var e=a("../world/IslandNode"),f=a("./Pool");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.create=function(){return new e},d.prototype.destroy=function(a){return a.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(a,b,c){function d(){f.apply(this,arguments)}var e=a("../world/Island"),f=a("./Pool");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.create=function(){return new e},d.prototype.destroy=function(a){return a.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(a,b,c){function d(){this.overlappingShapesLastState=new e,this.overlappingShapesCurrentState=new e,this.recordPool=new f({size:16}),this.tmpDict=new e,this.tmpArray1=[]}var e=a("./TupleDictionary"),f=(a("./OverlapKeeperRecord"),a("./OverlapKeeperRecordPool"));a("./Utils");b.exports=d,d.prototype.tick=function(){for(var a=this.overlappingShapesLastState,b=this.overlappingShapesCurrentState,c=a.keys.length;c--;){var d=a.keys[c],e=a.getByKey(d);b.getByKey(d);e&&this.recordPool.release(e)}a.reset(),a.copy(b),b.reset()},d.prototype.setOverlapping=function(a,b,c,d){var e=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);if(!e.get(b.id,d.id)){var f=this.recordPool.get();f.set(a,b,c,d),e.set(b.id,d.id,f)}},d.prototype.getNewOverlaps=function(a){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,a)},d.prototype.getEndOverlaps=function(a){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,a)},d.prototype.bodiesAreOverlapping=function(a,b){for(var c=this.overlappingShapesCurrentState,d=c.keys.length;d--;){var e=c.keys[d],f=c.data[e];if(f.bodyA===a&&f.bodyB===b||f.bodyA===b&&f.bodyB===a)return!0}return!1},d.prototype.getDiff=function(a,b,c){var c=c||[],d=a,e=b;c.length=0;for(var f=e.keys.length;f--;){var g=e.keys[f],h=e.data[g];if(!h)throw new Error("Key "+g+" had no data!");var i=d.data[g];i||c.push(h)}return c},d.prototype.isNewOverlap=function(a,b){var c=0|a.id,d=0|b.id,e=this.overlappingShapesLastState,f=this.overlappingShapesCurrentState;return!e.get(c,d)&&!!f.get(c,d)},d.prototype.getNewBodyOverlaps=function(a){this.tmpArray1.length=0;var b=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(b,a)},d.prototype.getEndBodyOverlaps=function(a){this.tmpArray1.length=0;var b=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(b,a)},d.prototype.getBodyDiff=function(a,b){b=b||[];for(var c=this.tmpDict,d=a.length;d--;){var e=a[d];c.set(0|e.bodyA.id,0|e.bodyB.id,e)}for(d=c.keys.length;d--;){var e=c.getByKey(c.keys[d]);e&&b.push(e.bodyA,e.bodyB)}return c.reset(),b}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(a,b,c){function d(a,b,c,d){this.shapeA=b,this.shapeB=d,this.bodyA=a,this.bodyB=c}b.exports=d,d.prototype.set=function(a,b,c,e){d.call(this,a,b,c,e)}},{}],54:[function(a,b,c){function d(){f.apply(this,arguments)}var e=a("./OverlapKeeperRecord"),f=a("./Pool");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.create=function(){return new e},d.prototype.destroy=function(a){return a.bodyA=a.bodyB=a.shapeA=a.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(a,b,c){function d(a){a=a||{},this.objects=[],void 0!==a.size&&this.resize(a.size)}b.exports=d,d.prototype.resize=function(a){for(var b=this.objects;b.length>a;)b.pop();for(;b.length<a;)b.push(this.create());return this},d.prototype.get=function(){var a=this.objects;return a.length?a.pop():this.create()},d.prototype.release=function(a){return this.destroy(a),this.objects.push(a),this}},{}],56:[function(a,b,c){function d(){this.data={},this.keys=[]}var e=a("./Utils");b.exports=d,d.prototype.getKey=function(a,b){return a=0|a,b=0|b,(0|a)===(0|b)?-1:0|((0|a)>(0|b)?a<<16|65535&b:b<<16|65535&a)},d.prototype.getByKey=function(a){return a=0|a,this.data[a]},d.prototype.get=function(a,b){return this.data[this.getKey(a,b)]},d.prototype.set=function(a,b,c){if(!c)throw new Error("No data!");var d=this.getKey(a,b);return this.data[d]||this.keys.push(d),this.data[d]=c,d},d.prototype.reset=function(){for(var a=this.data,b=this.keys,c=b.length;c--;)delete a[b[c]];b.length=0},d.prototype.copy=function(a){this.reset(),e.appendArray(this.keys,a.keys);for(var b=a.keys.length;b--;){var c=a.keys[b];this.data[c]=a.data[c]}}},{"./Utils":57}],57:[function(a,b,c){function d(){}b.exports=d,d.appendArray=function(a,b){if(b.length<15e4)a.push.apply(a,b);else for(var c=0,d=b.length;c!==d;++c)a.push(b[c])},d.splice=function(a,b,c){c=c||1;for(var d=b,e=a.length-c;e>d;d++)a[d]=a[d+c];a.length=e},"undefined"!=typeof P2_ARRAY_TYPE?d.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?d.ARRAY_TYPE=Float32Array:d.ARRAY_TYPE=Array,d.extend=function(a,b){for(var c in b)a[c]=b[c]},d.defaults=function(a,b){a=a||{};for(var c in b)c in a||(a[c]=b[c]);return a}},{}],58:[function(a,b,c){function d(){this.equations=[],this.bodies=[]}var e=a("../objects/Body");b.exports=d,d.prototype.reset=function(){this.equations.length=this.bodies.length=0};var f=[];d.prototype.getBodies=function(a){var b=a||[],c=this.equations;f.length=0;for(var d=0;d!==c.length;d++){var e=c[d];-1===f.indexOf(e.bodyA.id)&&(b.push(e.bodyA),f.push(e.bodyA.id)),-1===f.indexOf(e.bodyB.id)&&(b.push(e.bodyB),f.push(e.bodyB.id))}return b},d.prototype.wantsToSleep=function(){for(var a=0;a<this.bodies.length;a++){var b=this.bodies[a];if(b.type===e.DYNAMIC&&!b.wantsToSleep)return!1}return!0},d.prototype.sleep=function(){for(var a=0;a<this.bodies.length;a++){var b=this.bodies[a];b.sleep()}return!0}},{"../objects/Body":31}],59:[function(a,b,c){function d(a){this.nodePool=new e({size:16}),this.islandPool=new f({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var e=(a("../math/vec2"),a("./Island"),a("./IslandNode"),a("./../utils/IslandNodePool")),f=a("./../utils/IslandPool"),g=a("../objects/Body");b.exports=d,d.getUnvisitedNode=function(a){for(var b=a.length,c=0;c!==b;c++){var d=a[c];if(!d.visited&&d.body.type===g.DYNAMIC)return d}return!1},d.prototype.visit=function(a,b,c){b.push(a.body);for(var d=a.equations.length,e=0;e!==d;e++){var f=a.equations[e];-1===c.indexOf(f)&&c.push(f)}},d.prototype.bfs=function(a,b,c){var e=this.queue;for(e.length=0,e.push(a),a.visited=!0,this.visit(a,b,c);e.length;)for(var f,h=e.pop();f=d.getUnvisitedNode(h.neighbors);)f.visited=!0,this.visit(f,b,c),f.body.type===g.DYNAMIC&&e.push(f)},d.prototype.split=function(a){for(var b=a.bodies,c=this.nodes,e=this.equations;c.length;)this.nodePool.release(c.pop());for(var f=0;f!==b.length;f++){var g=this.nodePool.get();g.body=b[f],c.push(g)}for(var h=0;h!==e.length;h++){var i=e[h],f=b.indexOf(i.bodyA),j=b.indexOf(i.bodyB),k=c[f],l=c[j];k.neighbors.push(l),l.neighbors.push(k),k.equations.push(i),l.equations.push(i)}for(var m=this.islands,f=0;f<m.length;f++)this.islandPool.release(m[f]);m.length=0;for(var n;n=d.getUnvisitedNode(c);){var o=this.islandPool.get();this.bfs(n,o.bodies,o.equations),m.push(o)}return m}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(a,b,c){function d(a){this.body=a,this.neighbors=[],this.equations=[],this.visited=!1}b.exports=d,d.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(a,b,c){function d(a){l.apply(this),a=a||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=a.solver||new e,this.narrowphase=new r(this),this.islandManager=new u,this.gravity=f.fromValues(0,-9.78),a.gravity&&f.copy(this.gravity,a.gravity),this.frictionGravity=f.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=a.broadphase||new q,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new n,this.defaultContactMaterial=new o(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit="undefined"!=typeof a.islandSplit?!!a.islandSplit:!0,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=d.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new t}var e=a("../solver/GSSolver"),f=(a("../solver/Solver"),a("../collision/Ray"),a("../math/vec2")),g=a("../shapes/Circle"),h=a("../shapes/Convex"),i=(a("../shapes/Line"),a("../shapes/Plane")),j=a("../shapes/Capsule"),k=a("../shapes/Particle"),l=a("../events/EventEmitter"),m=a("../objects/Body"),n=(a("../shapes/Shape"),a("../objects/LinearSpring"),a("../material/Material")),o=a("../material/ContactMaterial"),p=(a("../constraints/DistanceConstraint"),a("../constraints/Constraint"),a("../constraints/LockConstraint"),a("../constraints/RevoluteConstraint"),a("../constraints/PrismaticConstraint"),a("../constraints/GearConstraint"),a("../../package.json"),a("../collision/Broadphase"),a("../collision/AABB")),q=a("../collision/SAPBroadphase"),r=a("../collision/Narrowphase"),s=a("../utils/Utils"),t=a("../utils/OverlapKeeper"),u=a("./IslandManager");a("../objects/RotationalSpring");b.exports=d,d.prototype=new Object(l.prototype),d.prototype.constructor=d,d.NO_SLEEPING=1,d.BODY_SLEEPING=2,d.ISLAND_SLEEPING=4,d.prototype.addConstraint=function(a){this.constraints.push(a)},d.prototype.addContactMaterial=function(a){this.contactMaterials.push(a)},d.prototype.removeContactMaterial=function(a){var b=this.contactMaterials.indexOf(a);-1!==b&&s.splice(this.contactMaterials,b,1)},d.prototype.getContactMaterial=function(a,b){for(var c=this.contactMaterials,d=0,e=c.length;d!==e;d++){var f=c[d];if(f.materialA.id===a.id&&f.materialB.id===b.id||f.materialA.id===b.id&&f.materialB.id===a.id)return f}return!1},d.prototype.removeConstraint=function(a){var b=this.constraints.indexOf(a);-1!==b&&s.splice(this.constraints,b,1)};var v=(f.create(),f.create(),f.create(),f.create(),f.create(),f.create(),f.create()),w=f.fromValues(0,0),x=f.fromValues(0,0);f.fromValues(0,0),f.fromValues(0,0);d.prototype.step=function(a,b,c){if(c=c||10,b=b||0,0===b)this.internalStep(a),this.time+=a;else{this.accumulator+=b;for(var d=0;this.accumulator>=a&&c>d;)this.internalStep(a),this.time+=a,this.accumulator-=a,d++;for(var e=this.accumulator%a/a,g=0;g!==this.bodies.length;g++){var h=this.bodies[g];f.lerp(h.interpolatedPosition,h.previousPosition,h.position,e),h.interpolatedAngle=h.previousAngle+e*(h.angle-h.previousAngle)}}};var y=[];d.prototype.internalStep=function(a){this.stepping=!0;var b=this.springs.length,c=this.springs,e=this.bodies,g=this.gravity,h=this.solver,i=this.bodies.length,j=this.broadphase,k=this.narrowphase,l=this.constraints,n=v,o=(f.scale,f.add),p=(f.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=a,this.useWorldGravityAsFrictionGravity){var q=f.length(this.gravity);0===q&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=q)}if(this.applyGravity)for(var r=0;r!==i;r++){var t=e[r],u=t.force;t.type===m.DYNAMIC&&t.sleepState!==m.SLEEPING&&(f.scale(n,g,t.mass*t.gravityScale),o(u,u,n))}if(this.applySpringForces)for(var r=0;r!==b;r++){var w=c[r];w.applyForce()}if(this.applyDamping)for(var r=0;r!==i;r++){var t=e[r];t.type===m.DYNAMIC&&t.applyDamping(a)}for(var x=j.getCollisionPairs(this),z=this.disabledBodyCollisionPairs,r=z.length-2;r>=0;r-=2)for(var A=x.length-2;A>=0;A-=2)(z[r]===x[A]&&z[r+1]===x[A+1]||z[r+1]===x[A]&&z[r]===x[A+1])&&x.splice(A,2);var B=l.length;for(r=0;r!==B;r++){var C=l[r];if(!C.collideConnected)for(var A=x.length-2;A>=0;A-=2)(C.bodyA===x[A]&&C.bodyB===x[A+1]||C.bodyB===x[A]&&C.bodyA===x[A+1])&&x.splice(A,2)}this.postBroadphaseEvent.pairs=x,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,k.reset(this);for(var r=0,D=x.length;r!==D;r+=2)for(var E=x[r],F=x[r+1],G=0,H=E.shapes.length;G!==H;G++)for(var I=E.shapes[G],J=I.position,K=I.angle,L=0,M=F.shapes.length;L!==M;L++){var N=F.shapes[L],O=N.position,P=N.angle,Q=this.defaultContactMaterial;if(I.material&&N.material){var R=this.getContactMaterial(I.material,N.material);R&&(Q=R)}this.runNarrowphase(k,E,I,J,K,F,N,O,P,Q,this.frictionGravity)}for(var r=0;r!==i;r++){var S=e[r];S._wakeUpAfterNarrowphase&&(S.wakeUp(),S._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(y);for(var T=this.endContactEvent,L=y.length;L--;){var U=y[L];T.shapeA=U.shapeA,T.shapeB=U.shapeB,T.bodyA=U.bodyA,T.bodyB=U.bodyB,this.emit(T)}y.length=0}var V=this.preSolveEvent;V.contactEquations=k.contactEquations,V.frictionEquations=k.frictionEquations,this.emit(V),V.contactEquations=V.frictionEquations=null;var B=l.length;for(r=0;r!==B;r++)l[r].update();if(k.contactEquations.length||k.frictionEquations.length||B)if(this.islandSplit){for(p.equations.length=0,s.appendArray(p.equations,k.contactEquations),s.appendArray(p.equations,k.frictionEquations),r=0;r!==B;r++)s.appendArray(p.equations,l[r].equations);p.split(this);for(var r=0;r!==p.islands.length;r++){var W=p.islands[r];W.equations.length&&h.solveIsland(a,W)}}else{for(h.addEquations(k.contactEquations),h.addEquations(k.frictionEquations),r=0;r!==B;r++)h.addEquations(l[r].equations);this.solveConstraints&&h.solve(a,this),h.removeAllEquations()}for(var r=0;r!==i;r++){var S=e[r];S.integrate(a)}for(var r=0;r!==i;r++)e[r].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var X=this.impactEvent,r=0;r!==k.contactEquations.length;r++){var Y=k.contactEquations[r];Y.firstImpact&&(X.bodyA=Y.bodyA,X.bodyB=Y.bodyB,X.shapeA=Y.shapeA,X.shapeB=Y.shapeB,X.contactEquation=Y,this.emit(X))}if(this.sleepMode===d.BODY_SLEEPING)for(r=0;r!==i;r++)e[r].sleepTick(this.time,!1,a);else if(this.sleepMode===d.ISLAND_SLEEPING&&this.islandSplit){for(r=0;r!==i;r++)e[r].sleepTick(this.time,!0,a);for(var r=0;r<this.islandManager.islands.length;r++){var W=this.islandManager.islands[r];W.wantsToSleep()&&W.sleep()}}this.stepping=!1;for(var Z=this.bodiesToBeRemoved,r=0;r!==Z.length;r++)this.removeBody(Z[r]);Z.length=0,this.emit(this.postStepEvent)},d.prototype.runNarrowphase=function(a,b,c,d,e,g,h,i,j,k,l){if(0!==(c.collisionGroup&h.collisionMask)&&0!==(h.collisionGroup&c.collisionMask)){f.rotate(w,d,b.angle),f.rotate(x,i,g.angle),f.add(w,w,b.position),f.add(x,x,g.position);var n=e+b.angle,o=j+g.angle;a.enableFriction=k.friction>0,a.frictionCoefficient=k.friction;var p;p=b.type===m.STATIC||b.type===m.KINEMATIC?g.mass:g.type===m.STATIC||g.type===m.KINEMATIC?b.mass:b.mass*g.mass/(b.mass+g.mass),a.slipForce=k.friction*l*p,a.restitution=k.restitution,a.surfaceVelocity=k.surfaceVelocity,a.frictionStiffness=k.frictionStiffness,a.frictionRelaxation=k.frictionRelaxation,a.stiffness=k.stiffness,a.relaxation=k.relaxation,a.contactSkinSize=k.contactSkinSize,a.enabledEquations=b.collisionResponse&&g.collisionResponse&&c.collisionResponse&&h.collisionResponse;var q=a[c.type|h.type],r=0;if(q){var s=c.sensor||h.sensor,t=a.frictionEquations.length;r=c.type<h.type?q.call(a,b,c,w,n,g,h,x,o,s):q.call(a,g,h,x,o,b,c,w,n,s);var u=a.frictionEquations.length-t;if(r){if(b.allowSleep&&b.type===m.DYNAMIC&&b.sleepState===m.SLEEPING&&g.sleepState===m.AWAKE&&g.type!==m.STATIC){var v=f.squaredLength(g.velocity)+Math.pow(g.angularVelocity,2),y=Math.pow(g.sleepSpeedLimit,2);v>=2*y&&(b._wakeUpAfterNarrowphase=!0)}if(g.allowSleep&&g.type===m.DYNAMIC&&g.sleepState===m.SLEEPING&&b.sleepState===m.AWAKE&&b.type!==m.STATIC){var z=f.squaredLength(b.velocity)+Math.pow(b.angularVelocity,2),A=Math.pow(b.sleepSpeedLimit,2);z>=2*A&&(g._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(b,c,g,h),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(c,h)){var B=this.beginContactEvent;if(B.shapeA=c,B.shapeB=h,B.bodyA=b,B.bodyB=g,B.contactEquations.length=0,"number"==typeof r)for(var C=a.contactEquations.length-r;C<a.contactEquations.length;C++)B.contactEquations.push(a.contactEquations[C]);this.emit(B)}if("number"==typeof r&&u>1)for(var C=a.frictionEquations.length-u;C<a.frictionEquations.length;C++){var D=a.frictionEquations[C];D.setSlipForce(D.getSlipForce()/u)}}}}},d.prototype.addSpring=function(a){this.springs.push(a);var b=this.addSpringEvent;b.spring=a,this.emit(b),b.spring=null},d.prototype.removeSpring=function(a){var b=this.springs.indexOf(a);-1!==b&&s.splice(this.springs,b,1)},d.prototype.addBody=function(a){if(-1===this.bodies.indexOf(a)){this.bodies.push(a),a.world=this;var b=this.addBodyEvent;b.body=a,this.emit(b),b.body=null}},d.prototype.removeBody=function(a){if(this.stepping)this.bodiesToBeRemoved.push(a);else{a.world=null;var b=this.bodies.indexOf(a);-1!==b&&(s.splice(this.bodies,b,1),this.removeBodyEvent.body=a,a.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},d.prototype.getBodyById=function(a){for(var b=this.bodies,c=0;c<b.length;c++){var d=b[c];if(d.id===a)return d}return!1},d.prototype.disableBodyCollision=function(a,b){this.disabledBodyCollisionPairs.push(a,b)},d.prototype.enableBodyCollision=function(a,b){for(var c=this.disabledBodyCollisionPairs,d=0;d<c.length;d+=2)if(c[d]===a&&c[d+1]===b||c[d+1]===a&&c[d]===b)return void c.splice(d,2)},d.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var a=this.constraints,b=a.length-1;b>=0;b--)this.removeConstraint(a[b]);for(var c=this.bodies,b=c.length-1;b>=0;b--)this.removeBody(c[b]);for(var e=this.springs,b=e.length-1;b>=0;b--)this.removeSpring(e[b]);for(var f=this.contactMaterials,b=f.length-1;b>=0;b--)this.removeContactMaterial(f[b]);d.apply(this)};var z=f.create(),A=(f.fromValues(0,0),f.fromValues(0,0));d.prototype.hitTest=function(a,b,c){c=c||0;var d=new m({position:a}),e=new k,l=a,n=0,o=z,p=A;d.addShape(e);for(var q=this.narrowphase,r=[],s=0,t=b.length;s!==t;s++)for(var u=b[s],v=0,w=u.shapes.length;v!==w;v++){var x=u.shapes[v];f.rotate(o,x.position,u.angle),f.add(o,o,u.position);var y=x.angle+u.angle;(x instanceof g&&q.circleParticle(u,x,o,y,d,e,l,n,!0)||x instanceof h&&q.particleConvex(d,e,l,n,u,x,o,y,!0)||x instanceof i&&q.particlePlane(d,e,l,n,u,x,o,y,!0)||x instanceof j&&q.particleCapsule(d,e,l,n,u,x,o,y,!0)||x instanceof k&&f.squaredLength(f.sub(p,o,a))<c*c)&&r.push(u)}return r},d.prototype.setGlobalStiffness=function(a){for(var b=this.constraints,c=0;c!==b.length;c++)for(var d=b[c],e=0;e!==d.equations.length;e++){var f=d.equations[e];f.stiffness=a,f.needsUpdate=!0}for(var g=this.contactMaterials,c=0;c!==g.length;c++){var d=g[c];d.stiffness=d.frictionStiffness=a}var d=this.defaultContactMaterial;d.stiffness=d.frictionStiffness=a},d.prototype.setGlobalRelaxation=function(a){for(var b=0;b!==this.constraints.length;b++)for(var c=this.constraints[b],d=0;d!==c.equations.length;d++){var e=c.equations[d];e.relaxation=a,e.needsUpdate=!0}for(var b=0;b!==this.contactMaterials.length;b++){var c=this.contactMaterials[b];c.relaxation=c.frictionRelaxation=a}var c=this.defaultContactMaterial;c.relaxation=c.frictionRelaxation=a};var B=new p,C=[];d.prototype.raycast=function(a,b){return b.getAABB(B),this.broadphase.aabbQuery(this,B,C),b.intersectBodies(a,C),C.length=0,a.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)});

var P2World=pc.createScript("p2World");P2World.attributes.add("gravity",{type:"vec2",default:[0,-9.8],title:"Gravity",description:"Gravity to use when approximating the friction max force.",placeholder:["X","Y"]}),P2World.attributes.add("axes",{type:"number",enum:[{XY:1},{XZ:2},{YZ:3}],default:1,title:"Axes",description:"The axes on which the simulation is run."}),P2World.attributes.add("defaultFriction",{type:"number",default:.3,title:"Default Friction",description:"The default global friction."}),P2World.attributes.add("maxSubSteps",{type:"number",default:10,title:"Max Substeps",description:"Maximum number of fixed steps to take when stepping the simulation."}),P2World.attributes.add("solverIterations",{type:"number",default:10,title:"Solver Iterations",description:"The maximum number of iterations to do when solving. More gives better results, but is more expensive."}),P2World.attributes.add("solverTolerance",{type:"number",default:0,title:"Solver Tolerance",description:"The error tolerance, per constraint. If the total error is below this limit, the solver will stop iterating. Set to zero for as good solution as possible, but to something larger than zero to make computations faster."}),P2World.attributes.add("sleepMode",{type:"number",enum:[{"No Sleeping":0},{"Body Sleeping":1},{"Island Sleeping":2}],default:0,title:"Sleep Mode",description:'How to deactivate bodies during simulation. Possible modes are: "No Sleeping", "Body Sleeping" and "Island Sleeping". If sleeping is enabled, you might need to wake up the bodies if they fall asleep. If you want to enable sleeping in the world, but want to disable it for a particular body, see p2Body.allowSleep.'}),P2World.attributes.add("islandSplit",{type:"boolean",default:!0,title:"Island Split",description:"Whether to enable island splitting. Island splitting can be an advantage for both precision and performance."}),P2World.attributes.add("debugDraw",{type:"boolean",default:!1,title:"Debug Draw",description:"Render a visual representation of the physics world in the running app."}),P2World.prototype.initialize=function(){var t=[p2.World.NO_SLEEPING,p2.World.BODY_SLEEPING,p2.World.ISLAND_SLEEPING],i=new p2.World({gravity:[this.gravity.x,this.gravity.y],islandSplit:this.islandSplit});i.sleepMode=t[this.sleepMode],i.solver.iterations=this.solverIterations,i.solver.tolerance=this.solverTolerance,i.defaultContactMaterial.friction=this.defaultFriction,this.on("attr:defaultFriction",(function(t,e){i.defaultContactMaterial.friction=t})),this.on("attr:gravity",(function(t,e){i.gravity[0]=t.x,i.gravity[1]=t.y})),this.on("attr:islandSplit",(function(t,e){i.islandSplit=t})),this.on("attr:sleepMode",(function(e,o){i.sleepMode=t[e]})),this.on("attr:solverIterations",(function(t,e){i.solver.iterations=Math.round(t)})),this.on("attr:solverTolerance",(function(t,e){i.solver.tolerance=t}));var e=this;this.app.on("p2:getPosition",(function(t,i){var o=t.getPosition();switch(e.axes){case 1:[o.x,o.y];break;case 2:[o.x,-o.z];break;case 3:[-o.z,o.y]}})),this.app.on("p2:addBody",(function(t){var o=t.entity.getPosition();switch(e.axes){case 1:t.position=[o.x,o.y];break;case 2:t.position=[o.x,-o.z];break;case 3:t.position=[-o.z,o.y]}i.addBody(t)})),this.app.on("p2:removeBody",(function(t){i.removeBody(t)})),i.on("postStep",(function(t){e.app.fire("p2:postStep")})),this.world=i},P2World.prototype.postUpdate=function(t){var i,e,o,n,s,a,r,l,h;for(s=(n=this.world.bodies).length,this.world.step(1/60,t,this.maxSubSteps),i=0;i<s;i++)if((o=n[i]).type===p2.Body.DYNAMIC||o.type===p2.Body.KINEMATIC)switch(h=(l=o.entity).getPosition(),this.axes){case 1:l.setPosition(o.position[0],o.position[1],h.z),l.setEulerAngles(0,0,o.angle/Math.PI*180);break;case 2:l.setPosition(o.position[0],h.y,-o.position[1]),l.setEulerAngles(0,o.angle/Math.PI*180,0);break;case 3:l.setPosition(h.x,o.position[0],-o.position[1]),l.setEulerAngles(o.angle/Math.PI*180,0,0)}if(this.debugDraw)for(i=0;i<s;i++)for(r=(a=(o=n[i]).shapes).length,e=0;e<r;e++)a[e]};var P2Material=pc.createScript("p2Material");P2Material.attributes.add("friction",{type:"number",default:.55,min:0,max:1,title:"Friction",description:"The friction coefficient for this material."}),P2Material.attributes.add("restitution",{type:"number",default:.55,min:0,max:1,title:"Restitution",description:"The restitution for this material, defining its bounciness."}),P2Material.attributes.add("surfaceVelocity",{type:"number",default:0,title:"Surface Velocity",description:""}),P2Material.materialDefs=[],P2Material.prototype.updateMaterial=function(){var t,i,e;for((e=P2Material.materialDefs).length,t=0;t<numMaterials;t++)if((i=e[t]).friction===this.friction&&i.restitution===this.restitution)return void(this.material=i.material);e.push({})},P2Material.prototype.initialize=function(){this.on("attr",(function(t,i,e){this.updateMaterial()}))};var P2Box=pc.createScript("p2Box");P2Box.attributes.add("width",{type:"number",default:1,title:"Width",description:"Total width of the box."}),P2Box.attributes.add("height",{type:"number",default:1,title:"Height",description:"Total height of the box."}),P2Box.attributes.add("angle",{type:"number",default:0,title:"Angle",description:"Body-local angle of the shape in degrees.",placeholder:"degrees"}),P2Box.attributes.add("position",{type:"vec2",default:[0,0],title:"Position",description:"Body-local position of the shape.",placeholder:["X","Y"]}),P2Box.attributes.add("collisionGroup",{type:"string",default:"00000001",title:"Collision Group",description:"Collision group that this shape belongs to (bit mask)."}),P2Box.attributes.add("collisionMask",{type:"string",default:"00000001",title:"Collision Mask",description:"Collision mask of this shape. See collisionGroup."}),P2Box.attributes.add("sensor",{type:"boolean",default:!1,title:"Sensor",description:"Set to true if you want this shape to be a sensor. A sensor does not generate contacts, but it still reports contact events. This is good if you want to know if a shape is overlapping another shape, without them generating contacts."}),P2Box.prototype.initialize=function(){if(this.shape=new p2.Box({angle:this.angle,collisionGroup:parseInt(this.collisionGroup,2),collisionMask:parseInt(this.collisionMask,2),height:this.height,position:[this.position.x,this.position.y],sensor:this.sensor,width:this.width}),this.on("attr:angle",(function(t,i){this.shape.angle=t*Math.PI/180})),this.on("attr:collisionGroup",(function(t,i){this.shape.collisionGroup=parseInt(t,2)})),this.on("attr:collisionMask",(function(t,i){this.shape.collisionMask=parseInt(t,2)})),this.on("attr:height",(function(t,i){this.shape.height=t})),this.on("attr:position",(function(t,i){this.shape.position[0]=t.x,this.shape.position[1]=t.y})),this.on("attr:sensor",(function(t,i){this.shape.sensor=t})),this.on("attr:width",(function(t,i){this.shape.width=t})),this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}this.on("enable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}})),this.on("disable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.removeShape(this.shape)}}))};var P2Circle=pc.createScript("p2Circle");P2Circle.attributes.add("radius",{type:"number",default:1,title:"Radius",description:"Radius of the circle."}),P2Circle.attributes.add("angle",{type:"number",default:0,title:"Angle",description:"Body-local angle of the shape in degrees.",placeholder:"degrees"}),P2Circle.attributes.add("position",{type:"vec2",default:[0,0],title:"Position",description:"Body-local position of the shape.",placeholder:["X","Y"]}),P2Circle.attributes.add("collisionGroup",{type:"string",default:"00000001",title:"Collision Group",description:"Collision group that this shape belongs to (bit mask)."}),P2Circle.attributes.add("collisionMask",{type:"string",default:"00000001",title:"Collision Mask",description:"Collision mask of this shape. See .collisionGroup."}),P2Circle.attributes.add("sensor",{type:"boolean",default:!1,title:"Sensor",description:"Set to true if you want this shape to be a sensor. A sensor does not generate contacts, but it still reports contact events. This is good if you want to know if a shape is overlapping another shape, without them generating contacts."}),P2Circle.prototype.initialize=function(){if(this.shape=new p2.Circle({angle:this.angle,collisionGroup:parseInt(this.collisionGroup,2),collisionMask:parseInt(this.collisionMask,2),position:[this.position.x,this.position.y],radius:this.radius,sensor:this.sensor}),this.on("attr:angle",(function(t,i){this.shape.angle=t*Math.PI/180})),this.on("attr:collisionGroup",(function(t,i){this.shape.collisionGroup=parseInt(t,2)})),this.on("attr:collisionMask",(function(t,i){this.shape.collisionMask=parseInt(t,2)})),this.on("attr:position",(function(t,i){this.shape.position[0]=t.x,this.shape.position[1]=t.y})),this.on("attr:radius",(function(t,i){this.shape.radius=t})),this.on("attr:sensor",(function(t,i){this.shape.sensor=t})),null!==this.shape.body&&this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}this.on("enable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}})),this.on("disable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.removeShape(this.shape)}}))};var P2Capsule=pc.createScript("p2Capsule");P2Capsule.attributes.add("radius",{type:"number",default:1,title:"Radius",description:"The radius of the capsule."}),P2Capsule.attributes.add("length",{type:"number",default:1,title:"Length",description:"The distance between the end points."}),P2Capsule.attributes.add("angle",{type:"number",default:0,title:"Angle",description:"Body-local angle of the shape in degrees.",placeholder:"degrees"}),P2Capsule.attributes.add("position",{type:"vec2",default:[0,0],title:"Position",description:"Body-local position of the shape.",placeholder:["X","Y"]}),P2Capsule.attributes.add("collisionGroup",{type:"string",default:"00000001",title:"Collision Group",description:"Collision group that this shape belongs to (bit mask)."}),P2Capsule.attributes.add("collisionMask",{type:"string",default:"00000001",title:"Collision Mask",description:"Collision mask of this shape. See .collisionGroup."}),P2Capsule.attributes.add("sensor",{type:"boolean",default:!1,title:"Sensor",description:"Set to true if you want this shape to be a sensor. A sensor does not generate contacts, but it still reports contact events. This is good if you want to know if a shape is overlapping another shape, without them generating contacts."}),P2Capsule.prototype.initialize=function(){if(this.shape=new p2.Capsule({angle:this.angle,collisionGroup:parseInt(this.collisionGroup,2),collisionMask:parseInt(this.collisionMask,2),length:this.length,position:[this.position.x,this.position.y],radius:this.radius,sensor:this.sensor}),this.on("attr:angle",(function(t,i){this.shape.angle=t*Math.PI/180})),this.on("attr:collisionGroup",(function(t,i){this.shape.collisionGroup=parseInt(t,2)})),this.on("attr:collisionMask",(function(t,i){this.shape.collisionMask=parseInt(t,2)})),this.on("attr:length",(function(t,i){this.shape.length=t})),this.on("attr:position",(function(t,i){this.shape.position[0]=t.x,this.shape.position[1]=t.y})),this.on("attr:radius",(function(t,i){this.shape.radius=t})),this.on("attr:sensor",(function(t,i){this.shape.sensor=t})),null!==this.shape.body&&this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}this.on("enable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}})),this.on("disable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.removeShape(this.shape)}}))};var P2Plane=pc.createScript("p2Plane");P2Plane.attributes.add("angle",{type:"number",default:0,title:"Angle",description:"Body-local angle of the shape in degrees.",placeholder:"degrees"}),P2Plane.attributes.add("position",{type:"vec2",default:[0,0],title:"Position",description:"Body-local position of the shape.",placeholder:["X","Y"]}),P2Plane.attributes.add("collisionGroup",{type:"string",default:"00000001",title:"Collision Group",description:"Collision group that this shape belongs to (bit mask)."}),P2Plane.attributes.add("collisionMask",{type:"string",default:"00000001",title:"Collision Mask",description:"Collision mask of this shape. See .collisionGroup."}),P2Plane.attributes.add("sensor",{type:"boolean",default:!1,title:"Sensor",description:"Set to true if you want this shape to be a sensor. A sensor does not generate contacts, but it still reports contact events. This is good if you want to know if a shape is overlapping another shape, without them generating contacts."}),P2Plane.prototype.initialize=function(){if(this.shape=new p2.Plane({angle:this.angle,collisionGroup:parseInt(this.collisionGroup,2),collisionMask:parseInt(this.collisionMask,2),position:[this.position.x,this.position.y],sensor:this.sensor}),this.on("attr:angle",(function(t,i){this.shape.angle=t*Math.PI/180})),this.on("attr:collisionGroup",(function(t,i){this.shape.collisionGroup=parseInt(t,2)})),this.on("attr:collisionMask",(function(t,i){this.shape.collisionMask=parseInt(t,2)})),this.on("attr:position",(function(t,i){this.shape.position[0]=t.x,this.shape.position[1]=t.y})),this.on("attr:sensor",(function(t,i){this.shape.sensor=t})),this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}this.on("enable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}})),this.on("disable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.removeShape(this.shape)}}))};var P2Body=pc.createScript("p2Body");P2Body.attributes.add("type",{type:"number",enum:[{Static:0},{Dynamic:1},{Kinematic:2}],default:1,title:"Type",description:"The type of motion this body has. Should be one of: 0 (Static), 1 (Dynamic) and 2 (Kinematic). Static bodies do not move, and they do not respond to forces or collision. Dynamic bodies body can move and respond to collisions and forces. Kinematic bodies only moves according to its velocity, and does not respond to collisions or force."}),P2Body.attributes.add("mass",{type:"number",default:1,title:"Mass",description:"The mass of the body."}),P2Body.attributes.add("velocity",{type:"vec2",default:[0,0],title:"Velocity",description:"The current velocity of the body.",placeholder:["X","Y"]}),P2Body.attributes.add("angularVelocity",{type:"number",default:0,title:"Angular Velocity",description:"The angular velocity of the body, in degrees per second.",placeholder:"degrees/s"}),P2Body.attributes.add("damping",{type:"number",default:.1,min:0,max:1,title:"Damping",description:"The linear damping acting on the body in the velocity direction. Should be a value between 0 and 1."}),P2Body.attributes.add("angularDamping",{type:"number",min:0,max:1,default:.1,title:"Angular Damping",description:"The angular damping acting on the body. Should be a value between 0 and 1."}),P2Body.attributes.add("gravityScale",{type:"number",default:1,title:"Gravity Scale",description:"Gravity scaling factor. If you want the body to ignore gravity, set this to zero. If you want to reverse gravity, set it to -1."}),P2Body.attributes.add("fixedX",{type:"boolean",default:!1,title:"Fixed X",description:"Set to true if you want to fix the body movement along the X axis. The body will still be able to move along Y."}),P2Body.attributes.add("fixedY",{type:"boolean",default:!1,title:"Fixed Y",description:"Set to true if you want to fix the body movement along the Y axis. The body will still be able to move along X."}),P2Body.attributes.add("fixedRotation",{type:"boolean",default:!1,title:"Fixed Rotation",description:"Set to true if you want to fix the rotation of the body."}),P2Body.attributes.add("allowSleep",{type:"boolean",default:!0,title:"Allow Sleep",description:"If true, the body will automatically fall to sleep. Note that you need to enable sleeping in the p2World before anything will happen."}),P2Body.attributes.add("sleepSpeedLimit",{type:"number",default:.2,title:"Sleep Speed Limit",description:"If the speed (the norm of the velocity) is smaller than this value, the body is considered sleepy."}),P2Body.attributes.add("sleepTimeLimit",{type:"number",default:1,title:"Sleep Time Limit",description:"If the body has been sleepy for this sleepTimeLimit seconds, it is considered sleeping.",placeholder:"seconds"}),P2Body.attributes.add("collisionResponse",{type:"boolean",default:!0,title:"Collision Response",description:"Whether to produce contact forces when in contact with other bodies. Note that contacts will be generated, but they will be disabled. That means that this body will move through other bodies, but it will still trigger contact events, etc."}),Object.defineProperty(P2Body.prototype,"angularForce",{get:function(){return this.body?this.body.angularForce:0},set:function(t){this.body.angularForce=t}}),P2Body.prototype.postInitialize=function(){var t=[p2.Body.STATIC,p2.Body.DYNAMIC,p2.Body.KINEMATIC];this.app.fire("p2:getPosition",this.entity,[0,0]);var i,e=t[this.type];this.body=new p2.Body({allowSleep:this.allowSleep,angularVelocity:this.angularVelocity,angle:0,collisionResponse:this.collisionResponse,gravityScale:this.gravityScale,mass:e===p2.Body.STATIC?0:this.mass,type:e,velocity:[this.velocity.x,this.velocity.y]}),this.body.fixedX=this.fixedX,this.body.fixedY=this.fixedY,this.body.fixedRotation=this.fixedRotation,this.body.entity=this.entity,this.on("attr:allowSleep",(function(t,i){this.body.allowSleep=t})),this.on("attr:angularDamping",(function(t,i){this.body.angularDamping=t})),this.on("attr:collisionResponse",(function(t,i){this.body.collisionResponse=t})),this.on("attr:damping",(function(t,i){this.body.damping=t})),this.on("attr:fixedX",(function(t,i){this.body.fixedX=t})),this.on("attr:fixedY",(function(t,i){this.body.fixedY=t})),this.on("attr:fixedRotation",(function(t,i){this.body.fixedRotation=t})),this.on("attr:gravityScale",(function(t,i){this.body.gravityScale=t})),this.on("attr:mass",(function(t,i){this.body.mass=t,this.body.updateMassProperties()})),this.on("attr:type",(function(i,e){this.body.type=t[i]})),this.entity.script.p2Box&&(i=this.entity.script.p2Box.shape),this.entity.script.p2Capsule&&(i=this.entity.script.p2Capsule.shape),this.entity.script.p2Circle&&(i=this.entity.script.p2Circle.shape),this.entity.script.p2Plane&&(i=this.entity.script.p2Plane.shape),i&&this.body.addShape(i),this.app.fire("p2:addBody",this.body),this.on("enable",(function(){this.app.fire("p2:addBody",this.body)})),this.on("disable",(function(){this.app.fire("p2:removeBody",this.body)})),this.entity.fire("p2:newBody",this.body)};var P2DistanceConstraint=pc.createScript("p2DistanceConstraint");P2DistanceConstraint.attributes.add("entityA",{type:"entity",title:"Entity A",description:"First entity with body participating in the constraint."}),P2DistanceConstraint.attributes.add("localAnchorA",{type:"vec2",default:[0,0],title:"Local Anchor A",description:"Local anchor in body A specified in local body coordinates.",placeholder:["X","Y"]}),P2DistanceConstraint.attributes.add("entityB",{type:"entity",title:"Entity B",description:"Second entity with body participating in the constraint."}),P2DistanceConstraint.attributes.add("localAnchorB",{type:"vec2",default:[0,0],title:"Local Anchor B",description:"Local anchor in body B specified in local body coordinates.",placeholder:["X","Y"]}),P2DistanceConstraint.attributes.add("collideConnected",{type:"boolean",default:!0,title:"Collide Connected",description:"Set to true if you want the connected bodies to collide."}),P2DistanceConstraint.attributes.add("stiffness",{type:"number",default:1e6,title:"Stiffness",description:"Set stiffness for this constraint."}),P2DistanceConstraint.attributes.add("relaxation",{type:"number",default:4,title:"Relaxation",description:"Set relaxation for this constraint."}),P2DistanceConstraint.prototype.createConstraint=function(){this.constraint&&this.bodyA.world.removeConstraint(this.constraint),this.constraint=new p2.DistanceConstraint(this.bodyA,this.bodyB,{collideConnected:this.collideConnected,localAnchorA:[this.localAnchorA.x,this.localAnchorA.y],localAnchorB:[this.localAnchorB.x,this.localAnchorB.y]}),this.constraint.setStiffness(this.stiffness),this.constraint.setRelaxation(this.relaxation),this.bodyA.world.addConstraint(this.constraint)},P2DistanceConstraint.prototype.postInitialize=function(){this.bodyA=null,this.bodyB=null,this.entityA&&this.entityA.script&&this.entityA.script.p2Body&&(this.bodyA=this.entityA.script.p2Body.body),this.entityB&&this.entityB.script&&this.entityB.script.p2Body&&(this.bodyB=this.entityB.script.p2Body.body),this.bodyA&&this.bodyB&&this.createConstraint();var t=this;this.entityA&&this.entityA.on("p2:newBody",(function(i){t.bodyA=i,t.bodyB&&t.createConstraint()})),this.entityB&&this.entityB.on("p2:newBody",(function(i){t.bodyB=i,t.bodyA&&t.createConstraint()})),this.on("attr:entityA",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyA=t,this.bodyB&&this.createConstraint()}))})),this.on("attr:entityB",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyB=t,this.bodyA&&this.createConstraint()}))})),this.on("attr:localAnchorA",(function(t,i){this.constraint&&(this.constraint.localAnchorA[0]=t.x,this.constraint.localAnchorA[1]=t.y)})),this.on("attr:localAnchorB",(function(t,i){this.constraint&&(this.constraint.localAnchorB[0]=t.x,this.constraint.localAnchorB[1]=t.y)})),this.on("attr:relaxation",(function(t,i){this.constraint&&this.constraint.setRelaxation(t)})),this.on("attr:stiffness",(function(t,i){this.constraint&&this.constraint.setStiffness(t)}))};var P2PrismaticConstraint=pc.createScript("p2PrismaticConstraint");P2PrismaticConstraint.attributes.add("entityA",{type:"entity",title:"Entity A",description:"First entity with body participating in the constraint."}),P2PrismaticConstraint.attributes.add("localAnchorA",{type:"vec2",default:[0,0],title:"Local Anchor A",description:"Local anchor in body A specified in local body coordinates.",placeholder:["X","Y"]}),P2PrismaticConstraint.attributes.add("entityB",{type:"entity",title:"Entity B",description:"Second entity with body participating in the constraint."}),P2PrismaticConstraint.attributes.add("localAnchorB",{type:"vec2",default:[0,0],title:"Local Anchor B",description:"Local anchor in body B specified in local body coordinates.",placeholder:["X","Y"]}),P2PrismaticConstraint.attributes.add("localAxisA",{type:"vec2",default:[1,0],title:"Local Axis A",description:"An axis, defined in body A frame, that body B's anchor point may slide along.",placeholder:["X","Y"]}),P2PrismaticConstraint.attributes.add("disableRotationalLock",{type:"boolean",default:!1,title:"Disable Rotational Lock",description:"If set to true, body of entityB will be free to rotate around its anchor point."}),P2PrismaticConstraint.attributes.add("collideConnected",{type:"boolean",default:!0,title:"Collide Connected",description:"Set to true if you want the connected bodies to collide."}),P2PrismaticConstraint.attributes.add("stiffness",{type:"number",default:1e6,title:"Stiffness",description:"Set stiffness for this constraint."}),P2PrismaticConstraint.attributes.add("relaxation",{type:"number",default:4,title:"Relaxation",description:"Set relaxation for this constraint."}),P2PrismaticConstraint.prototype.createConstraint=function(){this.constraint&&this.bodyA.world.removeConstraint(this.constraint),this.constraint=new p2.PrismaticConstraint(this.bodyA,this.bodyB,{collideConnected:this.collideConnected,disableRotationalLock:this.disableRotationalLock,localAnchorA:[this.localAnchorA.x,this.localAnchorA.y],localAnchorB:[this.localAnchorB.x,this.localAnchorB.y],localAxisA:[this.localAxisA.x,this.localAxisA.y]}),this.constraint.setStiffness(this.stiffness),this.constraint.setRelaxation(this.relaxation),this.bodyA.world.addConstraint(this.constraint)},P2PrismaticConstraint.prototype.postInitialize=function(){this.bodyA=null,this.bodyB=null,this.entityA&&this.entityA.script&&this.entityA.script.p2Body&&(this.bodyA=this.entityA.script.p2Body.body),this.entityB&&this.entityB.script&&this.entityB.script.p2Body&&(this.bodyB=this.entityB.script.p2Body.body),this.bodyA&&this.bodyB&&this.createConstraint();var t=this;this.entityA&&this.entityA.on("p2:newBody",(function(i){t.bodyA=i,t.bodyB&&t.createConstraint()})),this.entityB&&this.entityB.on("p2:newBody",(function(i){t.bodyB=i,t.bodyA&&t.createConstraint()})),this.on("attr:entityA",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyA=t,this.bodyB&&this.createConstraint()}))})),this.on("attr:entityB",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyB=t,this.bodyA&&this.createConstraint()}))})),this.on("attr:localAnchorA",(function(t,i){this.constraint&&(this.constraint.localAnchorA[0]=t.x,this.constraint.localAnchorA[1]=t.y)})),this.on("attr:localAnchorB",(function(t,i){this.constraint&&(this.constraint.localAnchorB[0]=t.x,this.constraint.localAnchorB[1]=t.y)})),this.on("attr:localAxisA",(function(t,i){this.constraint&&(this.constraint.localAxisA[0]=t.x,this.constraint.localAxisA[1]=t.y)})),this.on("attr:relaxation",(function(t,i){this.constraint&&this.constraint.setRelaxation(t)})),this.on("attr:stiffness",(function(t,i){this.constraint&&this.constraint.setStiffness(t)}))};var P2RevoluteConstraint=pc.createScript("p2RevoluteConstraint");P2RevoluteConstraint.attributes.add("entityA",{type:"entity",title:"Entity A",description:"First entity with body participating in the constraint."}),P2RevoluteConstraint.attributes.add("localPivotA",{type:"vec2",default:[0,0],title:"Local Pivot A",description:"Local pivot in body A specified in local body coordinates.",placeholder:["X","Y"]}),P2RevoluteConstraint.attributes.add("entityB",{type:"entity",title:"Entity B",description:"Second entity with body participating in the constraint."}),P2RevoluteConstraint.attributes.add("localPivotB",{type:"vec2",default:[0,0],title:"Local Pivot B",description:"Local pivot in body B specified in local body coordinates.",placeholder:["X","Y"]}),P2RevoluteConstraint.attributes.add("collideConnected",{type:"boolean",default:!0,title:"Collide Connected",description:"Set to true if you want the connected bodies to collide."}),P2RevoluteConstraint.attributes.add("stiffness",{type:"number",default:1e6,title:"Stiffness",description:"Set stiffness for this constraint."}),P2RevoluteConstraint.attributes.add("relaxation",{type:"number",default:4,title:"Relaxation",description:"Set relaxation for this constraint."}),P2RevoluteConstraint.attributes.add("limitsEnabled",{type:"boolean",default:!1,title:"Limits Enabled",description:"Enable constraint angle limits."}),P2RevoluteConstraint.attributes.add("limits",{type:"vec2",default:[0,0],title:"Limits",description:"Set the constraint angle limits.",placeholder:["lower","upper"]}),P2RevoluteConstraint.attributes.add("motorEnabled",{type:"boolean",default:!1,title:"Motor Enabled",description:"Enable the rotational motor."}),P2RevoluteConstraint.attributes.add("motorSpeed",{type:"number",default:0,title:"Motor Speed",description:"Set the speed of the rotational constraint motor."}),P2RevoluteConstraint.prototype.createConstraint=function(){this.constraint&&this.bodyA.world.removeConstraint(this.constraint),this.constraint=new p2.RevoluteConstraint(this.bodyA,this.bodyB,{collideConnected:this.collideConnected,localPivotA:[this.localPivotA.x,this.localPivotA.y],localPivotB:[this.localPivotB.x,this.localPivotB.y]}),this.constraint.limitsEnabled&&this.constraint.setLimits(this.limits.x*Math.PI/180,this.limits.y*Math.PI/180),this.constraint.setStiffness(this.stiffness),this.constraint.setRelaxation(this.relaxation),this.motorEnabled?this.constraint.enableMotor():this.constraint.disableMotor(),this.constraint.setMotorSpeed(this.motorSpeed),this.bodyA.world.addConstraint(this.constraint)},P2RevoluteConstraint.prototype.postInitialize=function(){this.bodyA=null,this.bodyB=null,this.entityA&&this.entityA.script&&this.entityA.script.p2Body&&(this.bodyA=this.entityA.script.p2Body.body),this.entityB&&this.entityB.script&&this.entityB.script.p2Body&&(this.bodyB=this.entityB.script.p2Body.body),this.bodyA&&this.bodyB&&this.createConstraint();var t=this;this.entityA&&this.entityA.on("p2:newBody",(function(i){t.bodyA=i,t.bodyB&&t.createConstraint()})),this.entityB&&this.entityB.on("p2:newBody",(function(i){t.bodyB=i,t.bodyA&&t.createConstraint()})),this.on("attr:entityA",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyA=t,this.bodyB&&this.createConstraint()}))})),this.on("attr:entityB",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyB=t,this.bodyA&&this.createConstraint()}))})),this.on("attr:limits",(function(t,i){this.constraint&&this.constraint.limitsEnabled&&this.constraint.setLimits(this.limits.x*Math.PI/180,this.limits.y*Math.PI/180)})),this.on("attr:limitsEnabled",(function(t,i){this.constraint&&(t?this.constraint.setLimits(this.limits.x*Math.PI/180,this.limits.y*Math.PI/180):(this.constraint.lowerlimitEnabled=!1,this.constraint.upperlimitEnabled=!1))})),this.on("attr:lowerLimitEnabled",(function(t,i){this.constraint&&(this.constraint.lowerLimitEnabled=t)})),this.on("attr:localPivotA",(function(t,i){this.constraint&&(this.constraint.localPivotA[0]=t.x,this.constraint.localPivotA[1]=t.y)})),this.on("attr:localPivotB",(function(t,i){this.constraint&&(this.constraint.localPivotB[0]=t.x,this.constraint.localPivotB[1]=t.y)})),this.on("attr:motorEnabled",(function(t,i){this.constraint&&(t?this.constraint.enableMotor():this.constraint.disableMotor())})),this.on("attr:motorSpeed",(function(t,i){this.constraint&&this.constraint.setMotorSpeed(t)})),this.on("attr:relaxation",(function(t,i){this.constraint&&this.constraint.setRelaxation(t)})),this.on("attr:stiffness",(function(t,i){this.constraint&&this.constraint.setStiffness(t)})),this.on("attr:upperLimit",(function(t,i){this.constraint&&(this.constraint.upperLimit=t)})),this.on("attr:upperLimitEnabled",(function(t,i){this.constraint&&(this.constraint.upperLimitEnabled=t)}))};var P2LinearSpring=pc.createScript("p2LinearSpring");P2LinearSpring.attributes.add("entityA",{type:"entity",title:"Entity A",description:"First connected entity."}),P2LinearSpring.attributes.add("anchorA",{type:"vec2",default:[0,0],title:"Anchor A",description:"Where to hook the spring to body A, in local body coordinates or world space coordinates. Defaults to the body center in local space.",placeholder:["X","Y"]}),P2LinearSpring.attributes.add("anchorASpace",{type:"number",enum:[{Local:0},{World:1}],default:0,title:"Anchor A Space",description:"The coordinate space for anchor A. Can be local body space or world space."}),P2LinearSpring.attributes.add("entityB",{type:"entity",title:"Entity B",description:"Second connected entity."}),P2LinearSpring.attributes.add("anchorB",{type:"vec2",default:[0,0],title:"Anchor B",description:"Where to hook the spring to body B, in local body coordinates or world space coordinates. Defaults to the body center in local space.",placeholder:["X","Y"]}),P2LinearSpring.attributes.add("anchorBSpace",{type:"number",enum:[{Local:0},{World:1}],default:0,title:"Anchor B Space",description:"The coordinate space for anchor B. Can be local body space or world space."}),P2LinearSpring.attributes.add("restLength",{type:"number",default:0,title:"Rest Length",description:"Rest length of the spring."}),P2LinearSpring.attributes.add("stiffness",{type:"number",default:100,title:"Stiffness",description:"Stiffness of the spring. See Hookes Law."}),P2LinearSpring.attributes.add("damping",{type:"number",default:1,title:"Damping",description:"Damping of the spring."}),P2LinearSpring.prototype.createSpring=function(){this.spring&&this.bodyA.world.removeSpring(this.spring);var t={damping:this.damping,stiffness:this.stiffness};0===this.anchorASpace?t.localAnchorA=[this.anchorA.x,this.anchorA.y]:t.worldAnchorA=[this.anchorA.x,this.anchorA.y],0===this.anchorBSpace?t.localAnchorB=[this.anchorB.x,this.anchorB.y]:t.worldAnchorB=[this.anchorB.x,this.anchorB.y],this.restLength>0&&(t.restLength=this.restLength),this.spring=new p2.LinearSpring(this.bodyA,this.bodyB,t),this.bodyA.world.addSpring(this.spring)},P2LinearSpring.prototype.postInitialize=function(){this.bodyA=null,this.bodyB=null,this.entityA&&this.entityA.script&&this.entityA.script.p2Body&&(this.bodyA=this.entityA.script.p2Body.body),this.entityB&&this.entityB.script&&this.entityB.script.p2Body&&(this.bodyB=this.entityB.script.p2Body.body),this.bodyA&&this.bodyB&&this.createSpring();var t=this;this.entityA&&this.entityA.on("p2:newBody",(function(i){t.bodyA=i,t.bodyB&&t.createSpring()})),this.entityB&&this.entityB.on("p2:newBody",(function(i){t.bodyB=i,t.bodyA&&t.createSpring()})),this.on("attr:anchorA",(function(t,i){this.spring&&(0===this.anchorASpace?(this.spring.localAnchorA[0]=t.x,this.spring.localAnchorA[1]=t.y):(this.spring.worldAnchorA[0]=t.x,this.spring.worldAnchorA[1]=t.y))})),this.on("attr:anchorASpace",(function(t,i){this.spring&&(0===t?(this.spring.localAnchorA[0]=this.anchorA.x,this.spring.localAnchorA[1]=this.anchorA.y):(this.spring.worldAnchorA[0]=this.anchorA.x,this.spring.worldAnchorA[1]=this.anchorA.y))})),this.on("attr:anchorB",(function(t,i){this.spring&&(0===this.anchorBSpace?(this.spring.localAnchorB[0]=t.x,this.spring.localAnchorB[1]=t.y):(this.spring.worldAnchorB[0]=t.x,this.spring.worldAnchorB[1]=t.y))})),this.on("attr:anchorBSpace",(function(t,i){this.spring&&(0===t?(this.spring.localAnchorB[0]=this.anchorB.x,this.spring.localAnchorB[1]=this.anchorB.y):(this.spring.worldAnchorB[0]=this.anchorB.x,this.spring.worldAnchorB[1]=this.anchorB.y))})),this.on("attr:damping",(function(t,i){this.spring&&(this.spring.damping=t)})),this.on("attr:entityA",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyA=t,this.bodyB&&this.createSpring()}))})),this.on("attr:entityB",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyB=t,this.bodyA&&this.createSpring()}))})),this.on("attr:restLength",(function(t,i){this.spring&&(this.spring.restLength=t)})),this.on("attr:stiffness",(function(t,i){this.spring&&(this.spring.stiffness=t)}))};var P2RotationalSpring=pc.createScript("p2RotationalSpring");P2RotationalSpring.attributes.add("entityA",{type:"entity",title:"Entity A",description:"First connected entity."}),P2RotationalSpring.attributes.add("entityB",{type:"entity",title:"Entity B",description:"Second connected entity."}),P2RotationalSpring.attributes.add("stiffness",{type:"number",default:100,title:"Stiffness",description:"Stiffness of the spring. See Hookes Law."}),P2RotationalSpring.attributes.add("damping",{type:"number",default:1,title:"Damping",description:"Damping of the spring."}),P2RotationalSpring.prototype.createSpring=function(){this.spring&&this.bodyA.world.removeSpring(this.spring);var t={damping:this.damping,stiffness:this.stiffness};this.spring=new p2.RotationalSpring(this.bodyA,this.bodyB,t),this.bodyA.world.addSpring(this.spring)},P2RotationalSpring.prototype.postInitialize=function(){this.bodyA=null,this.bodyB=null,this.entityA&&this.entityA.script&&this.entityA.script.p2Body&&(this.bodyA=this.entityA.script.p2Body.body),this.entityB&&this.entityB.script&&this.entityB.script.p2Body&&(this.bodyB=this.entityB.script.p2Body.body),this.bodyA&&this.bodyB&&this.createSpring();var t=this;this.entityA&&this.entityA.on("p2:newBody",(function(i){t.bodyA=i,t.bodyB&&t.createSpring()})),this.entityB&&this.entityB.on("p2:newBody",(function(i){t.bodyB=i,t.bodyA&&t.createSpring()})),this.on("attr:damping",(function(t,i){this.spring&&(this.spring.damping=t)})),this.on("attr:entityA",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyA=t,this.bodyB&&this.createSpring()}))})),this.on("attr:entityB",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyB=t,this.bodyA&&this.createSpring()}))})),this.on("attr:stiffness",(function(t,i){this.spring&&(this.spring.stiffness=t)}))};var P2TopDownVehicle=pc.createScript("p2TopDownVehicle");P2TopDownVehicle.attributes.add("engineForce",{type:"number",default:7,title:"Engine Force",description:"The force to apply to the back wheel."}),P2TopDownVehicle.attributes.add("reverseForce",{type:"number",default:-2,title:"Reverse Force",description:"The force to apply to the back wheel when reversing."}),P2TopDownVehicle.attributes.add("brakeForce",{type:"number",default:5,title:"Brake Force",description:"The force to apply to the back wheel when braking."}),P2TopDownVehicle.attributes.add("maxSteer",{type:"number",default:45,title:"Max Steer",description:"The maximum steer angle in degrees.",placeholder:"degrees"}),P2TopDownVehicle.attributes.add("frontWheelOffset",{type:"vec2",default:[0,1],title:"Front Offset",description:"The offset in local body coordinates of the front wheel.",placeholder:["X","Y"]}),P2TopDownVehicle.attributes.add("frontWheelFriction",{type:"number",default:4,title:"Front Friction",description:"The side friction to apply to the front wheel."}),P2TopDownVehicle.attributes.add("backWheelOffset",{type:"vec2",default:[0,-1],title:"Back Offset",description:"The offset in local body coordinates of the back wheel.",placeholder:["X","Y"]}),P2TopDownVehicle.attributes.add("backWheelFriction",{type:"number",default:3,title:"Back Friction",description:"The side friction to apply to the back wheel."}),P2TopDownVehicle.prototype.createVehicle=function(){var t=this.entity.script.p2Body.body;this.vehicle&&this.vehicle.removeFromWorld(t.world),this.vehicle=new p2.TopDownVehicle(t),this.frontWheel=this.vehicle.addWheel({localPosition:[this.frontWheelOffset.x,this.frontWheelOffset.y]}),this.frontWheel.setSideFriction(this.frontWheelFriction),this.backWheel=this.vehicle.addWheel({localPosition:[this.backWheelOffset.x,this.backWheelOffset.y]}),this.backWheel.setSideFriction(this.backWheelFriction),this.vehicle.addToWorld(t.world)},P2TopDownVehicle.prototype.postInitialize=function(){this.steering=0,this.throttle=!1,this.brake=!1,this.entity.script.p2Body.body&&this.createVehicle();var t=this;this.entity.on("p2:newBody",(function(i){t.createVehicle()})),this.on("attr:frontWheelFriction",(function(t,i){this.vehicle&&this.frontWheel.setSideFriction(t)})),this.on("attr:frontWheelOffset",(function(t,i){this.vehicle&&(this.frontWheel.localPosition[0]=t.x,this.frontWheel.localPosition[1]=t.y)})),this.on("attr:backWheelFriction",(function(t,i){this.vehicle&&this.backWheel.setSideFriction(t)})),this.on("attr:backWheelOffset",(function(t,i){this.vehicle&&(this.backWheel.localPosition[0]=t.x,this.backWheel.localPosition[1]=t.y)})),this.on("enable",(function(){this.vehicle&&this.entity.script&&this.entity.script.p2Body&&this.entity.script.p2Body.body&&this.vehicle.addToWorld(this.entity.script.p2Body.body.world)})),this.on("disable",(function(){this.vehicle&&this.entity.script&&this.entity.script.p2Body&&this.entity.script.p2Body.body&&this.vehicle.removeFromWorld(this.entity.script.p2Body.body.world)}))},P2TopDownVehicle.prototype.update=function(t){this.vehicle&&(this.frontWheel.steerValue=this.steering*this.maxSteer/180*Math.PI,this.backWheel.engineForce=this.throttle?this.engineForce:0,this.backWheel.setBrakeForce(0),this.brake&&(this.backWheel.getSpeed()>.1?this.backWheel.setBrakeForce(this.brakeForce):(this.backWheel.setBrakeForce(0),this.backWheel.engineForce=this.reverseForce)))};var Character=pc.createScript("character");Character.attributes.add("speed",{type:"number",default:2}),Character.attributes.add("character_name",{type:"string",default:"Astronaut"}),Character.prototype.initialize=function(){this.character_name=window.avatar_name,this.setAvatarSprite(this.character_name),this.flag=!1},Character.prototype.update=function(t){var e=this.app;e.keyboard.isPressed(pc.KEY_A)||e.keyboard.isPressed(pc.KEY_LEFT)?(this.entity.findComponent("sprite").play("Left"),this.entity.script.p2Body.body.velocity=[-2,0]):e.keyboard.isPressed(pc.KEY_D)||e.keyboard.isPressed(pc.KEY_RIGHT)?(this.entity.findComponent("sprite").play("Right"),this.entity.script.p2Body.body.velocity=[2,0]):e.keyboard.isPressed(pc.KEY_S)||e.keyboard.isPressed(pc.KEY_DOWN)?(this.entity.findComponent("sprite").play("Down"),this.entity.script.p2Body.body.velocity=[0,-2]):e.keyboard.isPressed(pc.KEY_W)||e.keyboard.isPressed(pc.KEY_UP)?(this.entity.findComponent("sprite").play("Up"),this.entity.script.p2Body.body.velocity=[0,2]):(this.entity.findComponent("sprite").play("Idle"),this.entity.script.p2Body.body.velocity=[0,0]),this.app.keyboard.wasPressed(pc.KEY_ENTER)&&(this.app.root.findByName("chatPanel").script.ui.show(this.flag),this.flag=!this.flag)},Character.prototype.setAvatarSprite=function(t){var e=new Array("Up","Down","Left","Right","Idle");for(let r in e){var i=this.app.assets.findByTag([e[r],t]);this.entity.findComponent("sprite").removeClip(e[r]);var s=new pc.SpriteAnimationClip(this.entity.findComponent("sprite"),{name:e[r],fps:10,loop:!0,spriteAsset:i[0]});this.entity.findComponent("sprite").addClip(s)}};var Cameramove=pc.createScript("cameramove");Cameramove.attributes.add("speed",{type:"number",default:5,title:"camera move speed"}),Cameramove.prototype.initialize=function(){this.on("attr:speed",(function(e,t){this.speed=e}))},Cameramove.prototype.update=function(e){var t=this.app.root.findByTag("Owner");if(null!=t&&t.length>0){var i=t[0].getPosition(),o=this.entity.getPosition(),a=i.distance(o),n=this.speed*e/a;new_pos=new pc.Vec3,new_pos.lerp(o,i,n),new_pos.y=o.y,this.entity.setPosition(new_pos)}};var DemoLoadBalancing=function(o){function DemoLoadBalancing(){o.call(this,DemoWss?Photon.ConnectionProtocol.Wss:Photon.ConnectionProtocol.Ws,DemoAppId,DemoAppVersion),this.logger=new Exitgames.Common.Logger("Demo:"),this.output(this.logger.format("Init",this.getNameServerAddress(),DemoAppId,DemoAppVersion)),this.logger.info("Init",this.getNameServerAddress(),DemoAppId,DemoAppVersion),this.setLogLevel(Exitgames.Common.Logger.Level.DEBUG)}return __extends(DemoLoadBalancing,o),DemoLoadBalancing.prototype.start=function(){this.setupUI(),ConnectOnStart&&(DemoMasterServer?(this.setMasterServerAddress(DemoMasterServer),this.connect()):this.connectToRegionMaster(connectRegion))},DemoLoadBalancing.prototype.onError=function(o,t){this.output("Error "+o+": "+t)},DemoLoadBalancing.prototype.onStateChange=function(o){var t=Photon.LoadBalancing.LoadBalancingClient;document.getElementById("statetxt").textContent=t.StateToName(o),this.updateRoomButtons(),this.updateRoomInfo()},DemoLoadBalancing.prototype.objToStr=function(o){for(var t in o);return""},DemoLoadBalancing.prototype.updateRoomInfo=function(){var o=document.getElementById("roominfo");for(var t in o.innerHTML="room: "+this.myRoom().name+" ["+this.objToStr(this.myRoom()._customProperties)+"]",o.innerHTML=o.innerHTML+"<br>",this.myRoomActors())this.myRoomActors()[t];this.updateRoomButtons()},DemoLoadBalancing.prototype.onActorPropertiesChange=function(o){this.updateRoomInfo()},DemoLoadBalancing.prototype.onMyRoomPropertiesChange=function(){this.updateRoomInfo()},DemoLoadBalancing.prototype.onRoomListUpdate=function(o,t,e,n){this.logger.info("Demo: onRoomListUpdate",o,t,e,n),this.output("Demo: Rooms update: "+t.length+" updated, "+e.length+" added, "+n.length+" removed"),this.onRoomList(o),this.updateRoomButtons()},DemoLoadBalancing.prototype.onRoomList=function(o){for(var t=document.getElementById("gamelist");t.firstChild;)t.removeChild(t.firstChild);for(var e=0,n=0;n<o.length;++n){var a=o[n],i=document.createElement("option");i.textContent=a.name,t.appendChild(i),this.myRoom().name==a.name&&(e=n)}t.selectedIndex=e,this.output("Demo: Rooms total: "+o.length),this.updateRoomButtons()},DemoLoadBalancing.prototype.onJoinRoom=function(){this.output("Game "+this.myRoom().name+" joined"),this.updateRoomInfo()},DemoLoadBalancing.prototype.onActorJoin=function(o){this.output("actor "+o.actorNr+" joined"),this.updateRoomInfo()},DemoLoadBalancing.prototype.onActorLeave=function(o){this.output("actor "+o.actorNr+" left"),this.updateRoomInfo()},DemoLoadBalancing.prototype.sendMessage=function(o){try{this.raiseEvent(1,{message:o,senderName:"user"+this.myActor().actorNr})}catch(o){this.output("error: "+o.message)}},DemoLoadBalancing.prototype.setupUI=function(){var o=this;this.logger.info("Setting up UI."),document.getElementById("joingamebtn").onclick=function(t){if(o.isInLobby()){var e=document.getElementById("gamelist"),n=e.children[e.selectedIndex].textContent;o.output(n),o.joinRoom(n)}else o.output("Reload page to connect to Master");return!1},document.getElementById("joinrandomgamebtn").onclick=function(t){return o.isInLobby()?(o.output("Random Game..."),o.joinRandomRoom()):o.output("Reload page to connect to Master"),!1},document.getElementById("newgamebtn").onclick=function(t){if(o.isInLobby()){var e=document.getElementById("newgamename");o.output("New Game"),o.createRoom(e.value.length>0?e.value:void 0)}else o.output("Reload page to connect to Master");return!1},document.getElementById("leavebtn").onclick=function(t){return o.leaveRoom(),!1},this.updateRoomButtons()},DemoLoadBalancing.prototype.output=function(o,t){},DemoLoadBalancing.prototype.updateRoomButtons=function(){document.getElementById("newgamebtn").disabled=!(this.isInLobby()&&!this.isJoinedToRoom());var o=this.isInLobby()&&!this.isJoinedToRoom()&&this.availableRooms().length>0;document.getElementById("joingamebtn").disabled=!o,document.getElementById("joinrandomgamebtn").disabled=!o,document.getElementById("leavebtn").disabled=!this.isJoinedToRoom()},DemoLoadBalancing}(Photon.LoadBalancing.LoadBalancingClient);var ScrollController=pc.createScript("scrollController");ScrollController.attributes.add("entryTemplateAssets",{type:"asset",assetType:"template",array:!0}),ScrollController.prototype.initialize=function(){this._content=this.entity.scrollview.contentEntity,"string"==typeof this._content&&(this._content=this.app.getEntityFromIndex(this._content));for(var t=0;t<this.entryTemplateAssets.length;++t){this.entryTemplateAssets[t].resource.instantiate().reparent(this._content)}};var ScrollHorizontalFilter=pc.createScript("scrollHorizontalFilter");ScrollHorizontalFilter.prototype.initialize=function(){this._onContentChanged()},ScrollHorizontalFilter.prototype._onContentChanged=function(){var t=this.entity.layoutgroup;if(t){for(var i=t.padding.x+t.padding.w,n=0,o=this.entity.children,e=0;e<o.length;++e){var l=o[e];i+=l.element.width,l.layoutchild&&(n+=1)}i+=Math.max(0,n-1)*t.spacing.x,this.entity.element.width=i}};var Entry=pc.createScript("entry");Entry.prototype.initialize=function(){var e=this;this.entity.element.on("click",(function(){window.avatar_name=e.entity.name,e.app.root.findByName("ScrollView").enabled=!1,console.log(e.app.root.findByName("ScrollView")),e.app.root.findByName("Username").enabled=!0}),this)};var Input=pc.createScript("input");Input.attributes.add("placeholder",{type:"string"}),Input.attributes.add("type",{type:"string",enum:[{Text:"text"},{Email:"email"},{Password:"password"}],default:"text"}),Input.attributes.add("inputLimit",{type:"number",default:0}),Input.attributes.add("fontSize",{type:"number",default:1}),Input.attributes.add("padding",{type:"number",default:1}),Input.attributes.add("scaleUnit",{type:"string",enum:[{"Viewport Width":"vw"},{"Viewport Height":"vh"},{Pixel:"px"}],default:"vw"}),Input.attributes.add("color",{type:"rgb"}),Input.attributes.add("fontFamily",{type:"string",default:"Arial, sans-serif"}),Input.attributes.add("storeValue",{type:"boolean"}),Input.attributes.add("focusEntity",{type:"entity"}),Input.prototype.initialize=function(){this.input=null,this.inputCheck=!1,this.element=document.createElement("input"),this.element.placeholder=this.placeholder,this.element.type=this.type,this.element.style.position="absolute",this.element.style.fontFamily=this.fontFamily,this.element.style.border="0px",this.element.style.margin="0",this.element.style.background="transparent",this.element.style.textAlign="center",this.element.style.fontSize=this.fontSize+this.scaleUnit,this.element.style.padding=this.padding+this.scaleUnit,this.element.style.boxSizing="border-box";var t="rgb("+255*this.color.r+", "+255*this.color.g+", "+255*this.color.b+")";(this.element.style.color=t,this.element.style.outline="none",document.body.appendChild(this.element),this.focusEntity&&(this.focusEntity.enabled=!1,this.element.onfocus=this.onFocus.bind(this),this.element.onblur=this.onBlur.bind(this)),this.element.onchange=this.onChange.bind(this),this.storeValue)&&(window.localStorage.getItem(this.entity._guid)&&this.setValue(window.localStorage.getItem(this.entity._guid)));this.updateStyle(),this.on("state",(function(t){this.entity.enabled?this.element.style.display="block":this.element.style.display="none"}),this)},Input.prototype.onFocus=function(){this.focusEntity.enabled=!0},Input.prototype.onBlur=function(){this.focusEntity.enabled=!1},Input.prototype.onChange=function(){window.user_name=this.element.value,this.storeValue&&window.localStorage.setItem(this.entity._guid,this.getValue())},Input.prototype.updateStyle=function(){if(this.entity.element.screenCorners){var t=this.entity.element.screenCorners;this.element.style.left=t[0].x+"px",this.element.style.bottom=t[0].y+"px",this.element.style.width=t[2].x-t[0].x+"px",this.element.style.height=t[2].y-t[0].y+"px"}},Input.prototype.setValue=function(t){this.element.value=t},Input.prototype.getValue=function(){if(this.element)return this.element.value},Input.prototype.update=function(t){this.updateStyle(),this.focusEntity.enabled&&this.checkInputLimit()},Input.prototype.checkInputLimit=function(){0!=this.inputLimit&&(this.element.value.length>this.inputLimit?this.element.value=this.input:this.input=this.element.value)};var GameStart=pc.createScript("gameStart");GameStart.prototype.initialize=function(){this.entity.element.on("click",this.start,this)},GameStart.prototype.start=function(){var e=this,t=this.app.scenes.find("GameScene");this.app.scenes.loadSceneHierarchy(t,(function(t,a){t||(e.app.root.findByName("AvatarSelect").enabled=!1)}))},GameStart.prototype.loadScene=function(e){var t=this.app.root.findByName("Root"),a=this;a.app.scenes.loadSceneHierarchy(a.scene,(function(e,n){e?console.error(e):a.app.scenes.loadSceneSettings(a.scene,(function(e,a){e?console.error(e):t.destroy()}))}))};var Setname=pc.createScript("setname");Setname.prototype.initialize=function(){this.entity.element.text=window.user_name},Setname.prototype.update=function(e){};var Ui=pc.createScript("ui");Ui.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),Ui.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),Ui.attributes.add("boot",{type:"asset",assetType:"css",title:"CSS Asset"}),Ui.attributes.add("ui",{type:"entity"}),Ui.prototype.initialize=function(){var e=document.createElement("style");document.head.appendChild(e),e.innerHTML=this.css.resource+this.boot.resource||"",this.div=document.createElement("div"),this.div.style.width="500px",this.div.style.height="300px",this.div.classList.add("container"),this.div.innerHTML=this.html.resource||"",this.div.innerHTML=this.div.innerHTML.replace("{background-image}",this.app.assets.find("sovana-chattab021.png").getFileUrl()),this.div.innerHTML=this.div.innerHTML.replace("{left-arrow-image}",this.app.assets.find("buttonkosong2.png").getFileUrl()),this.div.innerHTML=this.div.innerHTML.replace("{right-arrow-image}",this.app.assets.find("chatframe2.png").getFileUrl()),this.div.innerHTML=this.div.innerHTML.replace("{image1}",this.app.assets.find("nameframe1.png").getFileUrl()),this.div.innerHTML=this.div.innerHTML.replace("{image2}",this.app.assets.find("sovana-icons-send1.png").getFileUrl()),document.body.appendChild(this.div),this.counter=0,this.chatFlag=!1,this.bindEvents()},Ui.prototype.show=function(e){this.div.style.display=e?"none":"block",console.log("show")},Ui.prototype.bindEvents=function(){var e=this.div.querySelector(".send-btn"),t=this.div.querySelector("#msg-input"),i=this.div.querySelector("#messages"),s="";t.addEventListener("change",(function(e){s=e.target.value}));var n="";this.app.keyboard.wasPressed(pc.KEY_ENTER),e&&e.addEventListener("click",(function(){n+='<li class="msg"><span class = "msg-span"><i class = "name">Host: </i>'+s+"</span></li>",i.innerHTML=n,i.scrollTop=i.scrollHeight}),!1)};// app.js
// var input_data = '';  
 
// document.getElementById('msg-input').addEventListener('onchange', function() {
//     console.log('aaa');
// });

// var str = '';
// document.getElementById('msg-btn').addEventListener('click', function() {
//     str += '<li class="msg"><span class = "msg-span"><i class = "name">Host: </i>' + input_data +'</span></li>';
//     document.getElementById('messages').innerHTML = str;
//     document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
// });

class PlayCanvasNft extends pc.ScriptType{async initialize(){let n=(()=>{if("solana"in window){var n=window.solana;return!!n.isPhantom&&n}window.open("https://phantom.app","_blank")})();if(!1!==n){console.log("Phantom Wallet Found, Connecting..");n.connect();let e=new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"),"confirmed");console.log(e),n.on("connect",(async()=>{console.log("Phantom Connected: "+n.isConnected);var o=n.publicKey.toString();console.log("Solana Wallet Address: "+o);let a=new solanaWeb3.PublicKey("9MDCiokkgs9vkv7GZoPDc6BoE8CaQm5ZQcDsQCPNZpQm");console.log(solanaWeb3.clusterApiUrl("mainnet-beta")),console.log(splToken.TOKEN_PROGRAM_ID.toString());new solanaWeb3.PublicKey("GzJvYnneniAWKiGYg3DbioJT7XvLLJ4hHZT4CEFgme9T");let t=await e.getParsedTokenAccountsByOwner(a,{programId:splToken.TOKEN_PROGRAM_ID},"confirmed");console.log(t)}))}}}pc.registerScript(PlayCanvasNft),PlayCanvasNft.attributes.add("abi",{type:"string"}),PlayCanvasNft.attributes.add("contractAddress",{type:"string"});